var NS=NS||{};(function(){var c=this,a=Object.prototype,d=a.toString,b=function(){};NS.global=c;NS.apply=function(h,g,m){if(m){NS.apply(h,m)}if(h&&g&&typeof g==="object"){var l,f,e;for(l in g){h[l]=g[l]}}};NS.apply(NS,{USE_NATIVE_JSON:true,userAgent:navigator.userAgent.toLowerCase(),emptyFn:b,applyIf:function(f,e){var g;for(g in e){if(typeof f[g]==="undefined"){f[g]=e[g]}}},merge:function(e){var k=1,l=arguments.length,f=ExtObject.merge,h=Ext.clone,j,n,m,g;for(;k<l;k++){j=arguments[k];for(n in j){m=j[n];if(m&&m.constructor===Object){g=e[n];if(g&&g.constructor===Object){f(g,m)}else{e[n]=h(m)}}else{e[n]=m}}}return e},isArray:("isArray" in Array)?Array.isArray:function(e){return d.call(e)==="[object Array]"},isDate:function(e){return d.call(e)==="[object Date]"},isObject:(d.call(null)==="[object Object]")?function(e){return e!==null&&e!==undefined&&d.call(e)==="[object Object]"&&e.ownerDocument===undefined}:function(e){return d.call(e)==="[object Object]"},isPrimitive:function(f){var e=typeof f;return e==="string"||e==="number"||e==="boolean"},isFunction:(typeof document!=="undefined"&&typeof document.getElementsByTagName("body")==="function")?function(e){return d.call(e)==="[object Function]"}:function(e){return typeof e==="function"},isNumber:function(e){return typeof e==="number"&&isFinite(e)},isString:function(e){return typeof e==="string"},isBoolean:function(e){return typeof e==="boolean"},isElement:function(e){return e?e.nodeType===1:false},isTextNode:function(e){return e?e.nodeName==="#text":false},isDefined:function(e){return typeof e!=="undefined"},isEmpty:function(e,f){return(e===null)||(e===undefined)||(!f?e==="":false)||(NS.isArray(e)&&e.length===0)},isLibObj:function(e){return NS.isExtObj(e)},isExtObj:function(e){return e instanceof Ext.Base},isNSObj:function(e){return e instanceof NS.Base},isNSComponent:function(e){return e instanceof NS.Component},isNSElement:function(e){return e instanceof NS.dom.Element}})})();(function(){var s=function(x){return x.test(NS.userAgent)},e=function(z,y){var x;return(z&&(x=y.exec(NS.userAgent)))?parseFloat(x[1]):0},j=document.documentMode,c=s(/\bchrome\b/),w=s(/opera/),r=s(/webkit/),l=!r&&s(/gecko/),b=l&&s(/rv:1\.9/),q=!w&&s(/msie/),p=q&&((s(/msie 7/)&&j!=8&&j!=9)||j==7),n=q&&((s(/msie 8/)&&j!=7&&j!=9)||j==8),m=q&&((s(/msie 9/)&&j!=7&&j!=8)||j==9),a=b&&s(/rv:1\.9\.0/),v=b&&s(/rv:1\.9\.1/),t=b&&s(/rv:1\.9\.2/),k=s(/linux/),u=s(/windows|win32/),h=s(/macintosh|mac os x/),g=e(true,/\bchrome\/(\d+\.\d+)/),d=e(true,/\bfirefox\/(\d+\.\d+)/),f=e(q,/msie (\d+\.\d+)/);NS.apply(NS,{isIE:q,isIE7:p,isIE8:n,isIE9:m,isFF3_0:a,isFF3_5:v,isFF3_6:t,isFF4:4<=d&&d<5,isFF5:5<=d&&d<6,isChrome:c,isLinux:k,isWindows:u,isMac:h,chromeVersion:g,firefoxVersion:d,ieVersion:f})})();NS.onReady=function(a){NS.ClassLoader.onReady(a)};(function(){NS.id=(function(){var a=1000;return function(){a+=1;return"ns_"+a}})()})();NS.Function={alias:function(b,a){return function(){return b[a].apply(b,arguments)}},bind:function(d,c,b,a){if(arguments.length===2){return function(){return d.apply(c,arguments)}}var f=d,e=Array.prototype.slice;return function(){var g=b||arguments;if(a===true){g=e.call(arguments,0);g=g.concat(b)}else{if(typeof a=="number"){g=e.call(arguments,0);NS.util.Array.insert(g,a,b)}}return f.apply(c||NS.global,g)}},clone:function(a){return function(){return a.apply(this,arguments)}},createBuffered:function(e,b,d,c){var a;return function(){var g=c||Array.prototype.slice.call(arguments,0),f=d||this;if(a){clearTimeout(a)}a=setTimeout(function(){e.apply(f,g)},b)}},createInterceptor:function(d,c,b,a){var e=d;if(!NS.isFunction(c)){return d}else{return function(){var g=this,f=arguments;c.target=g;c.method=d;return(c.apply(b||g||NS.global,f)!==false)?d.apply(g||NS.global,f):a||null}}},createSequence:function(b,c,a){if(!c){return b}else{return function(){var d=b.apply(this,arguments);c.apply(a||this,arguments);return d}}},createThrottled:function(e,b,d){var f,a,c,h,g=function(){e.apply(d||this,c);f=new Date().getTime()};return function(){a=new Date().getTime()-f;c=arguments;clearTimeout(h);if(!f||(a>=b)){g()}else{h=setTimeout(g,b-a)}}},defer:function(e,c,d,b,a){e=NS.Function.bind(e,d,b,a);if(c>0){return setTimeout(e,c)}e();return 0},interceptBefore:function(b,a,d,c){var e=b[a]||NS.emptyFn;return(b[a]=function(){var f=d.apply(c||this,arguments);e.apply(this,arguments);return f})},interceptAfter:function(b,a,d,c){var e=b[a]||NS.emptyFn;return(b[a]=function(){e.apply(this,arguments);return d.apply(c||this,arguments)})}};(function(){var a=NS.Function.alias;NS.bind=a(NS.Function,"bind");NS.clone=a(Ext,"clone");NS.defer=a(NS.Function,"defer")})();NS.Error=(function(){var a=function(b){var c;if(b){c=(b.sourceClass||"")+"类:-"+(b.sourceMethod||"")+"方法:-"+(b.msg||"")}return c||""};return{raise:function(b){var c=a(b);throw new Error(c)}}})();NS.error=NS.Function.alias(NS.Error,"raise");NS.JSON=new (function(){var me=this,encodingFunction,decodingFunction,useNative=null,useHasOwn=!!{}.hasOwnProperty,isNative=function(){if(useNative===null){useNative=NS.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]"}return useNative},pad=function(n){return n<10?"0"+n:n},doDecode=function(json){return eval("("+json+")")},doEncode=function(o,newline){if(o===null||o===undefined){return"null"}else{if(NS.isDate(o)){return NS.JSON.encodeDate(o)}else{if(NS.isString(o)){return encodeString(o)}else{if(o.toJSON){return o.toJSON()}else{if(NS.isArray(o)){return encodeArray(o,newline)}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"}else{if(NS.isBoolean(o)){return String(o)}else{if(NS.isObject(o)){return encodeObject(o,newline)}else{if(typeof o==="function"){return"null"}}}}}}}}}return"undefined"},m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\","\x0b":"\\u000b"},charToReplace=/[\\\"\x00-\x1f\x7f-\uffff]/g,encodeString=function(s){return'"'+s.replace(charToReplace,function(a){var c=m[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'},encodeArrayPretty=function(o,newline){var len=o.length,cnewline=newline+"   ",sep=","+cnewline,a=["[",cnewline],i;for(i=0;i<len;i+=1){a.push(doEncode(o[i],cnewline),sep)}a[a.length-1]=newline+"]";return a.join("")},encodeObjectPretty=function(o,newline){var cnewline=newline+"   ",sep=","+cnewline,a=["{",cnewline],i;for(i in o){if(!useHasOwn||o.hasOwnProperty(i)){a.push(doEncode(i)+": "+doEncode(o[i],cnewline),sep)}}a[a.length-1]=newline+"}";return a.join("")},encodeArray=function(o,newline){if(newline){return encodeArrayPretty(o,newline)}var a=["[",""],len=o.length,i;for(i=0;i<len;i+=1){a.push(doEncode(o[i]),",")}a[a.length-1]="]";return a.join("")},encodeObject=function(o,newline){if(newline){return encodeObjectPretty(o,newline)}var a=["{",""],i;for(i in o){if(!useHasOwn||o.hasOwnProperty(i)){a.push(doEncode(i),":",doEncode(o[i]),",")}}a[a.length-1]="}";return a.join("")};me.encodeValue=doEncode;me.encodeDate=function(o){return'"'+o.getFullYear()+"-"+pad(o.getMonth()+1)+"-"+pad(o.getDate())+"T"+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+'"'};me.encode=function(o){if(!encodingFunction){encodingFunction=isNative()?JSON.stringify:me.encodeValue}return encodingFunction(o)};me.decode=function(json,safe){if(!decodingFunction){decodingFunction=isNative()?JSON.parse:doDecode}try{return decodingFunction(json)}catch(e){if(safe===true){return null}NS.error({sourceClass:"NS.JSON",sourceMethod:"decode",msg:"你在解析一个非法的JSON格式: "+json})}}})();NS.encode=NS.JSON.encode;NS.decode=NS.JSON.decode;NS.Array={insert:function(e,b,d){var a=[];for(var c=0;c<e.length;c++){if(c==b){a.push(e[c],d)}else{a.push(e[c])}}return a},each:function(d,c){for(var b=0;b<d.length;b++){var a=c(d[b],b);if(a==false){break}}},replace:function(e,b,d){var a=new Array();for(var c=0;c<e.length;c++){if(b==c){a.push(d)}else{a.push(e[c])}}return a},contains:function(d,b){for(var a=0;a<d.length;a++){var c=d[a];if(c==b){return true}}return false},clean:function(e){var b=[],a=0,d=e.length,c;for(;a<d;a++){c=e[a];if(!this.isEmpty(c)){b.push(c)}}return b},clone:function(a){return Array.prototype.slice.call(a)},erase:function(e,b,d){var a=new Array();for(var c=0;c<e.length;c++){if(c>=b&&c<(b+d)){}else{a.push(e[c])}}return a},every:function(e,c,b){for(var a=0;a<e.length;a++){var d=c(e[a],a);if(d==b){return true}}return false},forEach:function(f,e,d){for(var c=0,a=f.length;c<a;c++){var b=e(c,f[c],d||this);if(b==false){return}}},indexOf:function(g,e,f){var c,d,a=[];if(typeof f=="undefined"){for(c=0,d=g.length;c<d;c++){if(e==g[c]){return c}}return -1}else{for(c=0,d=g.length;c<d;c++){if(c>=f){a.push(g[c])}}for(var b=0;b<a.length;b++){if(e==a[b]){return b}}return -1}return -1},intersect:function(l,h,c){var g=[];for(var e=0,f=l.length;e<f;e++){for(var d=0,b=h.length;d<b;d++){if(l[e]==h[d]){g.push(l[e])}}}var a={},k=[];for(var e=0,f=g.length;e<f;e++){if(!a[g[e]]){k.push(g[e])}}return k},max:function(c){var a=0;for(var b=0;b<c.length;b++){if(c[b]>c[b+1]){a=c[b];c[b]=c[b+b];c[b+1]=a}}return a},min:function(c){var b=null;for(var a=0;a<c.length;a++){if(c[a]<c[a+1]){b=c[a];c[a]=c[a+1];c[a+1]=c[a]}}return b},mean:function(d){var b=0;var c=d.length;for(var a=0;a<c;a++){b+=d[a]}return parseFloat(b/c)},merge:function(f,e,c){var a=new Array();if(f){for(var d=0;d<f.length;d++){a.push(f[d])}}if(e){for(var b=0;b<e.length;b++){a.push(e[b])}}return a},pluck:function(e,b){var a=[],c,d;for(c=0,d=e.length;c<d;c++){a.push(e[c][b])}return a},remove:function(e,d){var b,c,a=[];for(b=0,c=e.length;b<c;b++){if(d!=e[b]){a.push(e[b])}}return a},slice:function(f,d,b){var c,e,a=[];for(c=0,e=f.length;c<e;c++){if(c>=d&&c<=b){a.push(f[c])}}return a},splice:function(h,c,g,f){var d,e,a=[];var b=0;for(d=0,e=h.length;d<e;d++){if(d>=c&&d<(c+g)){b++;if(typeof f!="object"&&typeof f!="undefined"){if(b==1){a.push(f)}}else{}}else{a.push(h[d])}}return a},sum:function(e){var b=0,a=0,d=e.length,c;for(;a<d;a++){c=e[a];b+=c}return b},union:function(c,b,a){var d=[];if(c instanceof Array&&b instanceof Array){c.concat(b);d=this.unique(c)}return d},unique:function(f){var a=[],b,d,e={};for(b=0,d=f.length;b<d;b++){var c=f[b];if(!e[c]){e[c]=1}else{e[c]+=1}}for(var b in e){if(e[b]==1){a.push(b)}}return a},complexElements:function(g,f,b){var a=[],c,e,h={};for(c=0,e=array.length;c<e;c++){var d=array[c];if(!h[d]){h[d]=1}else{h[d]+=1}}for(var c in h){if(h[c]>1){a.push(c)}}return a},removeAt:function(b,a){b.splice(a,1);return b},toArray:function(c,e,a){if(!c||!c.length){return[]}if(typeof c==="string"){c=c.split("")}if(true){return Array.prototype.slice.call(c,e||0,a||c.length)}var d=[],b;e=e||0;a=a?((a<0)?c.length+a:a):c.length;for(b=e;b<a;b++){d.push(c[b])}return d}};NS.Date={now:Date.now||function(){return +new Date()},toString:function(a){if(a instanceof Date){return a.toString()}else{if(a instanceof String){return a}else{return new String(a)}}},getElapsed:function(){},getToday:function(){var a=arguments[0],c,e,b;if(a){c=a.year;e=a.month;b=a.date}else{var f=new Date();c=f.getYear()+1900;e=f.getMonth()+1;b=f.getDate()}e=e<10?("0"+e):e;b=b<10?("0"+b):b;return c+"-"+e+"-"+b},beforeOrAfterDate:function(b,c){var d,f,a;if(!c){c=new Date();d=c.getYear()+1900;f=c.getMonth()+1;a=c.getDate()}else{d=this.getYear(c);f=this.getMonth(c);a=this.getDate(c)}if(-31<b&&b<0){a=a+b;if(a<=0){a=12+a;d=d-1}}else{if(b>=0&&b<31){a=a+b;var e=this.getMonthDays(c);if(a>e){a=a-e;f+=1;if(f>12){d+=1}}}else{return null}}return this.getToday({year:d,month:f,date:a})},isLeapYear:function(a){if(!a){a=new Date()}var b=this.getYear(a);return b%400==0||(b%4==0&&b%100!=0)},getYear:function(a){if(!a){return(new Date()).getYear()+1900}return(new Date(a)).getYear()+1900},getMonth:function(a){if(!a){return(new Date()).getMonth()+1}return Number((new Date(a)).getMonth())+1},getDate:function(a){if(a){return(new Date(a)).getDate()}return(new Date()).getDate()},getDay:function(a){if(!a){return(new Date()).getDay()}return(new Date(a)).getDay()},getMonthDays:function(a){if(!a){a=this.getToday()}var b=[31,28,31,30,31,30,31,31,30,31,30,31];if(this.isLeapYear(a)){b[1]=29}return b[this.getMonth(a)-1]},format:function(a,b){return Ext.Date.format(a,b)}};NS.Object=(function(){var a=function(){};return{chain:function(c){a.prototype=c;var b=new a();a.prototype=null;return b},toQueryObjects:function(d,h,c){var b=ExtObject.toQueryObjects,g=[],e,f;if(Ext.isArray(h)){for(e=0,f=h.length;e<f;e++){if(c){g=g.concat(b(d+"["+e+"]",h[e],true))}else{g.push({name:d,value:h[e]})}}}else{if(Ext.isObject(h)){for(e in h){if(h.hasOwnProperty(e)){if(c){g=g.concat(b(d+"["+e+"]",h[e],true))}else{g.push({name:d,value:h[e]})}}}}else{g.push({name:d,value:h})}}return g},toQueryString:function(e,c){var f=[],d=[],h,g,k,b,l;for(h in e){if(e.hasOwnProperty(h)){f=f.concat(ExtObject.toQueryObjects(h,e[h],c))}}for(g=0,k=f.length;g<k;g++){b=f[g];l=b.value;if(Ext.isEmpty(l)){l=""}else{if(Ext.isDate(l)){l=Ext.Date.toString(l)}}d.push(encodeURIComponent(b.name)+"="+encodeURIComponent(String(l)))}return d.join("&")},fromQueryString:function(c,q){var k=c.replace(/^\?/,"").split("&"),t={},r,g,v,l,p,e,m,n,b,f,s,h,u,d;for(p=0,e=k.length;p<e;p++){m=k[p];if(m.length>0){g=m.split("=");v=decodeURIComponent(g[0]);l=(g[1]!==undefined)?decodeURIComponent(g[1]):"";if(!q){if(t.hasOwnProperty(v)){if(!Ext.isArray(t[v])){t[v]=[t[v]]}t[v].push(l)}else{t[v]=l}}else{f=v.match(/(\[):?([^\]]*)\]/g);s=v.match(/^([^\[]+)/);if(!s){throw new Error('[Ext.Object.fromQueryString] Malformed query string given, failed parsing name from "'+m+'"')}v=s[0];h=[];if(f===null){t[v]=l;continue}for(n=0,b=f.length;n<b;n++){u=f[n];u=(u.length===2)?"":u.substring(1,u.length-1);h.push(u)}h.unshift(v);r=t;for(n=0,b=h.length;n<b;n++){u=h[n];if(n===b-1){if(Ext.isArray(r)&&u===""){r.push(l)}else{r[u]=l}}else{if(r[u]===undefined||typeof r[u]==="string"){d=h[n+1];r[u]=(Ext.isNumeric(d)||d==="")?[]:{}}r=r[u]}}}}}return t},each:function(b,d,c){for(var e in b){if(b.hasOwnProperty(e)){if(d.call(c||b,e,b[e],b)===false){return}}}},merge:function(b){var g=1,h=arguments.length,c=ExtObject.merge,e=Ext.clone,f,k,j,d;for(;g<h;g++){f=arguments[g];for(k in f){j=f[k];if(j&&j.constructor===Object){d=b[k];if(d&&d.constructor===Object){c(d,j)}else{b[k]=e(j)}}else{b[k]=j}}}return b},mergeIf:function(h){var e=1,f=arguments.length,c=Ext.clone,b,d,g;for(;e<f;e++){b=arguments[e];for(d in b){if(!(d in h)){g=b[d];if(g&&g.constructor===Object){h[d]=c(g)}else{h[d]=g}}}}return h},getKey:function(b,d){for(var c in b){if(b.hasOwnProperty(c)&&b[c]===d){return c}}return null},getValues:function(c){var b=[],d;for(d in c){if(c.hasOwnProperty(d)){b.push(c[d])}}return b},getKeys:(typeof Object.keys=="function")?function(b){if(!b){return[]}return Object.keys(b)}:function(b){var c=[],d;for(d in b){if(b.hasOwnProperty(d)){c.push(d)}}return c},getSize:function(b){var c=0,d;for(d in b){if(b.hasOwnProperty(d)){c++}}return c},classify:function(e){var d=e,g=[],c={},b=function(){var j=0,k=g.length,l;for(;j<k;j++){l=g[j];this[l]=new c[l]}},f,h;for(f in e){if(e.hasOwnProperty(f)){h=e[f];if(h&&h.constructor===Object){g.push(f);c[f]=ExtObject.classify(h)}}}b.prototype=d;return b},pluck:function(c,d){for(var b in c){if(b){d(b,c[b],c)}}}}})();NS.String=(function(){var a=/(^\s*)|(\s*$)/g,b=/\{(\d+)\}/g;return{trim:function(c){return c.replace(a,"")},createByStyle:function(d,c){return'<span style="'.concat(c,'">',d,"</span>")},equals:function(d,c){return d.toLowerCase()==c.toLowerCase()},compare:function(d,c){if(d<c){return -1}else{if(d==c){return 0}else{return 1}}},compareByLowercase:function(d,c){return this.compare(d.toLowerCase(),c.toLowerCase())},leftPad:function(d,e,f){var c=String(d);f=f||" ";while(c.length<e){c=f+c}return c},urlAppend:function(d,c){if(!NS.isEmpty(c)){return d+(d.indexOf("?")===-1?"?":"&")+c}return d},capitalize:function(c){return c.charAt(0).toUpperCase()+c.substr(1)},uncapitalize:function(c){return c.charAt(0).toLowerCase()+c.substr(1)},ellipsis:function(e,c,f){if(e&&e.length>c){if(f){var g=e.substr(0,c-2),d=Math.max(g.lastIndexOf(" "),g.lastIndexOf("."),g.lastIndexOf("!"),g.lastIndexOf("?"));if(d!==-1&&d>=(c-15)){return g.substr(0,d)+"..."}}return e.substr(0,c-3)+"..."}return e},format:function(d){var c=NS.Array.toArray(arguments,1);return d.replace(b,function(e,f){return c[f]})},format2:function(d,c){return d.replace(b,function(e,f){return c[f]})},isStartWith:function(d,c){return d.substr(0,c.length)==c},isEndWidth:function(d,c){return d.substr(d.length-c.length)==c},delHtmlTag:function(c){return c.replace(/<\/?.+?>/g,"")},upFirstWord:function(c){return c.substr(0,1).toUpperCase().concat(c.substr(1,c.length-1))}}})();NS.ClassManager=(function(){var b={};var a=function(c,e){var h,f=0,d="",g=window;h=c.split(".");if(h.length==1){window[c]=e}else{if(!window[h[0]]){window[h[0]]={}}for(f;f<h.length;f++){d=h[f];if(f==h.length-1){g[d]=e}else{if(!g[d]){g[d]={}}g=g[d]}}}};return{register:function(d,c){b[d]=c||{};a(d,c)},unregister:function(c){if(c){delete b[c]}},get:function(c){return b[c]},getClassByNameSpace:function(g){var f,d=0,c,e=window;f=g.split(".");for(d;d<f.length;d++){c=f[d];if(d==f.length-1){return e[c]}e=e[c]}return null},getClass:function(c){return c&&c.self||null},getName:function(c){return c&&c.$classname||""},getSuperInstance:function(d){var c=function(){};c.prototype=d.prototype;return new c()},extend:function(d,c){var e=d.$classname;c.extend=e;subClass=this.createExtendClass(e,c);return subClass},createClass:function(d,c){c.extend=c.extend||"NS.Base";this.createExtendClass(d,c)},createExtendClass:function(n,e){var c,m=e.mixins||[],r=this.get(e.extend),g=this.getSuperInstance(r),d=this.getSuperInstance(r);if(e.hasOwnProperty("constructor")){c=e.constructor;g.constructor=e.constructor;delete e.constructor}else{c=(function(k){var u=function(){k.apply(this,arguments)};return u})(r)}delete e.extend;var q=NS.Function.clone;for(var t in g){var l=g[t];var f=e[t];if(f){if(typeof f==="function"){var p=q(f);p.$owner=c;p.$name=t;g[t]=p}else{if(typeof f==="object"){g[t]=f}else{if(typeof f==="string"){g[t]=f}else{g[t]=f}}}}else{g[t]=l}}NS.applyIf(g,e);g.constructor=c;g.$classname=n;c.prototype=g;this.addProperties(c,{self:c,superclass:d,$classname:n});this.addStatics(c,{superclass:d,$classname:n});for(var h=0;h<m.length;h++){var s=this.get(m[h]);if(s){this.toMix(c,s)}}if(e.singleton===true){var j=new c();this.register(n,j)}else{this.register(n,c)}},addStatics:function(c,d,e){if(e){NS.apply(c,e)}NS.apply(c,d)},addProperties:function(c,d,f){if(f){this.addProperties(c,f)}for(var e in d){c.prototype[e]=d[e]}},toMix:function(d,e){var k=e.prototype,j={},f,g,c,h;for(f in k){switch(f){case"$classname":continue;case"superclass":continue;default:g=k[f];c=g.$owner;if(c){h=c.$classname;if(h!="NS.Base"){j[f]=g}}else{j[f]=g}}}this.addProperties(d,j)},clone:function(c){return function(){return c.apply(this,arguments)}},define:function(f,d){Loader=NS.ClassLoader;Loader.pushConfigByClassName(f,d);var j=(d.mixins||[]).concat((d.requires||[]).concat(d.extend||[]));if(j.length>0){Loader.pushReadyToLoadClass(j)}var c=Loader.checkClassReady();if(c){var e=Loader.classStack;while(e.length!=0){var h=e.pop();var g=h.classname;var d=h.config;if(this.get(g)){continue}else{this.createClass(g,d)}}Loader.clear();if(Loader.ready){Loader.ready();Loader.ready=null}}},namespace:function(d){var c,e=d;this.register(d,{})},create:function(d,c){return new b[d](c)}}})();(function(){var a=NS.ClassManager;var b=NS.Function.alias;a.register("NS",NS);NS.namespace=b(a,"namespace");NS.ns=NS.namespace;NS.define=b(a,"define");NS.create=b(a,"create")})();(function(){var c=NS.Function.alias;var d=function(e){if(e&&e.listeners){var g=e.listeners;if(NS.isObject(g)){for(var f in g){var h=g[f];if(NS.isObject(h[f])){this.addListener(f,h.fn,h.scope||this)}else{if(NS.isFunction(h[f])){this.addListener(f,h[f],this)}}}}}};var b=function(e){d.apply(this,arguments)};var a=NS.ClassManager;a.register("NS.Base",b);NS.apply(b,{$classname:"NS.Base",statics:function(e){},addMember:function(e,f){if(typeof f=="function"&&f!==NS.emptyFn){f.$owner=this}this.prototype[e]=f;return this},addMembers:function(e){if(e){for(var f in e){if(e.hasOwnProperty(f)){this.addMember(f,e[f])}}}}});b.addMembers({$classname:"NS.Base",self:b,callParent:function(e){var f=this.callParent.caller;if(f.caller&&f.caller.$owner){f=f.caller;return f.$owner.superclass[f.$name].apply(this,e||[])}else{if(f.superclass){return f.superclass.constructor.apply(this,e||[])}}},getName:function(){return a.getName(this)},addEvents:function(h){var g=this,f=0,e=g.events=g.events||{};if(typeof h=="string"){for(args=arguments,f=args.length;f--;){arg=args[f];if(!e[arg]){e[arg]={}}}}else{NS.applyIf(g.events,o)}},addListener:function(e,l,h){var k=this,j,g=k.events||{};if(NS.isString(e)){g[e]={};g[e].callback=l;g[e].scope=h}else{if(NS.isObject(e)){for(var f in e){if(g[f]){j=e[f];if(NS.isFunction(j)){g[f].callback=j}else{if(NS.isObject(j)){if(j.fn){g[f].callback=j.fn;g[f].scope=j.scope}}}}}}}},removeListener:function(f){var e=this["events"]||{};if(NS.isString(f)){delete e[f]}},fireEvent:function(k){var m=this,f,l=arguments,p=[],h=0,g,n,e=1;if(typeof k=="string"&&m.events){n=m.events[k]||[]}else{if(typeof k=="object"){for(;e<l.length;e++){p.push(l[e])}}}if(l.length>1){for(;e<l.length;e++){p.push(l[e])}}if(typeof n==="object"){if(n.callback!=undefined){return n.callback.apply(n.scope||m,p)}}}});NS.Base.prototype.on=b.prototype.addListener;NS.Base.prototype.addEvent=b.prototype.addEvents})();NS.ClassLoader={loader:$LAB,baseNumber:100000,ready:function(){},onReady:function(a){this.ready=a},paths:{NS:""},pushConfigByClassName:function(g,c){var b=this.classStack;var e=this.classMap;if(e[g]){for(var d=0,a=b.length;d<a;d++){var f=b[d];if(f.classname==g){f.config=c;e[g].canBeCreate=true;f.canBeCreate=true}}}else{var f={classname:g,config:c,require:null,canBeCreate:true};e[g]=f;b.push(f)}},pushReadyToLoadClass:function(e){var b=NS.ClassManager;if(typeof e==="string"){if(!b.get(e)){var d={classname:e,config:null,require:null};this.classStack.push(d);this.classMap[e]=d;this.load(e)}}else{if(typeof e==="object"&&e instanceof Array){for(var c=0,a=e.length;c<a;c++){if(!b.get(e[c])){var d={classname:e[c],config:null,require:null};this.classStack.push(d);this.classMap[e[c]]=d;this.load(e[c])}}}}},checkClassReady:function(){var c=this.classMap;var a=true;for(var b in c){var d=c[b];if(d.canBeCreate!=true){a=false;break}}return a},clear:function(){this.classMap={};this.classStack=[]},classMap:{},classStack:[],setLoadPath:function(a,b){this.paths[a]=b},getClassUrl:function(c){var b=c.split(".");var a=this.paths[b.shift()];a+="/"+b.join("/");this.baseNumber+=100000;a+=".js?t="+this.baseNumber;return a},getClassesUrl:function(a){if(typeof a=="string"){return this.getClassUrl(a)}},loadClass:function(a,b){this.load(a,b)},load:function(d,e){var a=this.loader,b=NS.ClassManager;if(typeof d=="string"){if(!b.get(d)){this.loader=a.script(this.getClassUrl(d))}}else{if(typeof d=="object"&&d instanceof Array){for(var c=0;c<d.length;c++){if(!b.get(d[c])){this.loader=a.script(this.getClassUrl(d[c]))}}}}if(!this.ready){this.ready=e}},init:function(){this.loader.setGlobalDefaults(false,true,true,"",true,true)}};(function(){var a=NS.ClassLoader;a.init();var b=NS.Function.alias;NS.load=b(a,"load");NS.setLoadPath=b(a,"setLoadPath")})();NS.define("NS.Connection",{baseAction:"baseAction!queryByComponents.action",constructor:function(){this.addEvents("beforerequest");this.initConnection.apply(this,arguments)},initConnection:function(a){this.conn=Ext.Ajax},callService:function(a,d,b,c){this.asyncRequest({params:{components:NS.encode(a)},callback:d,scope:b,timeout:c||60000})},syncCallService:function(a){var b=this.syncRequest({params:{components:NS.encode(a)},callback:callback,scope:scope});return b},syncRequest:function(b){var c=this;var a={url:this.baseAction,params:{},method:"POST",async:false,success:function(d){c.dataJson=Ext.JSON.decode(d.responseText,true)},failure:function(d){c.dataJson=Ext.JSON.decode(d.responseText,true);Ext.Msg.alert("警告","数据请求失败！")}};NS.apply(a,b);this.conn.request(a);return c.dataJson},asyncRequest:function(b){var c=this;var d=b.callback;delete b.callback;var a={url:this.baseAction,params:{},method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},success:function(f){var g=f.getResponseHeader("sessionstatus");if(g=="timeout"){window.location.href="session.jsp"}var e=Ext.JSON.decode(f.responseText,true);d.call(this,e,f.responseText)},failure:function(){var e=Ext.JSON.decode(response.responseText,true);d.call(this,e);Ext.Msg.alert("警告","数据请求失败！")}};NS.apply(a,b);this.conn.request(a)}});NS.define("NS.dom.Element",{constructor:function(a){this.element=new Ext.dom.Element(a);this.dom=this.element.dom},set:function(a){this.element=a;this.dom=a.dom;return this},addCls:function(a){this.element.addCls(a);return this},removeCls:function(a){this.element.removeCls(a);return this},getHTML:function(){return this.element.getHTML()},setHTML:function(a){this.element.setHTML(a);return this},getHeight:function(){return this.element.getHeight()},getWidth:function(){return this.element.getWidth()},getLeft:function(){return this.element.getLeft()},getTop:function(){return this.element.getTop()},setStyle:function(b,a){this.element.setStyle(b,a);return this},getAttribute:function(a){return this.element.getAttribute(a)},getValue:function(){return this.element.getValue()},getXY:function(){return this.element.getXY()},getX:function(){return this.element.getX()},getY:function(){return this.element.getY()},setXY:function(b,a){this.element.setXY(b,a);return this},query:function(a){return new NS.dom.Element(this.element.query(a,true))},child:function(a){return new NS.dom.Element(this.element.child(a))}});(function(){var a=new NS.dom.Element();NS.fly=function(b){a.set(Ext.fly(b));return a};NS.get=function(c){var b=new NS.dom.Element();var d=Ext.get(c);b.set(d);return b};NS.getBody=function(){var b=new NS.dom.Element();var c=Ext.getBody();b.set(c);return b};NS.query=function(c,b){return Ext.query(c,b)}})();NS.ns("NS.util");NS.define("NS.util.FileLoader",{singleton:true,constructor:function(){this.connection=new Ext.data.Connection()},loadFile:function(b,a,c){this.connection.request({url:b,success:function(d){a.call(c,d.responseText,d)}})},loadCss:function(a){var b=document.getElementsByTagName("head")[0];var c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;b.appendChild(c)}});(function(){var a=NS.Function.alias;NS.loadCss=a(NS.util.FileLoader,"loadCss");NS.loadFile=a(NS.util.FileLoader,"loadFile")})();NS.define("NS.util.TaskManager",{singleton:true,constructor:function(){this.component=Ext.TaskManager},start:function(a){this.component.start(a)},stop:function(a){this.component.stop(a)},stopAll:function(){this.component.stopAll()}});NS.Event=(function(){var a;return{setEventObj:function(b){a=b},getTarget:function(){return a.getTarget()},getX:function(){return a.getX()},getY:function(){return a.getY()},getXY:function(){return a.getXY()},preventDefault:function(){a.preventDefault()},stopEvent:function(){a.stopEvent()},stopPropagation:function(){a.stopPropagation()},getKey:function(){return a.getKey()}}})();NS.util.Format=(function(){var c=/<\/?[^>]+>/gi,b=/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/ig,a=/\r?\n/g;return{undef:function(d){return d!==undefined?d:""},defaultValue:function(e,d){return e!==undefined&&e!==""?e:d},substr:function(e,f,d){return String(e).substr(f,d)},lowercase:function(d){return String(d).toLowerCase()},uppercase:function(d){return String(d).toUpperCase()},stripTags:function(d){return !d?d:String(d).replace(c,"")},stripScripts:function(d){return !d?d:String(d).replace(b,"")},nl2br:function(d){return Ext.isEmpty(d)?"":d.replace(a,"<br/>")}}})();Ext.override(Ext.panel.Panel,{getHeaderConfig:function(b,a){return Ext.applyIf(b,a)},updateHeader:function(e){var d=this,h=d.header,g=d.title,f=d.tools,c=d.headerConfig;if(!d.preventHeader&&(e||g||(f&&f.length))){if(h){h.show()}else{var a={title:g,orientation:(d.headerPosition=="left"||d.headerPosition=="right")?"vertical":"horizontal",dock:d.headerPosition||"top",textCls:d.headerTextCls,iconCls:d.iconCls,icon:d.icon,baseCls:d.baseCls+"-header",tools:f,ui:d.ui,id:d.id+"_header",indicateDrag:d.draggable,frame:d.frame&&d.frameHeader,ignoreParentFrame:d.frame||d.overlapHeader,ignoreBorderManagement:d.frame||d.ignoreHeaderBorderManagement,listeners:d.collapsible&&d.titleCollapse?{click:d.toggleCollapse,scope:d}:null};var b=Ext.apply(a,c);h=d.header=new Ext.panel.Header(b);d.addDocked(h,0);d.tools=h.tools}d.initHeaderAria()}else{if(h){h.hide()}}}});NS.define("NS.Component",{constructor:function(a){this.initConfigMapping();var b=this.processConfigProperties(a);this.processExtPlugins.apply(this,[b]);this.initEvents();this.initData.apply(this,arguments);this.initComponent.apply(this,[b]);this.processNSPlugins();this.addPackContainer()},initConfigMapping:function(){var a=function(e,d,c){c[d]=e.tpl};var b=function(e,d,c){if(NS.isElement(e)){c[d]=e.element}else{if(NS.isString(e)){c[d]=e}}};this.configPropertiesMapping={baseCls:true,cls:true,disabled:true,margin:true,padding:true,autoShow:true,autoScroll:true,floating:true,width:true,height:true,maxHeight:true,maxWidth:true,minHeight:true,minWidth:true,name:true,hidden:true,colspan:true,rowspan:true,columnWidth:true,style:true,border:true,plugins:true,items:true,layout:true,region:true,frame:true,renderTo:true,tpl:a,data:true,html:true}},processConfigProperties:function(b){var d=this.configPropertiesMapping,e,c,a={},f={};for(var c in b){e=d[c];if(e){a[c]=b[c]}else{f[c]=b[c]}}NS.apply(this,f);for(var c in a){e=d[c];if(NS.isFunction(e)){e.call(this,a[c],c,a)}}return a},addConfigMapping:function(d,f){var b=this.configPropertiesMapping,c=arguments,g;switch(c.length){case 1:if(NS.isObject(d)){NS.apply(b,d)}case 2:if(NS.isString(d)&&NS.isFunction(f)){b[d]=f;break}default:for(var e=0,a=c.length;e<a;e++){g=c[e];if(NS.isString(g)){b[g]=true}}break}},initEvents:function(){this.addEvents("activate","beforerender","afterrender","disable","enable","hide","focus","blur","click","dbclick","contextmenu","mouseover","mouseenter","mouseleave","mousemove","keydown","keyup","keypress","destroy","select","change")},onActivate:function(){this.component.on("activate",function(b,a){this.fireEvent("activate",this)},this)},onAfterrender:function(){this.component.on("afterrender",function(b,a){this.fireEvent("afterrender",this)},this)},onBeforerender:function(){this.component.on("beforerender",function(b,a){this.fireEvent("beforerender",this)},this)},onDisable:function(){this.component.on("disable",function(b,a){this.fireEvent("disable",this)},this)},onEnable:function(){this.component.on("enable",function(b,a){this.fireEvent("enable",this)},this)},onFocus:function(){this.component.on("focus",function(b,a){this.fireEvent("focus",this)},this)},onBlur:function(){this.component.on("blur",function(){this.fireEvent("blur",this)},this)},onDestroy:function(){this.component.on("destroy",function(){this.fireEvent("destroy",this)},this)},onHide:function(){this.component.on("hide",function(){this.fireEvent("hide",this)},this)},onClick:function(b,a){this.component.on({click:{element:"el",scope:this,fn:function(d,c){NS.Event.setEventObj(d,c);this.fireEvent("click",NS.Event,c)}}})},onContextmenu:function(){this.component.on({contextmenu:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("contextmenu",NS.Event,a)}}})},onChange:function(){this.component.on({change:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("change",NS.Event,a)}}})},onDbclick:function(){this.component.on({dblclick:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("dbclick",NS.Event,a)}}})},onMouseover:function(){this.component.on({mouseover:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("mouseover",NS.Event,a)}}})},onSelect:function(){this.component.on({select:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("select",NS.Event,a)}}})},onMouseenter:function(){this.component.on({mouseenter:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("mouseenter",NS.Event,a)}}})},onMouseleave:function(){this.component.on({mouseleave:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("mouseleave",NS.Event,a)}}})},onKeydown:function(){this.component.on({keydown:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("keydown",NS.Event,a)}}})},onKeyup:function(){this.component.on({keyup:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("keyup",NS.Event,a)}}})},onKeypress:function(){this.component.on({keypress:{element:"el",scope:this,fn:function(b,a){NS.Event.setEventObj(b,a);this.fireEvent("keypress",NS.Event,a)}}})},addListener:function(d,f,b){var e,c;if(NS.isString(d)){e="on"+NS.String.capitalize(d);if(this[e]){this[e]()}this.callParent(arguments)}else{if(NS.isObject(d)){for(var a in d){e="on"+NS.String.capitalize(a);if(this[e]){this[e]()}c=d[a];if(NS.isFunction(c)){this.callParent([a,c])}else{if(NS.isObject(c)){if(c.fn){this.callParent([a,c,c.scope||this])}}}}}}},removeListener:function(b){var a=this["events"]||{};if(NS.isString(b)){delete a[b];this.component.removeListener(b)}},on:function(f,d,c,a){var g,e;if(NS.isString(f)){g="on"+NS.String.capitalize(f);if(this[g]){this[g]()}this.callParent(arguments)}else{if(NS.isObject(f)){for(var b in f){g="on"+NS.String.capitalize(b);if(this[g]){this[g]()}e=f[b];if(NS.isFunction(e)){this.callParent([b,e])}else{if(NS.isObject(e)){if(e.fn){this.callParent([b,e,e.scope||this])}}}}}}},initData:NS.emptyFn,initComponent:function(a){this.component=new Ext.Component(a)},addPackContainer:function(){this.component.NSContainer=this},getLibComponent:function(){return this.component},processExtPlugins:function(e){if(e){var c=e.plugins;var b=[];var d=this.nsPlugins=[];if(NS.isArray(c)){for(var f=0,a=c.length;f<a;f++){var g=c[f];if(g.getLibComponent){b.push(g.getLibComponent())}else{d.push(g)}}}else{if(NS.isObject(c)){if(c.getLibComponent){b.push(c.getLibComponent())}else{d.push(c)}}}e.plugins=b}},processNSPlugins:function(){if(this.nsPlugins){var b=this.nsPlugins;for(var c=0,a=b.length;c<a;c++){var d=b[c];d.init(this)}delete this.nsPlugins}},setComponent:function(a){this.component=a;return this},destroy:function(){this.component.destroy();for(var a in this){if(a){delete this[a]}}},render:function(a){this.component.render(a)},show:function(){this.component.show()},showAt:function(a,c,b){this.component.showAt(a,c,b)},hide:function(){this.component.hide()},isHidden:function(){return this.component.isHidden()},setWidth:function(a){this.component.setWidth(a)},setHeight:function(a){this.component.setHeight(a)},setDisabled:function(a){this.component.setDisabled(a)},isDisabled:function(){return this.component.isDisabled()},updateHtml:function(a){this.component.update(a)},refreshTplData:function(a){this.component.update(a)},focus:function(){this.component.focus()},getEl:function(){return new NS.dom.Element(this.component.getEl().dom)},setPosition:function(a,c,b){this.component.setPosition(a,c,b)},getWidth:function(){return this.component.el.getWidth()},getHeight:function(){return this.component.el.getHeight()},getX:function(){return this.component.el.getX()},getY:function(){return this.component.el.getY()},contains:function(a){return this.component.el.contains(a)}});NS.define("NS.Img",{extend:"NS.Component",initComponent:function(a){this.component=Ext.create("Ext.Img",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping("src")},setSrc:function(a){this.component.setSrc(a)}});NS.define("NS.Template",{constructor:function(){var s="",cls=Ext.XTemplate;for(var i=0;i<arguments.length;i++){var item=arguments[i];s+="arguments["+i+"],"}s=s.substr(s,s.length-1);this.tpl=eval("new cls("+s+");")},writeTo:function(b,c){if(NS.isNSComponent(b)){var a=b.getLibComponent();this.tpl.overwrite(a.el,c)}else{if(b instanceof NS.dom.Element){this.tpl.overwrite(b.dom,c)}else{if(NS.isString(b)){this.tpl.overwrite(b,c)}else{if(NS.isElement(b)){this.tpl.overwrite(b,c)}}}}},insertFirst:function(b,c){if(NS.isNSComponent(b)){var a=b.getLibComponent();this.tpl.insertFirst(a.el,c)}else{if(b instanceof NS.dom.Element){this.tpl.insertFirst(b.dom,c)}else{if(NS.isString(b)){this.tpl.insertFirst(b,c)}else{if(NS.isElement(b)){this.tpl.insertFirst(b,c)}}}}},insertBefore:function(b,c){if(NS.isNSComponent(b)){var a=b.getLibComponent();this.tpl.insertBefore(a.el,c)}else{if(b instanceof NS.dom.Element){this.tpl.insertBefore(b.dom,c)}else{if(NS.isString(b)){this.tpl.insertBefore(b,c)}else{if(NS.isElement(b)){this.tpl.insertBefore(b,c)}}}}},insertAfter:function(b,c){if(NS.isNSComponent(b)){var a=b.getLibComponent();this.tpl.insertAfter(a.el,c)}else{if(b instanceof NS.dom.Element){this.tpl.insertAfter(b.dom,c)}else{if(NS.isString(b)){this.tpl.insertAfter(b,c)}else{if(NS.isElement(b)){this.tpl.insertAfter(b,c)}}}}}});NS.define("NS.Plugin",{init:NS.emptyFn});NS.define("NS.button.Button",{extend:"NS.Component",initComponent:function(a){this.component=new Ext.button.Button(a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({text:true,name:true,handler:true,iconCls:true})},onClick:function(){this.component.on("click",function(a,b){NS.Event.setEventObj(b);this.fireEvent("click",this,NS.Event)},this)},setText:function(a){this.component.setText(a)},getText:function(){return this.component.getText()},setIconCls:function(a){this.component.setIconCls(a)}});NS.define("NS.Editor",{extend:"NS.Component",initComponent:function(b){var a={updateEl:true};this.component=new Ext.Editor(a)},initConfigMapping:function(){this.callParent();var a=function(d,c,b){b[c]=d.getLibComponent()};this.addConfigMapping({updateEl:true,field:true,offsets:true})},initEvents:function(){this.callParent();this.addEvents("complete")},onComplete:function(){this.component.on("complete",function(b,c,a){this.fireEvent("complete",this,c,a,this.component.boundEl)},this)},startEdit:function(a){this.component.startEdit(a)},cancelEdit:function(){this.component.cancelEdit()}});NS.define("NS.mask.LoadMask",{extend:"NS.Component",initComponent:function(a){this.config=a;var b=a.target;if(NS.isNSComponent(b)){b=b.getLibComponent();this.component=Ext.create("Ext.LoadMask",b,{msg:a.msg||"加载中..."})}else{if(NS.isNSElement(b)){this.component=b.element}}},initConfigMapping:function(){this.callParent();this.addConfigMapping({target:true,msg:true})},show:function(){if(this.component instanceof Ext.LoadMask){this.component.show()}else{if(this.component instanceof Ext.dom.Element){this.component.mask(this.config.msg)}}},hide:function(){if(this.component instanceof Ext.LoadMask){this.component.hide()}else{if(this.component instanceof Ext.dom.Element){this.component.unmask()}}}});NS.define("NS.container.Container",{extend:"NS.Component",constructor:function(a){this.procressItems(a);this.callParent(arguments)},initConfigMapping:function(){this.callParent();this.addConfigMapping({layout:true,items:true})},initComponent:function(a){this.component=new Ext.container.Container(a)},initEvents:function(){this.callParent()},add:function(b){if(NS.isArray(b)){var d=[];for(var c=0;c<b.length;c++){var a=b[c];if(NS.isNSComponent(a)){d.push(a.getLibComponent())}}this.component.add(d)}else{if(NS.isNSComponent(b)){this.component.add(b.getLibComponent())}}return b},remove:function(b,a){this.component.remove(b.getLibComponent(),a);return b},insert:function(b,a){this.component.insert(b,a.getLibComponent())},removeAll:function(a){this.component.removeAll(a)},getComponent:function(b){var a=this.component.getComponent(b);return NS.util.ComponentInstance.getInstance(a)},doLayout:function(){this.component.doLayout()},queryComponentByName:function(b){var d='component[name="{0}"]';var c=this.component.query(NS.String.format(d,b));if(c.length==1){var a=c[0];return NS.util.ComponentInstance.getInstance(a)}else{NS.error({sourceClass:this.$classname,sourceMethod:"queryComponentByName",msg:"查询到name为"+b+"的组件共有"+c.length+"个"})}},queryComponentsByName:function(c){var g='component[name="{0}"]',e=this.component.query(NS.String.format(g,c)),d=0,a=e.length,b,f=[];for(;d<a;d++){b=e[d];f.push(NS.util.ComponentInstance.getInstance(b))}return f},bindItemsEvent:function(c,g,f,e){var b,d,h=arguments[0],a;if(NS.isString(c)&&NS.isString(g)&&NS.isFunction(f)){b=this.queryComponentByName(c);if(!b){NS.error({sourceClass:this.$classname,sourceMethod:"bindItemsEvent",msg:"没有找到对应的组件，绑定事件的组件的名称为:"+c})}b.on(g,f,e)}else{if(arguments.length==1&&NS.isObject(h)){for(d in h){b=this.queryComponentByName(d);if(!b){NS.error({sourceClass:this.$classname,sourceMethod:"bindItemsEvent",msg:"没有找到对应的组件，绑定事件的组件的名称为:"+c})}a=h[d];b.on(a.event,a.fn,a.scope||this)}}}},procressItems:function(b){if(b){var a=b.items||[],c;this.processChildItems(b)}},processChildItems:function(c){var b=c.items,e;if(NS.isArray(b)){for(var d=0,a=b.length;d<a;d++){e=b[d];if(e.getLibComponent){b[d]=e.getLibComponent()}else{if(NS.isObject(e)){if(e.items){arguments.callee(e)}if(e.tbar){e.tbar=e.tbar.getLibComponent()}}}}}else{if(NS.isNSComponent(b)){c.items=b.getLibComponent()}else{if(NS.isObject(b)){if(b.items){arguments.callee(b)}if(b.tbar){b.tbar=b.tbar.getLibComponent()}}}}}});NS.define("NS.container.Panel",{extend:"NS.container.Container",initConfigMapping:function(){this.callParent();var a=function(e,d,c){c[d]=e.getLibComponent()},b=function(e,d,c){c[d]=e;c.preventHeader=!e};this.addConfigMapping({buttonAlign:true,buttons:true,title:true,closable:true,closeAction:true,collapsible:true,collapsed:true,collapseDirection:true,tbar:a,bodyCLs:true,header:b,plain:true,bbar:a,lbar:a,rbar:a,buttons:true,frame:true,bodyStyle:true})},initComponent:function(a){this.component=Ext.create("Ext.panel.Panel",a)},addHtml:function(b){var a=this.panel.body.html;this.panel.body.update(a+b)},clearHtml:function(){this.panel.body.update("")},setTitle:function(a){this.component.setTitle(a)},show:function(){this.component.show()},close:function(){this.component.close()}});NS.define("NS.container.TabPanel",{extend:"NS.container.Panel",initComponent:function(a){this.component=Ext.create("Ext.tab.Panel",a)},setActiveTab:function(a){this.component.setActiveTab(a.getLibComponent())},getActiveTab:function(){var a=this.component.getActiveTab();return NS.util.ComponentInstance.getInstance(a)}});NS.define("NS.container.Tree",{extend:"NS.container.Panel",initComponent:function(c){var a=this;this.configObj=c;this.configFilter(c);var b=Ext.create("Ext.data.TreeStore",{root:c.root});delete c.root;c.store=b;this.component=Ext.create("Ext.tree.Panel",c);this.editor=new Ext.tree.TreeEditor({updateEl:true,field:{xtype:"textfield"}});this.modifyValue={};this.editor.addListener("complete",function(e,g,d){var f=e.editorNode,h=f.data.id;a.modifyValue[h]=g;f.set("text",g)});this.initMyEvent(c)},configFilter:function(a){if(a.filter){this.filterSet(a)}if(a.multiple==true&&typeof a.multyFields!="undefined"){this.multipleSet(a)}this.translate(a);a.useArrows=(typeof a.useArrows!="undefined")?a.useArrows:true},initConfigMapping:function(){this.callParent();this.addConfigMapping({checkable:{name:"checkable"},treeData:{name:"treeData"},rootVisible:{name:"rootVisible"},multyFields:{name:"multyFields"},multiple:{name:"multiple"},filter:{name:"filter"},iconClsCfg:{name:"iconClsCfg"},useArrows:{name:"useArrows"},treeEditor:{name:"treeEditor"}})},initEvents:function(){this.callParent();this.addEvents("itemclick","itemcontextmenu")},onItemclick:function(){this.component.on("itemclick",function(b,a,c){var d=a.data;NS.applyIf(d,a.raw);this.fireEvent("itemclick",this,d,c)},this)},onItemcontextmenu:function(){this.component.on("itemcontextmenu",function(b,a,d,c,f){this.fireEvent("itemcontextmenu",this,a,a,d,c,f)},this)},translate:function(g){var d=Boolean(g.checkable),b=g.treeData,c={},j=0,a=null,e={},m=null;if(b instanceof Array){b.push({children:[],text:"",expanded:true,id:0});if(b.length==0){this.configObj.root={text:"根节点",expanded:true,children:[]}}for(var f=0,h=b.length;f<h;f++){a=b[f];e={pid:a.fjdId||a.fjdid,text:a.mc,expanded:a.expanded!=undefined?a.expanded:false,leaf:a.leaf!=undefined?a.leaf:false,children:[],id:a.id,cc:a.cc,cclx:a.cclx};if(g.iconClsCfg){e.iconCls=g.iconClsCfg[a.cclx]}NS.applyIf(e,a);if(d){e.checked=Boolean(Number(a.checked))}c[a.id]=e}for(var l in c){m=c[l];var k=m.pid;if(c[k]){c[k].children.push(m);c[k].leaf=false}else{j=m.id}}this.configObj.root=c[j]}else{this.configObj.root=b}},multipleSet:function(h){var b=new Array();var f=new Array();var g=h.multyFields;if(h.multiple&&g){for(var e=0,a=g.length;e<a;e++){var d=g[e];var c={text:d.columnName,width:d.width||200,dataIndex:d.dataIndex,hidden:d.hidden||false};if(d.dataIndex=="text"){c.xtype="treecolumn"}b.push(d.dataIndex);f.push(c)}h.fields=b;h.columns=f}},filterSet:function(c){var b=this;if(c.filter){var a=c.filter.field||"text";var d={xtype:"trigger",triggerCls:"x-form-clear-trigger",onTriggerClick:function(){this.setValue("")},enableKeyEvents:true,listeners:{keyup:{buffer:150,fn:function(j,h){if(Ext.EventObject.ESC==h.getKey()&&!this.getRawValue()){j.onTriggerClick()}else{var k=this.getRawValue();var g=new RegExp(".*"+k+".*","i");var f=b.component.getRootNode();b.component.getStore().setRootNode(f)}}}}};c.tbar=[c.filter.labelName||"过滤",d]}},initMyEvent:function(d){var b=this;var c=function(f,e){f.expand();f.set("checked",e);f.eachChild(function(g){g.set("checked",e);c(g,e)})};var a=function(h,g){var e=h.parentNode;if(g&&e){e.set("checked",g);arguments.callee(e,g)}else{if(e){var f=0;e.eachChild(function(j){if(j.get("checked")){f++}});if(f==0){e.set("checked",false)}}}};this.component.addListener("checkchange",function(g,f,e){c(g,f);a(g,f)},this.component);if(d.treeEditor){this.component.addListener("itemdblclick",function(g,f,j,h,k){var l=Ext.fly(j).down("div");b.editor.startEdit(l,f.getData().text);b.editor.editorNode=f},this.component)}},requestTransfer:function(a){this.component.addListener("beforeitemexpand",function(g,c,f,e){if(this.configObj.serviceKey){return}var d=g.data;if(g.childNodes.length==0&&d.leaf==false){var b=new NS.mvc.Model();var h={id:d.id,parendId:d.parendId,text:d.text,leaf:d.leaf};b.callService([{key:this.serviceKey,params:h}],function(j){if(j[this.serviceKey] instanceof Array){g.appendChild(this.translateForExpendEvent(j[this.serviceKey]))}},this)}},this)},translateForExpendEvent:function(f){var c=0,b=new Array(),a=f.length,e={},d=null;for(;c<a;c++){d=f[c];e={pid:d.fjdId,text:d.mc,expanded:true,leaf:d.sfyzjd==0?false:true,children:[]};b.push(e)}return b},itemRightClickFun:function(b,a,d,c,f){f.preventDefault();f.stopEvent();Ext.create("Ext.menu.Menu",{width:60,margin:"0 0 10 0",floating:true,items:[{iconCls:"page-expand",text:"展开",disabled:a.data.leaf,handler:function(){var e=b.getStore();var g=e.treeStore.getNodeById(a.data.id);g.expand()}},{iconCls:"page-collapse",text:"收缩",disabled:a.data.leaf,handler:function(){var e=b.getStore();var g=e.treeStore.getNodeById(a.data.id);g.collapse()}}]}).showAt(f.getXY())},getChecked:function(){var c=this.component.getChecked(),b=new Array(),a=c.length,d=0;for(;d<a;d++){b.push(c[d].raw)}return b},getSelectionModel:function(){var a=this.component.getSelectionModel().getLastSelected();return a==null?null:a.raw},getCheckedLeaf:function(){var a=this.component.getChecked();result=new Array(),len=a.length,i=0;for(;i<len;i++){if(a[i].getData().leaf){result.push(a[i].raw)}}return result},refresh:function(a){this.configObj.treeData=a;this.translate(this.configObj);this.component.getStore().setRootNode(this.configObj.root)},getTbar:function(){var a=new NS.toolbar.Toolbar();a.component=this.component.getComponent("tbar");return a},getNodeDataById:function(c){var a=this.component.getStore(),b=a.getNodeById(c);return b.getData()},checkAllNode:function(){this.checkedChildren(this.component.getRootNode(),true)},checkedChildren:function(g,e){var h=g.childNodes;var d=h;if(d&&d.length>0){var b=[];while(d.length!=0){for(var f=0,a=d.length;f<a;f++){var j=d[f];j.set("checked",e);if(j.childNodes){b=b.concat(j.childNodes)}}d=b;b=[]}}},unCheckAllNode:function(){this.checkedChildren(this.component.getRootNode(),false)},expandAll:function(){this.component.expandAll()},collapseAll:function(){this.component.collapseAll()},getModifyValue:function(){var a=this.modifyValue,b=new Array();for(var c in a){b.push({id:c,text:a[c]})}return b}});NS.define("NS.container.SwitchContainer",{extend:"NS.container.Container",initConfigMapping:function(){this.callParent();this.addConfigMapping("defaultIndex")},initComponent:function(b){var a={layout:"card"};if(b.layout){delete b.layout}NS.apply(a,b);this.component=Ext.create("Ext.container.Container",a);if(!b.defaultIndex){b.defaultIndex=0}this.switchIndex(b.defaultIndex)},procressItems:function(d){var g=this.initMap={},c=d.items||[],e=0,a=c.length,f,b;for(e;e<a;e++){f=c[e];b=Ext.create("Ext.container.Container",{width:"100%",height:"100%",layout:"fit"});g[f.name]={scope:f.scope,name:f.name,init:f.init,index:e,isInit:false,container:b};c[e]=b}},getItemByIndex:function(b){var a=this.initMap,c,d;for(c in this.initMap){d=a[c];if(d.index==b){return d}}},switchTo:function(b,g,e){var d=this.component.getLayout(),c=this.initMap[b],a=c.container,f;if(c){d.setActiveItem(a);if(!c.isInit||e){f=NS.util.ComponentInstance.getInstance(a);c.init.call(c.scope||this,this,f,g||{});c.isInit=true}}},switchIndex:function(b,f){var d=this.component.getLayout(),c=this.getItemByIndex(b),a=c.container,e;if(c){d.setActiveItem(a);if(!c.isInit){e=NS.util.ComponentInstance.getInstance(a);c.init.call(c.scope||this,this,e,f||{});c.isInit=true}}}});NS.define("NS.container.TabSwitchContainer",{extend:"NS.container.Panel",initConfigMapping:function(){this.callParent();this.addConfigMapping("defaultIndex")},initComponent:function(a){this.component=Ext.create("Ext.tab.Panel",a);this.component.on("tabchange",function(b,c,d){this.switchTo(c.name)},this);if(!a.defaultIndex){a.defaultIndex=0}this.switchIndex(a.defaultIndex)},procressItems:function(d){var g=this.initMap={},c=d.items||[],e=0,a=c.length,f,b;for(e;e<a;e++){f=c[e];b=Ext.create("Ext.container.Container",{width:"100%",height:"100%",title:f.title,name:f.name,layout:"fit"});g[f.name]={scope:f.scope,name:f.name,init:f.init,index:e,isInit:false,container:b};c[e]=b}},switchTo:function(c,g,e){var b=this.component,d=this.initMap[c],a=d.container,f;if(d){b.setActiveTab(a);if(!d.isInit||e){f=NS.util.ComponentInstance.getInstance(a);d.init.call(d.scope||this,this,f,g);d.isInit=true}}},getItemByIndex:function(b){var a=this.initMap,c,d;for(c in this.initMap){d=a[c];if(d.index==b){return d}}},switchIndex:function(b,f){var d=this.component.getLayout(),c=this.getItemByIndex(b),a=c.container,e;if(c){d.setActiveItem(a);if(!c.isInit){e=NS.util.ComponentInstance.getInstance(a);c.init.call(c.scope||this,this,e,f||{});c.isInit=true}}},setActiveTab:function(a){this.component.setActiveTab(a.getLibComponent())},getActiveTab:function(){var a=this.component.getActiveTab();return NS.util.ComponentInstance.getInstance(a)}});NS.define("NS.tip.QuickTip",{extend:"NS.container.Panel",initComponent:function(a){var b={width:200,autoShow:true,shadow:false,bodyBorder:false,frameHeader:false,hideCollapseTool:true,overlapHeader:true,bodyBorder:false};NS.apply(b,a);this.component=Ext.create("Ext.tip.QuickTip",b)},initConfigMapping:function(){this.callParent();this.addConfigMapping({hideCollapseTool:true,overlapHeader:true,autoShow:true,dismissDelay:true,hideDelay:true})}});Ext.define("Ext.tree.TreeEditor",{extend:"Ext.Editor",constructor:function(a){a=Ext.apply({},a);if(a.field){a.field.monitorTab=false}this.callParent([a])},onShow:function(){var c=this,a=c.boundEl.first(),b,d;if(a){b=a.dom.lastChild;if(b&&b.nodeType===3){d=c.nodeTextNode=a.dom.lastChild;c.nodeTextValue=d.nodeValue;d.nodeValue="\u00a0"}}c.callParent(arguments)},getTextNode:function(a){var c=this,d,b;if(a){b=a.dom.lastChild;if(b&&b.nodeType===3){d=c.nodeTextNode=a.dom.lastChild;c.nodeTextValue=d.nodeValue;d.nodeValue="\u00a0"}}return d},onHide:function(){var b=this,a=b.boundEl,c=this.getTextNode(a);if(a&&b.nodeTextNode){c.nodeValue=b.nodeTextValue}b.callParent(arguments)},afterRender:function(){var a=this,b=a.field;a.callParent(arguments);if(b.isXType("checkboxfield")){b.mon(b.inputEl,{mousedown:a.onCheckBoxMouseDown,click:a.onCheckBoxClick,scope:a})}},onCheckBoxMouseDown:function(){this.completeEdit=Ext.emptyFn},completeEdit:function(a){var b=this,d=b.field,c;if(!b.editing){return}if(d.assertValue){d.assertValue()}c=b.getValue();if(!d.isValid()){if(b.revertInvalid!==false){b.cancelEdit(a)}return}if(String(c)===String(b.startValue)&&b.ignoreNoChange){b.hideEdit(a);return}if(b.fireEvent("beforecomplete",b,c,b.startValue)!==false){c=b.getValue();if(b.updateEl&&b.boundEl){var e=b.getTextNode(b.boundEl);e.nodeValue=c}b.hideEdit(a);b.fireEvent("complete",b,c,b.startValue)}},onShow:function(){var a=this;a.callParent(arguments);if(a.hideEl!==false){a.boundEl.hide()}a.fireEvent("startedit",a.boundEl,a.startValue)},onCheckBoxClick:function(){delete this.completeEdit;this.field.focus(false,10)},offsets:[15,0],alignment:"tl-tl",hideEl:false,cls:Ext.baseCSSPrefix+"small-editor "+Ext.baseCSSPrefix+"grid-editor",shim:false,shadow:false});NS.define("NS.toolbar.Toolbar",{extend:"NS.container.Container",initComponent:function(a){this.component=Ext.create("Ext.toolbar.Toolbar",a)},processChildItems:function(d){var f,b=d.items||[];if(NS.isArray(b)){for(var e=0,a=b.length;e<a;e++){f=b[e];if(NS.isNSComponent(f)){b[e]=f.getLibComponent()}else{if(f.items){b[e]=arguments.callee(f.items)}else{if(NS.isObject(f)){if(f.xtype=="button"){b[e]=new Ext.button.Button(f)}else{b[e]=NS.util.FieldCreator.createField(f)}}}}}return}else{if(NS.isNSComponent(b)){d.items=b.getLibComponent();return}else{if(NS.isObject(b)){var c=NS.util.FieldCreator.createField(f);if(c){d.items=f}else{if(b.xtype=="button"){d.items=new Ext.button.Button(f)}}return}}}},getValues:function(){var b=this.component.query("field"),e=0,g,a,c={},f,d;for(e,a=b.length;e<a;e++){g=b[e];f=g.getValue();d=g.name;if(f){c[d]=f}}return c},getValuesByName:function(e){var b=this.component.query("field"),f=0,h,a,d={},g,c;for(f,a=arguments.length;f<a;f++){d[arguments[f]]=undefined}for(f=0,a=b.length;f<a;f++){h=b[f];g=h.getValue();c=h.name;if(g&&d.hasOwnProperty(c)){d[c]=g;if(!d[c]){delete d[c]}}}return d},replace:function(a,b){},configMapping:function(){}});NS.define("NS.toolbar.EntityToolbar",{singleton:true,create:function(c){var e=c.data;this.initFieldsConfig(c);var b=this.processItems(c);var a={items:b};var d=new NS.toolbar.Toolbar(a);return d},processItems:function(a){var g=a.items||[],e=[],j,f=NS.Function.alias(NS.util.FieldCreator,"createField"),b,h;for(var c=0,d=g.length;c<d;c++){j=g[c];if(NS.isString(j)){b=this.getFieldConfig(j);h=f(this.fcMap[j],b)}else{if(NS.isObject(j)){h=j}else{if(NS.isNSComponent(j)){h=j.getLibComponent()}}}e.push(h)}return e},initFieldsConfig:function(b){var e=b.data;var f=this.fcMap={};for(var c=0,a=e.length;c<a;c++){var d=e[c];f[d.name]=d}},getFieldConfig:function(b){var c=this.fcMap[b],d=c.xtype;if(!c){NS.error({sourceClass:"NS.toolbar.EntityToolbar",sourceMethod:"getFieldConfig",msg:"name对应的组件没有查找到：name为"+b})}var a={width:200,labelWidth:60,fieldLabel:c.nameCh,maxLength:c.dbLength,readOnly:!c.editable};return a}});NS.define("NS.toolbar.MultiLineTbar",{extend:"NS.toolbar.Toolbar",initConfigMapping:function(){this.callParent();this.addConfigMapping("contentWidth")},initComponent:function(b){var a={margin:"1",items:{xtype:"container",layout:"column",items:b.items,defaults:{margin:"4"},width:b.contentWidth||"100%"}};delete b.items;delete b.contentWidth;NS.apply(a,b);this.component=Ext.create("Ext.toolbar.Toolbar",a)}});NS.define("NS.grid.Grid",{extend:"NS.container.Panel",initConfigMapping:function(){this.callParent();this.addConfigMapping("data","fields","modelConfig","columnConfig","columnData","columnLines","paging","multiSelect","disableSelect","lineNumber","defaultColumnConfig","checked")},initEvents:function(){this.callParent();this.addEvents("viewready","rowdbclick","rowclick","select","beforeload","load","beforeedit","afteredit")},onViewready:function(){this.component.on("viewready",function(b,a){this.fireEvent("viewready",this)},this)},onRowdbclick:function(){this.component.on("itemdblclick",function(b,a,d,c,f){NS.Event.setEventObj(f);this.fireEvent("rowdbclick",this,a.getData(),d,c,NS.Event)},this)},onRowclick:function(){this.component.on("itemclick",function(b,a,d,c,f){NS.Event.setEventObj(f);this.fireEvent("rowclick",this,a.getData(),d,c,NS.Event)},this)},onSelect:function(){this.component.on("select",function(c,a,b){this.fireEvent("select",this,a.getData(),b)},this)},onBeforeedit:function(){this.component.on("beforeedit",function(a,b){var c={name:b.column.dataIndex,rowIndex:b.rowIdx,colIndex:b.colIdx,originalValue:b.originalValue,value:b.value,data:b.record.getData()};this.record=b.record;this.fireEvent("beforeedit",this,c)},this)},onAfteredit:function(){this.component.on("edit",function(a,b){var c={name:b.column.dataIndex,rowIndex:b.rowIdx,colIndex:b.colIdx,value:b.value,originalValue:b.originalValue,data:b.record.getData()};this.record=b.record;this.fireEvent("afteredit",this,c)},this)},setEditRowValue:function(a,b){if(!this.record){return}this.record.set(a,b);this.record.save();this.record.commit()},getEditRowValue:function(a){return this.record.get(a)},initData:function(a){this.config=a;this.initLoader();this.initColumns();this.initStore()},initLoadMask:function(){this.loadmask=new Ext.LoadMask(this.component,{msg:"数据加载中,请稍等......"})},initLoader:function(){this.key=this.config.serviceKey;this.loader=this.config.proxy},initComponent:function(){this.initGrid.apply(this,arguments);this.initLoadMask()},initGrid:function(d){var f=this,c=this.store,e=this.columnManager.columns,a,g=this.config.columnData;var b={store:c,columns:e,layout:"fit",dockedItems:[]};if(d.checked){this.selModel=Ext.create("Ext.selection.CheckboxModel");NS.apply(b,{selModel:this.selModel});b.selModel.setSelectionMode(d.multiSelect===true?"MULTI":"SINGLE")}if(d){NS.apply(b,d)}if(!this.config.hasOwnProperty("paging")||this.config.paging){a=this.initPagingBar();b.dockedItems.push(a)}this.component=Ext.create("Ext.grid.Panel",b)},setHeadStyle:function(f,d,e){var a=this.component,c=this.getExtColumn(f);if(c){var b=c.getEl();b.setStyle(d,e)}},setCellStyle:function(e,h,b,f){var a=this.component,d=a.getView(),j=d.getNode(e),c=this.getExtColumn(h),g;g=Ext.fly(j).down(c.getCellSelector());Ext.fly(g).setStyle(b,f)},setColumnStyle:function(l,b,g){var a=this.component,h=this.store,f=a.getView(),e=h.getCount(),c=this.getExtColumn(l),k,j;for(var d=0;d<e;d++){k=f.getNode(d);j=Ext.fly(k).down(c.getCellSelector());Ext.fly(j).setStyle(b,g)}},setRowStyle:function(a,d,e){var c=this.component;var b=c.getView();var f=b.getNode(a);if(f){Ext.fly(f).setStyle(d,e)}},setPageRowCount:function(b){var a=this.store;a.pageSize=b;a.load()},setSelectRows:function(){var b=this.component;var a=b.getSelectionModel();NS.Array.each(arguments,function(c){a.select(c,true)})},setUnOrSelectRows:function(a,c){var d=this.component;var b=d.getSelectionModel();if(NS.isNumber(a)){b.select(a,c)}else{if(NS.isArray(a)){NS.Array.each(a,function(e){b.select(e,c)})}}},getSelectRows:function(){var c=[];var b=this.component;var a=b.getSelectionModel().getSelection();NS.Array.each(a,function(d){c.push(d.data)});return c},getSelectCount:function(){var b=this.component;var a=b.getSelectionModel().getSelection();return a.length},getCellData:function(f,e){var c=this.component,b=this.store,a=b.getAt(f),d=this.getExtColumn(e);return a.get(d.dataIndex)},setCellData:function(g,f,e){var c=this.component,b=this.store,a=b.getAt(g),d=this.getExtColumn(f);if(a){a.set(d.dataIndex,e)}},getCount:function(){return this.store.getCount()},getModifyCount:function(a){return this.getModify(a).length},addColumn:function(c,b){var a=this.component.columns},setPictureByRow:function(h,g,c,f){var b=this.component,a=grid.getView(),d=this.getExtColumn(h),e=a.getNode(g);cell=Ext.fly(e).down(d.getCellSelector());Ext.fly(cell).setStyle("background-image","url("+c+")");Ext.fly(cell).addListener("click",f)},getExtColumn:function(e){var b=this.component.columns,d,c,a;if(typeof e=="number"){c=b[e]}else{if(typeof e=="string"){NS.Array.each(b,function(f){if(f.dataIndex==e){c=f;return false}})}}return c},getColumn:function(c){var b=this.getExtColumn(c),a;return NS.util.ComponentInstance.getInstance(b)},getColumnEditor:function(b){var a=this.getColumn(b);return a.getEditor()},setColumnValidate:function(e,c,d){var b=this.getExtColumn(e);var a=b.getEditor()||b.editor;a.regex=c;a.regexText=d},setColumnFormat:function(c,b){var a=this.getExtColumn(c);a.format=b},setColumnType:function(c,b){var a=this.getExtColumn(c);a.type=b},setColumnData:function(e,a,d){var c=this.getExtColumn(e),b=c.getEditor();if(b=="combobox"){b.getStore().loadData(d)}else{}},setColumnHidden:function(c,a){var b=this.getExtColumn(c);if(a){b.hide()}else{b.show()}},setColumnDataOnTree:function(b,a){},getExtColumnType:function(b){var a=this.getExtColumn(b);return a.type},addRow:function(g,d,h){var e=this.component,b=this.store,d=d||0,c=b.model,f=e.plugins[0]||undefined,a;if(g){a=c.create(g)}else{a=c.create()}b.insert(0+d,a);if(f){f.cancelEdit();f.startEdit(a,h||1)}},addRows:function(a){var b=this;NS.Array.each(a,function(d,c){b.addRow(d,c)})},insertRow:function(b,c,a){this.addRow(b,c,a)},insertRows:function(a,d,b){var c=this;NS.Array.each(a,function(f,e){c.insertRow(f,d+e,b)})},deleteRow:function(b){var a=this.store.getAt(b);this.store.remove(a)},deleteRows:function(){var a=this,b=arguments;NS.Array.each(b,function(c){a.deleteRow(c)})},removeSelectRows:function(){var b=this.component,a=b.getStore(),c=b.getSelectionModel();a.remove(c.getSelection())},clear:function(){this.store.removeAll()},getRow:function(b){var a=this.store.getAt(b);return a.getData()},getRows:function(){var a=this,b=[];NS.Array.each(arguments,function(c){b.push(a.getRow(c))});return b},findRow:function(e,d){var b=this,a=this.component.getStore(),c=[];a.each(function(h,f,g){if(h.get(e)==d){c.push(h.getData())}});return c},findRowIndex:function(e,d){var b=this,a=this.component.getStore(),c=[];a.each(function(h,f,g){if(h.get(e)==d){c.push(f)}});return c},getRowById:function(b){var a=this.component.getStore();a.each(function(e,c,d){if(e.get("id")==b){return e.getData()}})},getRowIndexById:function(c){var a=this.component.getStore();var b;a.each(function(f,d,e){if(f.get("id")==c){b=d}});return b},getFirstSelectIndex:function(){var a=this.component.getSelectionModel().getSelection();var b=this.component.store.data;if(a.length>0){return b.indexOf(a[0])}else{return -1}},getAllSelectIndex:function(){var a=this.component.getSelectionModel().getSelection();var b=this.component.store.data;var c=[];NS.Array.forEach(function(d){c.push(b.indexOf(d))});return c},getAllRow:function(){var a=[];NS.Array.each(this.component.store.data.items,function(b){a.push(b.data)});return a},getModify:function(b){var a=this.store,c=[];if(b=="update"){records=a.getUpdatedRecords()}else{if(b=="insert"){records=a.getNewRecords()}else{if(b=="delete"){records=a.getRemovedRecords()}else{records=a.getModifiedRecords()}}}NS.Array.each(records,function(d){c.push(d.data)});return c},initStore:function(){var b=this.config.modelConfig,c;if(b){c=b.data}else{c=this.config.data}this.queryParam={};var a={fields:this.getFields(this.config),proxy:{type:"memory"},pageSize:this.config.pageSize||25,autoLoad:false};this.store=Ext.create("Ext.data.Store",a);if(c&&c.data){this.loadData(c,1)}},getFields:function(c){var b=[],f=c.columnData||[],h=c.fields||[],e;var g=function(j){switch(j){case"String":return"string";case"Long":return"int"}};for(var d=0,a=f.length;d<a;d++){e=f[d];b.push({name:e.name})}for(var d=0,a=h.length;d<a;d++){e=h[d];if(NS.isString(e)){b.push({name:e})}else{if(NS.isObject(e)){b.push(e)}}}return b},initColumns:function(){var a={data:this.config.columnData,columnConfig:this.config.columnConfig,lineNumber:this.config.lineNumber,defaultConfig:this.config.defaultColumnConfig};this.columnManager=new NS.grid.ColumnManager(a)},loadData:function(b,c){var a=this.store;if(NS.isObject(b)){if(b.success==false){NS.error({sourceClass:"NS.grid.Grid",sourceMethod:"loadData",msg:"加载数据异常，数据不是grid所需要的格式！"});a.loadRawData([]);return}a.loadRawData(b.data);a.totalCount=b.count}else{if(NS.isArray(b)){a.loadRawData(b);a.totalCount=b.length}}a.currentPage=c||1;this.fireEvent("load",b);if(this.pbar){this.pbar.onLoad()}},registerDataLoader:function(b,a){this.loader=a;this.key=b},load:function(b){var c=b||{};var a=this.fireEvent("beforeload",this,c);this.getData(a||(c||{}),1);if(this.selModel){this.selModel.setLocked(false)}},refresh:function(){var a=this.store.currentPage;this.getData(this.queryParams,a)},getData:function(g,f){if(this.component.rendered){this.loadmask.show()}this.component.getSelectionModel().deselectAll(true);var e=this,d=NS.clone(this.key),a={},c=this.store.pageSize,b={};this.queryParams=g;if(NS.isString(d)){b=g;a={key:d,params:b||{}}}else{if(NS.isObject(d)){if(d.params){NS.apply(b,d.params);NS.apply(b,g||{})}else{b=g||{}}a={key:d.key,params:b}}}if(!a.params){a.params={}}if(!a.params.start){a.params.start=0*c;a.params.limit=1*c}this.loader.callService(a,function(h){this.loadData(h[a.key],f);this.loadmask.hide()},this)},initPagingBar:function(){var b=this,a=this;this.pbar=Ext.create("Ext.toolbar.Paging",{store:this.store,dock:"bottom",displayInfo:true,moveFirst:function(){var c=0,e={start:c*this.store.pageSize,limit:this.store.pageSize},d=b.getParams();NS.applyIf(e,d);b.getData(e,c+1)},movePrevious:function(){var c=this.store.currentPage-2,e={start:c*this.store.pageSize,limit:this.store.pageSize},d=b.getParams();NS.applyIf(e,d);b.getData(e,c+1)},moveNext:function(){var c=this.store.currentPage,e={start:c*this.store.pageSize,limit:this.store.pageSize},d=b.getParams();NS.applyIf(e,d);b.getData(e,c+1)},moveLast:function(){var d=this.store,c=d.getTotalCount(),e=Math.ceil(c/d.pageSize),f=b.getParams();var g={start:(e-1)*this.store.pageSize,limit:this.store.pageSize};NS.applyIf(g,f);b.getData(g,e)},doRefresh:function(){var d=b.getParams(),c=this.store.currentPage,e={start:(c-1)*this.store.pageSize,limit:this.store.pageSize};this.store.currentPage=c;NS.applyIf(e,d);b.getData(e,c)},onPagingKeyDown:function(l,g){var j=this,f=g.getKey(),c=j.getPageData(),m=g.shiftKey?10:1,h,n,d;if(f==g.RETURN){g.stopEvent();h=j.readPageFromInput(c);if(h!==false){h=Math.min(Math.max(1,h),c.pageCount);if(j.fireEvent("beforechange",j,h)!==false){n={start:(h-1)*this.store.pageSize,limit:this.store.pageSize},d=a.getParams();NS.applyIf(n,d);a.getData(n,h)}}}else{if(f==g.HOME||f==g.END){g.stopEvent();h=f==g.HOME?1:c.pageCount;l.setValue(h)}else{if(f==g.UP||f==g.PAGE_UP||f==g.DOWN||f==g.PAGE_DOWN){g.stopEvent();h=j.readPageFromInput(c);if(h){if(f==g.DOWN||f==g.PAGE_DOWN){m*=-1}h+=m;if(h>=1&&h<=c.pageCount){l.setValue(h)}}}}}}});return this.pbar},getParams:function(){return this.queryParams||{}},getQueryParams:function(){var b=this.key,c=this.getParams(),a={};if(NS.isObject(b)){NS.apply(a,c,b.params||{})}else{NS.apply(a,c)}return a},getShowColumnNames:function(){var a=this.component.columns;var b=[];Ext.each(a,function(c){if(c&&c.dataIndex!=""&&c.dataIndex!=null&&c.hidden==false){b.push(c)}});return b}});NS.define("NS.grid.SimpleGrid",{extend:"NS.grid.Grid",initColumns:function(){NS.apply(this.config,{defaultColumnConfig:{style:{color:"white",background:"#3598FE",overCls:""},onTitleMouseOver:NS.emptyFn}});this.callParent()},initComponent:function(){this.callParent(arguments);if(this.component.headerCt.style){NS.apply(this.component.headerCt.style,{background:"#3598FE"})}else{this.component.headerCt.style={background:"#3598FE"}}this.onRowclick()},initPagingBar:function(){var b=this,a=this;this.pbar=Ext.create("Ext.toolbar.NumberPaging",{store:this.store,dock:"bottom",displayInfo:true});this.pbar.on("linkclick",function(c){var e=c,g={start:(e-1)*this.store.pageSize,limit:this.store.pageSize},f=b.getParams();NS.applyIf(g,f);var d=b.fireEvent("beforeload",b,g);b.getData(d||(g||{}),e)});return this.pbar},onRowclick:function(){this.component.on("itemclick",function(b,a,d,c,f){NS.Event.setEventObj(f);this.fireEvent("rowclick",this,a.getData(),d,c,NS.Event)},this)}});NS.define("NS.grid.ColumnManager",{constructor:function(a){this.config=a;this.initColumns()},data:[],initColumns:function(){var a=this.config.data;this.generateColumns(a||[]);this.dealWithColumnConfig()},dealForceFit:function(){var a=this.columns.length;if(a>0){delete this.columns[a-1].width;this.columns[a-1].flex=1;this.columns[a-1].align="left"}},dealWithColumnConfig:function(){var b=this.config.columnConfig;if(!this.columnset){this.columnset={};this.columns=[]}if(NS.isArray(b)){for(var d=0,a=b.length;d<a;d++){var f=b[d];if(f&&f.name&&!this.columnset[f.name]){var e=this.generateColumn1(f);this.registerColumn(e,f.name,f.index)}}}},makeAssociate:function(){var b=this.columns;var c=new Object();Ext.each(b,function(d){var e=d.codeEntityName;if(e=="tree"&&c[e]&&e){c[e].push(d)}else{if(!c[e]&&e){c[e]=[];c[e].push(d)}}});for(var a in c){if(a&&c[a] instanceof Array){c[a].sort(function(e,d){if(e.cc>d.cc){return 1}if(e.cc<d.cc){return -1}return 0})}}for(var a in c){if(a&&c[a] instanceof Array){this.associate(c[a])}}},associate:function(g){var h=this;for(var c=0;c<g.length;c++){if(c==g.length-1){return}var b=g[c];var a=g[c+1];var f=b.editor;var e=a.editor;if(f==null){return}var j;var d;f.addListener("select",function(m,k){d=k[0].get("id");j=h.filterAndSetComboBoxData(d,a);e.getStore().loadData(j);e.setValue();var l=b.up("gridpanel");var n=null;l.on("beforeedit",function(t,s){if(e==s.column.getEditor()){if(f.getValue()==""||f.getValue()==null){Ext.Msg.alert("提示","请先选择｛"+b.text+"}信息");t.cancelEdit();t.startEdit(s.record,b)}else{var r=s.record.get(a.dataIndex);var q=e.getStore();var p=q.getById(r);if(r!=""){if(!p){if(h.getParentId(r,a)==s.record.get(b.dataIndex)){e.getStore().loadData(h.getStoreDataById(r,a));e.setValue(r)}}}else{if(s.record.get(b.dataIndex)!=""){e.getStore().loadData(h.filterAndSetComboBoxData(s.record.get(b.dataIndex),a))}}}}})});e.addListener("focus",function(k){})}},getParentId:function(d,b){var c=b.data;var e;for(var a=0;a<c.length;a++){if(c[a].id==d){e=c[a].pid;break}}return e},getStoreDataById:function(d,b){var c=b.data;var f=[];var e=this.getParentId(d,b);for(var a=0;a<c.length;a++){if(c[a].pid==e){f.push(c[a])}}return f},filterAndSetComboBoxData:function(f,c){var a=(c.editor||c.getEditor()).getStore();var d=c.data;var e=[];for(var b=0;b<d.length;b++){if(d[b].pid==f){e.push(d[b])}}a.loadData(e);return e},generateColumns:function(d){if(this.config.lineNumber){this.registerColumn(this.generateColumn1({xtype:"rownumberer",text:""}))}for(var b=0,a=d.length;b<a;b++){var c=this.generateColumn(d[b]);this.registerColumn(c)}},registerColumn:function(c,b,a){if(!this.columnset){this.columnset={};this.columns=[]}if(c){if(b){this.columnset[b]=c}else{this.columnset[c.dataIndex]=c}if(a){this.columns=NS.Array.insert(this.columns,c.index,c)}else{this.columns.push(c)}}},generateColumn1:function(b){var a={width:b.width||70,dataIndex:b.name,sortable:false,draggable:false};if(b.flex==1){delete a.width}if(b.editor){if(NS.isNSComponent(b.editor)){b.editor=b.editor.getLibComponent()}}if(b.renderer){b.renderer=this.processRenderer(b.renderer)}NS.apply(a,b,this.config.defaultConfig);switch(b.xtype){case"buttoncolumn":return Ext.create("Ext.grid.column.ButtonColumn",a);case"linkcolumn":return Ext.create("Ext.grid.column.LinkColumn",a);case"rownumberer":var c={text:""};NS.apply(c,this.config.defaultConfig);return Ext.create("Ext.grid.RowNumberer",c);case"progresscolumn":return Ext.create("Ext.grid.column.ProgressColumn",b);default:return Ext.create("Ext.grid.column.Column",a)}},generateColumn:function(c){if(!c.isColumnCreate){return null}var a=this.getConfigColumn(c.name);var d=NS.util.FieldCreator.createField(c,a.editorConfig||{});this.registerField(c.name,d);var b={hidden:!(c.isColumnShow),codeEntityName:c.codeEntityName,cc:c.cc,width:c.columnWidth||70,sortable:false,draggable:false,header:c.nameCh,dataIndex:c.name,align:"center",renderer:this.getRender(c),editor:d};NS.apply(b,a,this.config.defaultConfig);if(b.flex==1){delete b.width}if(b.editor){this.registerField(c.name,b.editor)}if(a.renderer){b.renderer=this.processRenderer(a.renderer)}if(a.columnStyle){b.renderer=this.processRendererStyle(b)}if(c.editable===false||b.editable===false){delete b.editor}switch(b.xtype){case"buttoncolumn":return Ext.create("Ext.grid.column.ButtonColumn",b);case"linkcolumn":return Ext.create("Ext.grid.column.LinkColumn",b);case"progresscolumn":return Ext.create("Ext.grid.column.ProgressColumn",b);default:return Ext.create("Ext.grid.column.Column",b)}},processRenderer:function(a){return function(e,c,b,f,d){return a.call(this.NSContainer,e,b.data,f,d)}},processRendererStyle:function(a){var d=this,c=a.columnStyle,b=d.generateStyleString(c),e=a.renderer;return function(){return"<div style='width:100%;height:100%;"+b+"'>"+e.apply(this,arguments)+"</div>"}},generateStyleString:function(c){var b="";for(var a in c){b+=a+":"+c[a]+";"}return b},getConfigColumn:function(c){var f=this.config.columnConfig||[],e,b={};for(var d=0,a=f.length;d<a;d++){e=f[d];if(e.name==c){b=e;break}}if(b.editor){if(NS.isNSComponent(b.editor)){b.editor=b.editor.getLibComponent()}}return b},getRender:function(b){var a=this,c;switch(b.xtype){case"combobox":c=function(h,g,d,j,e){var f=this.columns[e].dataIndex;return a.getComboxDisplayValue(h,d,f)};break;case"treecombobox":c=function(h,g,d,j,e){var f=this.columns[e].dataIndex;return a.getTreeComDisplayValue(h,d,f)};break;case"tree":c=function(h,g,d,j,e){var f=this.columns[e].dataIndex;return a.getComboxDisplayValue(h,d,f)};break;case"checkbox":c=function(g,f,d,h,e){if(g=="true"||g=="1"){return"是"}else{return"否"}};break;case"datefield":c=function(h,g,d,j,f){var e=h;if(h instanceof Date){e=Ext.util.Format.date(h,"Y-m-d");d.set(this.columns[f].dataIndex,e)}return e};break;default:c=function(d){return d};break}return c},getField:function(a){return this.fieldset[a]},registerField:function(a,b){if(!this.fieldset){this.fieldset={};this.fieldlist=[]}this.fieldset[a]=b;this.fieldlist.push(b)},getComboxDisplayValue:function(h,d,g){if(h!=""||h!=null){var b=this.getField(g);var e=b.displayField;var k=b.valueField;var j=b.getStore();var c=j.findRecord(k,new RegExp("^"+h+"$"));if(c!=null){var f=c.get(b.displayField);var a=c.get(k);d.data[g]=a;return f}else{return h}}else{return h}},getTreeComDisplayValue:function(h,a,e){var g=this;if(h!=""||h!=null){var c=g.getField(e);var b=c.picker.getStore();var f=b.getNodeById(h);if(f!=null){var d=f.get("text");return d}else{return h}}else{return h}}});NS.define("NS.grid.Column",{extend:"NS.Component",initComponent:function(a){this.component=Ext.create("Ext.grid.column.Column",a||{})},initConfigMapping:function(){this.callParent();this.addConfigMapping("text","name","renderer","xtype","locked","flex")},initEvents:function(){this.callParent();this.addEvents("linkclick","buttonclick")},onLinkclick:function(){this.component.on("linkclick",function(d,e,b,c,a){this.fireEvent("linkclick",d,e,b,c,a)},this)},onButtonclick:function(){this.component.on("buttonclick",function(e,f,c,d,b,a){this.fireEvent("buttonclick",e,f,c,d,b,a)},this)},getEditor:function(){var a=this.component.getEditor()||this.editor;return NS.util.ComponentInstance.getInstance(a)},setText:function(a){this.component.setText(a)},setEditor:function(a){this.component.setEditor(a.getLibComponent())},getDataIndex:function(){return this.component.dataIndex}});Ext.define("Ext.grid.column.ButtonColumn",{extend:"Ext.grid.column.Column",alias:["widget.buttoncolumn"],constructor:function(){var a=this;this.callParent(arguments);this.addEvents("buttonclick");if(!this.renderer){this.renderer=function(){var g='<input type="button" value={0} style="{1}" name="{2}">';var b=a.buttons;var d="";var h=Ext.String.format;for(var c=0;c<b.length;c++){var f=b[c];var e=a.generateStyleString(f.style||{});d+=h(g,f.buttonText,e,f.name)}return d}}},generateStyleString:function(c){var b="";for(var a in c){b+=a+":"+c[a]+";"}return b},processEvent:function(g,k,m,a,h,d,b,p){var f=this,n,j;var l=k.getGridColumns()[h].dataIndex;if(l==this.dataIndex){if(g=="click"){var c=d.getTarget();if(m.contains(c)&&c.nodeName=="INPUT"&&c.type=="button"){this.fireEvent("buttonclick",c.value,a,h,b.data,c.name||"",m)}else{if(g=="mousedown"&&n.stopSelection!==false){return false}}}}return f.callParent(arguments)}});Ext.define("Ext.grid.column.LinkColumn",{extend:"Ext.grid.column.Column",alias:["widget.linkcolumn"],link:[],constructor:function(){var a=this;this.callParent(arguments);this.addEvents("linkclick");if(!this.renderer){this.renderer=function(){var g='<a href="javascript:void(0);" style="{0}">{1}</a>';var b=a.links;var d="";var h=Ext.String.format;for(var c=0;c<b.length;c++){var f=b[c];var e=a.generateStyleString(f.style||{});d+=h(g,e,f.linkText)+"&nbsp;"}return d}}},generateStyleString:function(c){var b="";for(var a in c){b+=a+":"+c[a]+";"}return b},processEvent:function(g,k,m,a,h,d,b,p){var f=this,n,j;var l=k.getGridColumns()[h].dataIndex;if(l==this.dataIndex){if(g=="click"){var c=d.getTarget();if(m.contains(c)&&c.nodeName=="A"){d.stopEvent();this.fireEvent("linkclick",this.deleteHtmlTag(c.innerHTML),a,h,b.data,c,1)}else{if(g=="mousedown"&&n.stopSelection!==false){return false}}}}return f.callParent(arguments)},deleteHtmlTag:function(a){return a.replace(/<\/?.+?>/g,"")}});Ext.define("Ext.grid.column.ProgressColumn",{extend:"Ext.grid.column.Column",alias:["widget.progresscolumn"],constructor:function(){var a=this;this.callParent(arguments);this.renderer=function(e){var d='<div style="height:16px;border:1px {0} solid;"><div style="background-color:{1};height:14px;width:{2}%;text-align:center;">{3}%</div></div>';var b=a.buttons;var c="";var f=Ext.String.format;c+=f(d,a.color,a.color,e,e);return c}},color:"blue"});Ext.define("Ext.toolbar.NumberPaging",{extend:"Ext.toolbar.Toolbar",tpl1:new Ext.XTemplate(['<span style="margin-left:12px;display: inline-block;float: left">','<tpl for="list">','<tpl if="link == true"><a href="javascript:void(0);" style="font-size: 12;color: blue;margin-left: 2px;" index="{index}">{mc}</a></tpl>','<tpl if="link === false"><a index="{index}" style="font-size: 16;font-weight:bolder;margin-left: 2px;">{mc}</a></tpl>',"</tpl></span>",'<span style="margin-right:14px;display:inline-block;float:right;color: blue;">共<span style="color: #000000;"> {count} </span>条记录，当前显示第 {start} 到 {end} 条记录</span>']),layout:"fit",height:20,initComponent:function(){this.addEvents("linkclick");var a=this.content=new Ext.Component({tpl:this.tpl1});a.on({click:{element:"el",scope:this,fn:function(c,d){if(d.nodeName=="A"){var f=Ext.fly(d);var b=f.getAttribute("index");this.onLinkclick(parseInt(b));this.fireEvent("linkclick",this.index)}}}});this.callParent()},onRender:function(){var a=this;this.add(this.content);this.callParent(arguments);this.onLinkclick(1)},onLinkclick:function(a){this.index=parseInt(a);this.content.update(this.createLinkData(this.index))},maxLink:7,onLoad:function(){this.content.update(this.createLinkData(this.store.currentPage))},createLinkData:function(h){var n=this.store,g=parseInt(n.totalCount)||0,j=this.maxLink,m=n.pageSize,f=n.currentPage,e=Math.ceil(g/m),d=h,l,k=[],b={};if(e>j){l=j}else{l=e}l+=h;if(h>7){l=l-3;d=d-3}if(l>e){l=e+1;if(l>j){d=l-j}else{d=1}}k.push({mc:"首页",index:1,link:true});if(h>1){k.push({mc:"上一页",index:h-1,link:true})}for(d;d<l;d++){if(d==h){k.push({mc:d,index:d,link:false})}else{k.push({mc:d,index:d,link:true})}}if(h<e){k.push({mc:"下一页",index:h+1,link:true})}k.push({mc:"末页",index:e,link:true});b.list=k;b.maxPage=e;b.count=g;var a=m*(h-1)+1;var c=m*h;b.end=c<g?c:g;b.start=a<b.end?a:b.end;return b}});NS.define("NS.grid.plugin.CellEditor",{constructor:function(a){this.component=Ext.create("Ext.grid.plugin.CellEditing",a||{clicksToEdit:2})},getLibComponent:function(){return this.component}});NS.define("NS.grid.plugin.HeaderQuery",{extend:"NS.Plugin",constructor:function(a){this.addEvents("headerclick","query")},init:function(a){this.registerGrid(a);this.addHeaderClick();this.addListener("headerclick",this.onHeaderClick,this);this.addListener("query",this.onQuery,this)},registerGrid:function(a){this.grid=a},clear:function(){this.bbar.remove(this.panel);delete this.params;delete this.panel;delete this.showInfos;this.grid.load({})},getParams:function(){var k=this.columnData,h=this.component,c=this.params=this.params||{},b=k.xtype,a=k.name;if(b=="textfield"||b=="textarea"){a=k.name+".like";var j=h.text.getValue();c[a]=j}else{if(b=="numberfield"){var j=h.text.getValue();c[a]=j}else{if(b=="combobox"||b=="tree"||b=="checkbox"||b=="treecombobox"){var j=h.combox.getValue();c[a]=j}else{if(b=="datefield"){var e=a+".date1";var d=a+".date2";var g=h.date1.getRawValue();var f=h.date2.getRawValue();c[e]=g;c[d]=f}else{if(b=="timefield"||b=="yearmonth"){var j=h.combox.getRawValue();c[a]=j}else{var j=h.combox.getValue();c[a]=j}}}}}return c},addHeaderClick:function(){var c=this,b=this.grid.getLibComponent(),a=this.grid.config.columnData;if(b.headerCt){b.headerCt.on("headerclick",function(f,g,h,e,d){Ext.each(a,function(j){if(j.name==g.dataIndex&&j.isQuery==1){c.fireEvent("headerclick",g,j,h)}})})}else{if(b.lockedGrid.headerCt&&b.normalGrid.headerCt){b.lockedGrid.headerCt.on("headerclick",function(f,g,h,e,d){Ext.each(a,function(j){if(j.name==g.dataIndex&&j.isQuery==1){c.fireEvent("headerclick",g,j,h)}})});b.normalGrid.headerCt.on("headerclick",function(f,g,h,e,d){Ext.each(a,function(j){if(j.name==g.dataIndex&&j.isQuery==1){c.fireEvent("headerclick",g,j,h)}})})}}},onHeaderClick:function(b,a,c){this.columnData=a;this.createHeaderWindow.apply(this,arguments);if(this.columnData.xtype!="treecombobox"){this.doListeners()}else{}},doListeners:function(){var c=this.window;var e=c.getEl();var a=Ext.getBody();var b=a.dom;var d=false;a.on("click",function(g){var f=g.getTarget();if(g.within(e)){return}else{if(!g.within(e)){while(f!=b){if(f!==null&&(f.id.match("datepicker")!=null)){return}else{f=(f!=null?f.parentNode:b)}}if(d){c.close()}else{d=true}}}})},onQuery:function(){var b=this.getParams();var a=this.grid;a.load(b);this.window.close();delete this.window;this.setPagingBar()},setPagingBar:function(){this.setShowMessage();this.insertPanelIntoBottom()},insertPanelIntoBottom:function(){var d=this;var a=this.barsize=this.getSizeForBarPanel();var b=this.panel=this.panel||Ext.create("Ext.panel.Panel",{height:a.height-5,frame:true,border:false,baseCls:"{solid #B5B8C8;}",margin:0,html:""});if(!this.bbar.items.contains(b)){this.bbar.insert(11,b)}var f=Ext.id();var e=this.getQueryString()+"&nbsp;&nbsp;<span id='"+f+"'></span>";b.body.update(e);var c=Ext.create("Ext.button.Button",{iconCls:"page-delete",handler:function(){d.clear()},renderTo:f})},getSizeForBarPanel:function(){var h=this;var a=this.bbar=h.grid.getLibComponent().getDockedComponent(1);var c=a.getEl();var j=c.getHeight();var f=a.getComponent("refresh");var e=f.getEl();var g=a.child("#displayItem");var b=g.getEl();var d={x:e.getX()+e.getWidth(),y:c.getY(),width:b.getX()-e.getX()-e.getWidth()-40,height:j};return d},getQueryString:function(){var c="";var b=this.showInfos;for(var a=0;a<b.length;a++){if(a==b.length-1){c+='"'+b[a].name+'" 等于 "'+b[a].value+'"'}else{c+='"'+b[a].name+'" 等于 "'+b[a].value+'"'}if(this.getStrLength(this.delHtmlTag(c))>=this.barsize.width-40){c+="&nbsp;&nbsp;<span style='color:red;'>并且......</span>&nbsp;&nbsp;";break}}return c},delHtmlTag:function(a){return a.replace(/<\/?.+?>/g,"")},getStrLength:function(c){var a=0;for(var b=0;;b++){if(!c.charCodeAt(b)){break}if(c.charCodeAt(b)>255){a+=2*6}else{a+=1*6}}return a},onPanelHover:function(){var a=this.panel.getEl();var b=true;a.on("mouseover",function(d,c,e){b=true;Ext.defer(function(){if(b&&!PopWindow.popDiv){me.showPop(d)}},1000)});a.on("mouseout",function(d,c,e){b=false})},showPop:function(e){var f=this.getQueryString();if(this.popDiv&&this.popDiv.parentNode==document.body){document.body.removeChild(this.popDiv)}var a={};if(Ext.isIE8){a.x=obj.getX();a.y=obj.getY()}else{a.x=e.getX();a.y=e.getY()}var d=this;var g=document.createElement("div");this.popDiv=g;var c=g.style;c.webkitBorderRadius=8;c.mozBorderRadius=8;c.borderRadius=8;c.boxShadow="#666 0px 0px 6px";c.width=a.width;c.padding="16 10 16 16";c.position="absolute";c.zIndex=1000000;g.innerHTML="<div style='float:left;width:32;height:100%;'><img src='images/020.png' style = 'width:32;height:32;'/></div><div style='margin-left:16;float:right;line-height:2;height:100%;padding-top:0;width:260px;'>"+a.message+"</div>";g.className="x-window-body x-window-body-default x-closable x-window-body-closable x-window-body-default-closable x-window-body-default x-window-body-default-closable x-box-layout-ct";Ext.getBody().appendChild(g);Ext.fly(g).setXY([a.x+10,a.y-70]);var b=this.getSize(g);Ext.fly(g).setY(a.y-Ext.fly(g).getWidth().height);Ext.defer(function(){if(g.parentNode==document.body){Ext.fly(g).remove()}delete d.popDiv},3000)},getBarSize:function(){var h=this;var a=this.bbar=this.bbar||this.grid.getLibComponent().getDockedComponent("bottom");var c=a.getEl();var j=c.getHeight();var f=a.getComponent("refresh");var e=f.getEl();var g=a.child("#displayItem");var b=g.getEl();var d={x:e.getX()+e.getWidth(),y:c.getY(),width:b.getX()-e.getX()-e.getWidth()-40,height:j};return d},setShowMessage:function(){var d=this.columnData,f=d.xtype,b=d.nameCh,a=this.component;var e=this.showInfos=this.showInfos||[];if(f=="textfield"||f=="textarea"||f=="numberfield"){for(var c=0;c<e.length;c++){if(e[c].name==b){e[c].value=a.text.getValue();return}}e.push({name:b,value:a.text.getValue()})}else{if(f=="combobox"||f=="tree"||f=="timefield"||f=="yearmonth"||f=="checkbox"||f=="treecombobox"){for(var c=0;c<e.length;c++){if(e[c].name==b){e[c].value=a.combox.getRawValue();return}}e.push({name:b,value:a.combox.getRawValue()})}else{if(f=="datefield"){for(var c=0;c<e.length;c++){if(e[c].name==b){e[c].value=a.date1.getRawValue()+" 到 "+a.date2.getRawValue();return}}e.push({name:b,value:a.date1.getRawValue()+" 到 "+a.date2.getRawValue()})}}}},createHeaderWindow:function(d,b,e){var a={closable:false,draggable:false,header:false,height:100,border:false,plain:true};var c=this.createComponent(b);if(b.xtype=="textfield"||b.xtype=="textarea"||b.xtype=="numberfield"){NS.apply(a,{width:178,height:63,minWidth:162,minHeight:63,buttonAlign:"center",layout:{type:"vbox",align:"center"},items:[c.text],buttons:[c.button1,c.button2]})}else{if(b.xtype=="combobox"||b.xtype=="tree"||b.xtype=="timefield"||b.xtype=="checkbox"||b.xtype=="treecombobox"){NS.apply(a,{width:160,height:30,items:c.combox})}else{if(b.xtype=="datefield"){NS.apply(a,{width:220,height:100,buttonAlign:"center",layout:{align:"center"},items:[c.date1,c.date2],buttons:[c.button1,c.button2]})}}}if(this.window){this.window.close()}this.window=Ext.create("Ext.window.Window",a);if(c.text){c.text.focus(true,true)}this.setWindowPositionAndSize(this.window,d)},setWindowPositionAndSize:function(g,e){var d=e.getEl();var c=d.getY()+d.getHeight();var f=d.getX();var b=Ext.getBody();var a=b.getWidth();if(f+g.width>a){f=a-g.width-20}g.setPosition(f,c,false);g.setSize({width:g.width,height:g.height});g.show()},createWindowContainer:function(a){},createComponent:function(e){var g=this;var a=e.codeData.data,b=e.name,d=e.xtype;var f=true;var h=this.component={};if(d=="textfield"||d=="textarea"){h.text=Ext.create("Ext.form.field.Text",{hiddenName:b,border:false,width:150,listeners:{specialkey:function(l,m){if(m.getKey()==m.ENTER){h.button1.fireEvent("click")}}}})}else{if(d=="numberfield"){h.text=Ext.create("Ext.form.field.Number",{hiddenName:b,border:false,width:150,listeners:{specialkey:function(l,m){if(m.getKey()==m.ENTER){h.button1.fireEvent("click")}}}})}else{if(d=="timefield"){h.combox=Ext.create("Ext.form.field.Time",{hiddenName:b,border:false,format:"G时i分",submitFormat:"G时i分",width:150,listeners:{select:function(){g.fireEvent("query")}}})}else{if(d=="combobox"){h.combox=Ext.create("Ext.form.field.ComboBox",{width:150,valueField:"id",displayField:"mc",hiddenName:b,lastQuery:"",queryMode:"local",store:{data:a,fields:["id","mc"]},allowBlank:false,editabled:false,listeners:{select:function(){g.fireEvent("query")}}})}else{if(d=="treecombobox"){var c={expanded:true,editable:true,isLeafSelect:true,rootVisible:false,width:150,treeData:NS.clone(a.children[0]),listeners:{treeselect:function(m,l){g.fireEvent("query")}}};h.combox=Ext.create("Ext.ux.comboBoxTree",c)}else{if(d=="tree"){h.combox=Ext.create("Ext.form.field.ComboBox",{width:150,valueField:"id",store:{data:a,fields:["id","text","pid"]},displayField:"text",queryMode:"local",editable:false,allowBlank:false,editabled:false,listeners:{select:function(){g.fireEvent("query")}}})}else{if(d=="checkbox"){h.combox=Ext.create("Ext.form.field.ComboBox",{width:150,editable:false,store:{fields:["id","mc"],data:[{id:"1",mc:"是"},{id:"0",mc:"否"}]},valueField:"id",displayField:"mc",allowBlank:false,editabled:false,listeners:{select:function(){g.fireEvent("query")}}})}else{if(d=="datefield"){var k=Ext.id();var j=Ext.id();h.date1=Ext.create("Ext.form.field.Date",{id:k,fieldLabel:"起始",emptyText:"应早于结束时间...",format:"Y-m-d",labelWidth:40,editable:false,name:"startValue",endDateField:j,listeners:{change:function(n,l,m){if(h.date2.getValue()!=null&&(n.getValue()>h.date2.getValue())){f=false;n.setValue(null)}else{f=true}}}});h.date2=Ext.create("Ext.form.field.Date",{id:j,fieldLabel:"结束",emptyText:"应晚于起始时间...",format:"Y-m-d",labelWidth:40,name:"endValue",editable:false,startDateField:k,listeners:{change:function(n,l,m){if(h.date2.getValue()!=null&&(n.getValue()<h.date1.getValue())){f=false;n.setValue(null)}else{f=true}}}})}}}}}}}}h.button1=Ext.create("Ext.button.Button",{text:"确认",textAlign:"center",listeners:{click:{fn:function(){if(d=="datefield"){if(!(h.date1.getValue()==h.date2.getValue()&&h.date1.getValue()==null)){if(f==true){this.fireEvent("query")}}}else{this.fireEvent("query")}},scope:this}}});h.button2=Ext.create("Ext.button.Button",{text:"取消",textAlign:"center",listeners:{click:{fn:function(){this.window.close()},scope:this}}});return h}});NS.define("NS.grid.query.SingleFieldQuery",{extend:"NS.Component",constructor:function(a){this.initData.apply(this,arguments);this.initComponent()},registerGrid:function(a){this.grid=a},clear:function(){this.field.setValue()},initData:function(b){var a=[],c=0,d,e=b.data,f={compWidth:300,firstColumnWidth:0.4,secondColumnWidth:0.6};this.fieldsConfig=b.fieldsConfig;this.config=b;NS.apply(b,f);for(c,len=e.length;c<len;c++){d=e[c];if(d.isQuery){a.push(d)}}this.tranData=a;this.registerGrid(b.grid)},initComponent:function(){var a=this.config;this.component=this.createFieldSet(a);var b=this.createFieldComboBox();this.component.add(b);this.setDefaultComponent();this.setQueryButton()},setQueryButton:function(){var b=this;var a=new Ext.button.Button({text:"查询",iconCls:"ns-btn-search",margin:"1 0 0 4",frame:true,handler:function(){b.grid.load(b.getParams())}});a.ui=a.ui+"-toolbar";this.component.add(a)},getParams:function(){var d=this.fieldCombox.getValue();var b=this.field.xtype;var a=this.field;var c={};switch(b){case"textfield":c[d+".like"]=a.getValue();break;case"combobox":if(a.getValue()==a.getRawValue()){}else{c[d]=a.getValue()}break;case"datefield":c[d]=a.getRawValue();break;case"timefield":c[d]=a.getRawValue();break;case"monthfield":c[d]=a.getRawValue();break;case"numberfield":c[d]=a.getRawValue();break;case"textarea":c[d+".like"]=a.getValue();break;case"checkbox":c[d]=a.getValue();break;case"treecombobox":c[d]=a.getValue();break;default:c[d]=a.getValue();break}if(c[d]==null){delete c[d]}return c},setDefaultComponent:function(){var c=this,a=this.fieldStore,b=this.tranData[0];this.fieldCombox.setValue(b.name);this.addComponentForFieldSet(b)},getFieldSet:function(){return this.fieldSet},createFieldSet:function(a){var b=Ext.create("Ext.container.Container",{layout:"column",padding:0,frame:true,width:a.compWidth,bubbleEvents:["add"],height:22,border:0});if((navigator.userAgent.indexOf("MSIE")>=0)&&(navigator.userAgent.indexOf("Opera")<0)){Ext.apply(b,{baseCls:"{border:0px solid #B5B8C8;}"})}return b},createFieldComboBox:function(){var d=this;var b=this.config;var a=this.createFieldStore();var c=this.fieldCombox=Ext.create("Ext.form.field.ComboBox",{store:a,valueField:"value",displayField:"display",editable:false,columnWidth:b.firstColumnWidth,border:0,listeners:{select:{scope:this,fn:function(h,e){var f=e[0].data.value;var g;Ext.each(this.tranData,function(j){if(j.name==f){g=j}});this.componentData=g;this.addComponentForFieldSet(g)}}}});return c},createFieldStore:function(){var b=this.tranData,f=this.fieldsData=[],e;for(var d=0,a=b.length;d<a;d++){e=b[d];if(e.isQuery){f.push({value:e.name,display:e.nameCh})}}var c=this.fieldStore=Ext.create("Ext.data.Store",{fields:["value","display"],data:f});return c},addComponentForFieldSet:function(a){var b=this;var d=b.createComponent(a);var c=this.component;if(c.items.length==3){c.remove(b.field);c.insert(1,d)}else{var e=a.xtype;if(e=="checkbox"){c.add(d)}else{c.add(d)}}},createComponent:function(e){var d=this,f=e;var b,a={name:"fieldValue",itemId:"remove",editable:true,columnWidth:d.config.secondColumnWidth,listeners:{specialkey:{scope:this,fn:function(g,h){if(h.getKey()==h.ENTER){var j=this.getParams();if(NS.Object.getSize(j)==0){return}this.grid.load(j)}}}}};if(f.xtype=="textarea"){f=NS.clone(f);f.xtype="textfield"}if(f.xtype=="checkbox"){f=NS.clone(f);f.xtype="combobox";f.codeData.data=[{id:"1",mc:"是",dm:"1"},{id:"0",mc:"否",dm:"0"}]}var c=this.getComponentConfig(e);NS.apply(a,c);this.field=b=NS.util.FieldCreator.createField(f,a);if(f.xtype=="treecombobox"){b.on("treeselect",function(){this.grid.load(this.getParams())},this)}else{b.on("select",function(){this.grid.load(this.getParams())},this)}delete b.maxLength;delete b.regex;delete b.regexText;return b||{}},getComponentConfig:function(d){var f=d.name,b=0,c,e=this.fieldsConfig||{},a=e.length;for(;b<a;b++){c=e[b];if(c.name==f){return c}}}});NS.define("NS.grid.query.SeniorQuery",{extend:"NS.Component",constructor:function(){this.initData.apply(this,arguments);this.initComponent()},registerGrid:function(a){this.grid=a},clear:function(){},initData:function(a){this.config=a;this.data=a.data;this.initFieldsStoreData(a.data);this.registerGrid(a.grid)},initFieldsStoreData:function(e){var d=[],c;for(var b=0,a=e.length;b<a;b++){c=e[b];if(c.isQuery){d.push({value:c.name,display:c.nameCh})}}this.fieldsData=d},initComponent:function(){this.component=Ext.create("Ext.button.Button",{text:"高级查询",iconCls:"ns-btn-advanced-search",listeners:{click:{scope:this,fn:function(){this.initWindow()}}}})},initWindow:function(){this.condition=new NS.grid.query.Condition({SeniorQuery:this,fieldsStoreData:this.fieldsData,componentsData:this.data});this.condition.initComponent();this.createWindow({width:800,height:400,autoScroll:true,autoShow:true,title:"高级查询",modal:true,resizable:false,items:this.condition.getPanel(),buttons:this.createButtons(this.config)})},createWindow:function(a){this.window=Ext.create("Ext.window.Window",a)},createButtons:function(a){var d=this;var c=Ext.create("Ext.button.Button",{text:"提交查询",handler:function(){var e=d.getParams();if(e.error=="yes"){return}delete e.error;d.window.close();d.grid.load(e)}});var b=Ext.create("Ext.button.Button",{text:"取消",handler:function(){d.window.close()}});return[c,b]},getParams:function(c){var g=this;var h="no";var d=[];var a=this.condition.ids;for(var e=0;e<a.length;e++){var j=g.getValueById(a[e]+"_fields");var b=g.getValueById(a[e]+"_operator");var k=g.getValueById(a[e]+"_remove");if(j==""){Ext.Msg.alert("警告","条件"+(e+1)+"-属性不能为空！");h="yes";break}else{if(b==""){Ext.Msg.alert("警告","条件"+(e+1)+"-关系不能为空！");h="yes";break}else{if(k==""){Ext.Msg.alert("警告","条件"+(e+1)+"-值不能为空");h="yes";break}}}var f="";if(e!=a.length-1){f=g.getValueById(a[e]+"_logical");if(f==""){Ext.Msg.alert("警告","条件"+(e+1)+"-连接符不能为空！");h="yes";break}}d.push({field:j,operator:b,value:k,logical:f})}return{seniorQuery:d,error:h}},getValueById:function(c){var a=Ext.getCmp(c);var b;if(a instanceof Ext.form.field.Date||a instanceof Ext.form.field.Time){b=a.getRawValue()}else{b=a.getValue()}if(!b||b=="null"||b=="undefined "){b=""}return b}});NS.define("NS.grid.query.Condition",{constructor:function(){this.initData.apply(this,arguments)},initData:function(a){this.config=a;this.ids=[];this.num=1},initComponent:function(){var a=this.config;this.SeniorQuery=a.SeniorQuery;this.setFieldsStore({data:a.fieldsStoreData});this.componentsData=a.componentsData;this.createLogicalOperatorStore();this.createOperatorStore()},getShowText:function(){var a="条件"+this.num++;return a},getPanel:function(){var d=this;var h=Ext.id();this.ids.push(h);var b=this.createFieldsCombox({id:h+"_fields",configId:h,width:220,fieldLabel:d.getShowText()+"-  属性列表"});var f=this.createOperatorCombox({id:h+"_operator",width:150,columnWidth:0.2});var e=Ext.create("Ext.form.field.Text",{fieldLabel:"值",labelWidth:25,width:150,id:h+"_remove"});var g=this.createLogicalOperatorCombox({id:h+"_logical",width:150});var c=Ext.create("Ext.button.Button",{text:"添加条件",id:h+"_button",listeners:{click:function(j){if(this.text=="添加条件"){d.SeniorQuery.window.add(d.getPanel());this.setText("删除条件")}else{if(this.text=="删除条件"){d.SeniorQuery.window.remove(Ext.getCmp(h));d.deleteIdFromIds(h);d.resizeLabel()}}}}});var a=Ext.create("Ext.form.Panel",{width:"100%",height:45,id:h,border:false,frame:true,margin:"5,5,0,5",padding:"10,0,0,0",layout:"column",items:[b,f,e,g,c]});return a},resizeLabel:function(){for(var b=0;b<this.ids.length;b++){var a=Ext.getCmp(this.ids[b]+"_fields");a.setFieldLabel(" 条件"+(b+1)+"-  属性列表")}this.num=this.ids.length+1},deleteIdFromIds:function(b){var a=[];Ext.each(this.ids,function(c){if(c!=b){a.push(c)}});this.ids=a},setFieldsStore:function(b){var a=this.createStore({fields:["value","display"],data:b.data});this.fieldStore=a},createFieldsCombox:function(a){var c=this;var d=a.configId;var b=this.createCombox({valueField:"value",displayField:"display",fieldLabel:a.fieldLabel,store:this.fieldStore,labelWidth:100,id:a.id,editable:false,width:a.width,listeners:{select:function(k,e,j){var g=e[0].data.value,f,h=this.up("form"),l=d+"_remove";h.remove(Ext.getCmp(l));Ext.each(c.componentsData,function(m){if(m.name==g){f=c.createComponent(m,l)}});h.insert(2,f);f.setValue("")}}});return b},createComponent:function(d,f){var b;var c=this,e=d;var b,a={name:"fieldValue",xtype:d.xtype,codeData:d.codeData,id:f,itemId:"remove",columnWidth:c.config.secondColumnWidth,emptyText:"请输入查询内容...",listeners:{}};if(e.xtype=="textarea"){e=NS.clone(e);e.xtype="textfield"}if(e.xtype=="checkbox"){e=NS.clone(e);e.xtype="combobox";e.codeData.data=[{id:"1",mc:"是",dm:"1"},{id:"0",mc:"否",dm:"0"}]}b=NS.util.FieldCreator.createField(e,a);return b||{}},createOperatorCombox:function(a){var b=this.createDefaultCombox({store:this.operatoreStore,id:a.id,editable:false,fieldLabel:"关系",width:a.width});return b},createLogicalOperatorCombox:function(a){var b=this.createDefaultCombox({store:this.logicalOperatorStore,id:a.id,editable:false,fieldLabel:"连接符",width:a.width});return b},createDefaultCombox:function(a){var b=this.createCombox({valueField:"value",displayField:"display",fieldLabel:a.fieldLabel,queryMode:"local",labelWidth:45,editable:false,store:a.store,width:a.width,id:a.id});return b},createCombox:function(a){var b=Ext.create("Ext.form.field.ComboBox",a);return b},createStore:function(b){var a=Ext.create("Ext.data.Store",b);return a},createOperatorStore:function(){var a=Ext.create("Ext.data.Store",{fields:["value","display"],data:[{value:"=",display:"等于"},{value:"like",display:"相似于"},{value:"<>",display:"不等于"},{value:">",display:"大于"},{value:"<",display:"小于"},{value:">=",display:"大于等于"},{value:"<=",display:"小于等于"}]});this.operatoreStore=a},createLogicalOperatorStore:function(){var a=Ext.create("Ext.data.Store",{fields:["value","display"],data:[{value:"and",display:"并且"},{value:"or",display:"或"}]});this.logicalOperatorStore=a}});NS.define("NS.util.DataConverter",{singleton:true,codedataFormat:function(b){if(b==null||b=="null"){return null}if(b instanceof Array){var a=[];for(var d in b){if(d.sfky=="1"){a.push({name:d.mc,value:d.id})}}if(a.length==0){return null}return a}return null},dataFormat:function(a){var b={entityName:a.bmst,data:a.bmsj||[]};return{id:a.id,name:a.sx,nameCh:a.sxzwm,dataType:a.sxxslx,isAddFormField:a.sfxszd==1,isQuery:a.sfcxzd==1,dbLength:a.cd,entityName:a.ssstm,codeData:b,xtype:a.sxzjlx,drillExp:a.sfxz,regExp:a.jyzzbds,regValidateErrorMesg:a.zzjycwxx,validateType:a.jylx,fieldsetGroup:a.fl,isColumnShow:a.sflbxszd==1,isColumnCreate:a.sflbzd==1,columnWidth:a.lbkd==null?150:a.lbkd,isAddField:a.xzzdsx=="1",isUpdateField:a.xgzdsx=="1",isBlank:a.sffk==1,editable:a.sfkbj==1,cc:a.cc}},entity2Standard:function(a){return this.dataFormat(a)},entitysToStandards:function(b){if(b instanceof Array){var a=[];for(var c in b){a.push(this.dataFormat(b[c]))}return a}return null}});(function(){var a=NS.Function.alias;NS.E2S=a(NS.util.DataConverter,"entitysToStandards")})();NS.define("NS.util.FieldCreator",{singleton:true,supportedType:{timefield:"Ext.form.field.Time",combobox:"Ext.form.field.ComboBox",datefield:"Ext.form.field.Date",checkbox:"Ext.form.field.Checkbox",textarea:"Ext.form.field.TextArea",tree:"Ext.form.field.ComboBox",textfield:"Ext.form.field.Text",numberfield:"Ext.form.field.Number",button:"Ext.button.Button",treecombobox:"Ext.ux.comboBoxTree",forumSearch:"Ext.form.field.ForumSearch"},initStandardConfig:function(a){var b={name:cdata.dataIndex,bmst:cdata.bmst,bmcc:cdata.bmcc,bmtype:cdata.componentType,data:componentData.data,fieldLabel:cdata.header,allowBlank:cdata.allowBlank,maxLength:cdata.length,ssfl:cdata.ssfl,hidden:cdata.sfxs==1?false:true};NS.apply(b,a);return b},createFields:function(a){var c=new Array();if(a instanceof Array&&a.length>1){for(var b=0;b<a.length;b++){var d=this.initStandardConfig(a[b]);c.push(this.createField(d))}}else{var d=this.initStandardConfig(a[0]);c.push(this.createField(d))}},createField:function(e,d){var f=e.xtype,b=this.supportedType[f],c;var a=this.configConvert(e);NS.apply(a,d);this.processOwnerProperty(a);if(b){var c=Ext.create(this.supportedType[f],a)}else{NS.error({sourceClass:"NS.util.FieldCreator",sourceMethod:"createField",msg:"组件类型错误！类型为："+f})}return c},processOwnerProperty:function(a){if(a.fields&&a.xtype!="forumSearch"){a.store.fields=a.fields;delete a.fields}if(a.data&&a.xtype=="combobox"){a.store.data=a.data;delete a.data}},configConvert:function(b){var a,c=b.xtype;if(b.codeData){a={name:b.name,xtype:b.xtype,codeData:b.codeData,bmst:b.codeData.bmst,bmcc:b.cc,fl:b.fieldsetGroup,bmtype:b.xtype,data:b.codeData.data,allowBlank:b.isBlank,maxLength:b.dbLength}}else{a=b}switch(c){case"textfield":if(b.regExp!=null&&b.regExp!=""){NS.apply(a,{regex:new RegExp(b.regExp),regexText:b.regValidateErrorMesg})}break;case"numberfield":if(b.regExp!=null&&b.regExp!=""){NS.apply(a,{regex:new RegExp(b.regExp),regexText:b.regValidateErrorMesg})}break;case"combobox":NS.apply(a,{valueField:"id",displayField:"mc",lastQuery:"",queryMode:"local",editable:false,store:{fields:["id","mc","dm","pid"],data:b.codeData.data}});break;case"tree":NS.apply(a,{valueField:"id",displayField:"text",editable:false,queryMode:"local",lastQuery:"",store:{fields:["id","text","dm","pid"],data:b.codeData.data}});break;case"timefield":NS.apply(a,{format:"G时i分",submitFormat:"G:i"});break;case"textarea":NS.apply(a,{height:50});break;case"treecombobox":NS.apply(a,{editable:false,treeData:NS.clone(b.codeData.data.children),autoWidth:true,rootVisible:false});delete a.data;delete a.codeData;break;case"checkbox":NS.apply(a,{boxLabel:"是",inputValue:"1",uncheckedValue:"0"});break;case"datefield":NS.apply(a,{format:"Y-m-d"});break;case"forumSearch":NS.apply(a,{service:{}});break}return a}});NS.define("NS.AbstractChart",{extend:"NS.Component",id_Sign:"_chart",chartType:"",baseSwfUrl:"FusionCharts/charts/",chartConfig:{caption:"图表标题",subcaption:"图表副标题",xaxisname:"X轴名称",yaxisname:"Y轴名称",numberprefix:"Y轴值单位"},initComponent:function(){var c=this.width,a=this.height,b=this.support(this.chartType),e=this.baseSwfUrl,d=this.translate(this.data);if(!c){c="100%"}if(!a){a="100%"}this.chartId=this.id+"_fusionchart";this.chart=new FusionCharts(e+b+".swf",this.chartId,c,a,"0","1");this.chart.setJSONData(d);this.chart.configure({ParsingDataText:"数据读取中,请稍候...",PBarLoadingText:"数据加载中,请稍候...",RenderingChartText:"数据正在渲染,请稍候...",LoadDataErrorText:"数据加载错误!",ChartNoDataText:"无数据可供显示!"});this.callParent(arguments)},afterRender:function(){this.chart.render(this.component.id)},redraw:function(a){this.chart.setJSONData(this.translate(a))},translate:function(e){var d=this.getChartData(e),a=this.getChartParams(),c=this.getChartStyles();var b={};NS.apply(b,a,d);NS.apply(b,c);return b},getChartData:function(e){var n=this.chartType,f=0,d=0,q,k,p,m=[],a=[],c=[],g=[],b,h=e.fields,l={};if(this.isSingleSeriesChart(n)){l.data=e}else{if(this.isMultiSeriesChart(n)){for(k=e.labels.length;f<k;f++){a.push({label:e.labels[f]})}for(f=0;f<e.dataSet.length;f++){q=e.dataSet[f];b={};b.seriesname=q.name;b.data=[];for(d=0,p=q.data.length;d<p;d++){b.data.push({value:q.data[d]})}c.push(b)}g.push({category:a});l.dataset=c;l.categories=g}}return l},getChartStyles:NS.emptyFn,getSscChartData:function(e){var b=0,a=e.length,c,d=[];for(;b<a;b++){c=e[b];d.push({label:c.mc,value:c.value})}return d},getChartParams:function(){return{chart:this.getBasicParams()}},getBasicParams:function(){var a={baseFontSize:"12",baseFontColor:"6B6B6B",showvalues:"0",formatNumberScale:"0",showlabels:"1",legendBgColor:"FFFFFF",showlegend:"1",legendposition:"right",legendShadow:"1",legendBorderColor:"FFFFFF",legendScrollBgColor:"DEECFD",legendScrollBarColor:"BAD1EF",legendScrollBtnColor:"BAD1EF",bgcolor:"FFFFFF,FFFFFF",showborder:"0",manageLabelOverflow:"1",useEllipsesWhenOverflow:"1",aboutMenuItemLabel:"河南省精华科技有限公司",aboutMenuItemLink:"n-http://www.gilight.cn",zeroPlaneAlpha:"10",use3DLighting:1,animation:"1"},b=this.chartConfig;NS.apply(a,b);return a},SingleSeriesChartSupport:"",MultiSeriesChartSupport:"",isSingleSeriesChart:function(a){return this.SingleSeriesChartSupport.indexOf(a)!=-1},isMultiSeriesChart:function(a){return this.MultiSeriesChartSupport.indexOf(a)!=-1},mergeParams:function(b,a){NS.apply(b,a);return b},support:function(b){var c={Pie2D:"Pie2D",Pie3D:"Pie3D",Line:"Line",MSLine:"MSLine",ScrollLine2D:"ScrollLine2D",Doughnut2D:"Doughnut2D",Doughnut3D:"Doughnut3D",Bar2D:"Bar2D",MSBar2D:"MSBar2D",MSBar3D:"MSBar3D",StackedBar2D:"StackedBar2D",StackedBar3D:"StackedBar3D",Column2D:"Column2D",Column3D:"Column3D",MSColumn2D:"MSColumn2D",MSColumn3D:"MSColumn3D",ScrollColumn2D:"ScrollColumn2D",StackedColumn2D:"StackedColumn2D",StackedColumn3D:"StackedColumn3D",ScrollStackedColumn2D:"ScrollStackedColumn2D",Area2D:"Area2D",ScrollArea2D:"ScrollArea2D",StackedArea2D:"StackedArea2D",MSArea:"MSArea"};var a=c[b]||"MSColumn2D";return a}});NS.define("NS.chart.Area",{extend:"NS.AbstractChart",SingleSeriesChartSupport:"Area2D",MultiSeriesChartSupport:"MSArea,StackedArea2D,ScrollArea2D",getChartParams:function(){var d=this.chartType,c=this.getBasicParams(),b,a={useroundedges:"1",legendShadow:"0",labelDisplay:"AUTO",decimals:"2",legendBorderColor:"",canvasBorderThickness:"0",canvaspadding:"10",showlabels:"1",chartLeftMargin:0};a=this.mergeParams(a,c);if(d=="Area2D"){b=a}else{if(d=="MSArea"){b={canvasBorderThickness:"0",canvasBgColor:"F5FFFA,FFFFFF",canvasbgAlpha:"10"};b=this.mergeParams(b,a)}else{if(d=="ScrollArea2D"){b=a}else{if(d=="StackedArea2D"){b={showsum:"1"};b=this.mergeParams(b,a)}else{b=a}}}}return{chart:b}}});NS.define("NS.chart.Bar",{extend:"NS.AbstractChart",SingleSeriesChartSupport:"Bar2D",MultiSeriesChartSupport:"MSBar2D,MSBar3D,StackedBar2D,StackedBar3D",getChartParams:function(){var d=this.chartType,c=this.getBasicParams(),b,a={useroundedges:"1",legendShadow:"0",labelDisplay:"AUTO",decimals:"2",showlabels:"1",chartTopMargin:22,chartRightMargin:22,chartLeftMargin:0};a=this.mergeParams(a,c);if(d=="Bar2D"){b={};b=this.mergeParams(b,a)}else{if(d=="MSBar2D"){b={legendShadow:"1"};b=this.mergeParams(b,a)}else{if(d=="MSBar3D"){b={};b=this.mergeParams(b,a)}else{if(d=="StackedBar2D"){b={legendShadow:"1",showsum:"1"};b=this.mergeParams(b,a)}else{b={};b=this.mergeParams(b,a)}}}}return{chart:b}}});NS.define("NS.chart.Column",{extend:"NS.AbstractChart",SingleSeriesChartSupport:"Column2D,Column3D",MultiSeriesChartSupport:"MSColumn2D,MSColumn3D,ScrollColumn2D,StackedColumn2D,StackedColumn3D,ScrollStackedColumn2D",getChartParams:function(){var d=this.chartType,c,b=this.getBasicParams(),a={labelDisplay:"AUTO",useEllipsesWhenOverflow:"1",useroundedges:"1",showlabels:"1",chartTopMargin:22,chartLeftMargin:0,decimals:"2",valuePadding:5};a=this.mergeParams(a,b);if(d=="Column2D"){c=a}else{if(d=="Column3D"){c={canvasBgColor:"F5FFFA,FFFFFF",legendBgColor:"FFFFFF"};c=this.mergeParams(c,a)}else{if(d=="MSColumn2D"){c={numvdivlines:"10",divlinealpha:"30",anchorMinRenderDistance:"6",drawanchors:"0",labelpadding:"10"};c=this.mergeParams(c,a)}else{if(d=="MSColumn3D"){c={numvdivlines:"10",divlinealpha:"30",labelpadding:"10",canvasBgColor:"FFFFFF,FFFFFF",legendBgColor:"FFFFFF"};c=this.mergeParams(c,a)}else{if(d=="ScrollColumn2D"){c={pinLineThicknessDelta:30};c=this.mergeParams(c,a)}else{if(d=="StackedColumn2D"||d=="ScrollStackedColumn2D"){c={numvdivlines:"10",divlinealpha:"30",anchorMinRenderDistance:"6",drawanchors:"0",showsum:"1",useroundedges:"1",bgcolor:"FFFFFF,FFFFFF",labelpadding:"10"};c=this.mergeParams(c,a)}else{c={};c=this.mergeParams(c,a)}}}}}}return{chart:c}}});NS.define("NS.chart.Doughnut",{extend:"NS.AbstractChart",SingleSeriesChartSupport:"Doughnut2D,Doughnut3D",MultiSeriesChartSupport:"",getChartParams:function(){var d=this.chartType,c=this.getBasicParams(),b,a={skipOverlapLabels:"1",legendShadow:"0",showvalues:"1",palette:2,enableSmartLabels:0};a=this.mergeParams(a,c);if(d=="Doughnut2D"){b={};b=this.mergeParams(b,a)}else{if(d=="Doughnut3D"){b={};b=this.mergeParams(b,a)}}return{chart:b}}});NS.define("NS.chart.Line",{extend:"NS.AbstractChart",SingleSeriesChartSupport:"Line",MultiSeriesChartSupport:"MSLine,ScrollLine2D",getChartParams:function(){var c=this.chartType,b=this.getBasicParams();var a={useroundedges:"1",legendShadow:"0",labelDisplay:"AUTO",decimals:"2",showlabels:"1",legendBorderColor:"",chartTopMargin:22,chartLeftMargin:0};a=this.mergeParams(a,b);if(c=="Line"){chartParams={palette:"2",canvasBorderThickness:"0",canvasbgAlpha:"10",canvaspadding:"40"};chartParams=this.mergeParams(chartParams,a)}else{if(c=="MSLine"){chartParams={palette:"2",canvasBorderThickness:"0",canvasBgColor:"F5FFFA,FFFFFF",canvasbgAlpha:"10",canvaspadding:"40"};chartParams=this.mergeParams(chartParams,a)}else{if(c=="ScrollLine2D"){chartParams={canvasbgAlpha:"10",canvaspadding:"40"};chartParams=this.mergeParams(chartParams,a)}}}return{chart:chartParams}}});NS.define("NS.chart.Pie",{extend:"NS.AbstractChart",SingleSeriesChartSupport:"Pie2D,Pie3D",MultiSeriesChartSupport:"",getChartParams:function(){var d=this.chartType,c=this.getBasicParams(),b,a={enableSmartLabels:0,skipOverlapLabels:"1",legendShadow:"0",palette:2,showvalues:"1"};a=this.mergeParams(a,c);if(d=="Pie2D"){b={bgalpha:"60"};b=this.mergeParams(b,a)}else{if(d=="Pie3D"){b=a}}return{chart:b}}});NS.define("NS.form.FieldSet",{extend:"NS.container.Container",initData:NS.emptyFn,initConfigMapping:function(){this.callParent();this.addConfigMapping({checkboxName:true,checkboxToggle:true,collapsed:true,collapsible:true,focusOnToFront:true,saveDelay:true,shadow:true,stateEvents:true,stateful:true,title:true})},initComponent:function(a){this.component=Ext.create("Ext.form.FieldSet",a)},initEvents:function(){this.callParent()}});NS.define("NS.form.BasicForm",{extend:"NS.container.Panel",initComponent:function(a){if(a&&a.modal){NS.apply(a,{closable:true,floating:true,draggable:true})}this.component=Ext.create("Ext.form.Panel",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({modal:true})},initEvents:function(){this.callParent(arguments);this.addEvents("beforeshow")},onBeforeshow:function(){this.component.on("beforeshow",function(a,b){this.fireEvent("beforeshow",this)},this)},setValues:function(a){var b=this.removeNUSL(a);this.component.form.setValues(b)},getValues:function(){return this.component.form.getValues()},getField:function(a){var b=this.component.form.findField(a);if(NS.isExtObj(b)){return NS.util.ComponentInstance.getInstance(b)}},setFieldValueByName:function(a,b){var c=this.component.form.findField(a);if(c&&(b===false||b)){c.setValue(b)}},getFieldValueByName:function(a){var b=this.component.form.findField(a);if(b){return b.getValue()}throw"BasicForm。js:name为"+a+"的组件不存在！"},removeNUSL:function(c){var a=NS.clone(c);for(var b in a){if(NS.isString(a[b])||NS.isNumber(a[b])||NS.isBoolean(a[b])||NS.isObject(a[b])||NS.isArray(a[b])){}else{delete a[b]}}return a},isValid:function(){return this.component.getForm().isValid()},reset:function(){this.component.getForm().reset();return this},clearValues:function(){var a=this.component;if(a.trackResetOnLoad==true){a.trackResetOnLoad=false;this.reset();this.component.trackResetOnLoad=true}else{this.reset()}},submit:function(b){var a=this;b=b||{};this.component.submit({clientValidation:true,url:b.url,params:b.params,timeout:b.timeout,success:function(c,d){if(b.callback){b.callback.call(b.scope||a,d.result)}},failure:function(c,d){if(b.callback){b.callback.call(b.scope||a,d.result)}},scope:b.scope||this})}});NS.define("NS.form.field.BaseField",{extend:"NS.Component",initData:NS.emptyFn,initComponent:function(a){this.component=Ext.create("Ext.form.field.Base",a)},doEnterFn:function(a){this.component.on("specialkey",function(d,c,b){if(c.getKey()==13){a(d,d.getValue(),d.getRawValue())}})},initConfigMapping:function(){this.callParent();var a=function(d,c,b){b.readOnly=Boolean(!d);if(!d){b.fieldStyle="background:#E6E6E6;"}};this.addConfigMapping({isEnter:true,enterFn:true,fieldLabel:true,fieldStyle:true,autoScroll:true,autoShow:true,hideLabel:true,labelAlign:true,labelWidth:true,labelSeparator:true,name:true,shadow:true,style:true,value:true,xtype:true,tabIndex:true,data:true,editable:a,listeners:true,maxLength:true,validator:true})},initEvents:function(){this.callParent();this.addEvents("keydown","keypress","keyup","select","change","blur","focus","specialkey")},onKeydown:function(){this.component.on("keydown",function(){this.fireEvent("keydown",this)},this)},onKeyup:function(){this.component.on("keyup",function(){this.fireEvent("keyup",this)},this)},onKeypress:function(){this.component.on("keypress",function(){this.fireEvent("keypress",this)},this)},onSelect:function(){this.component.on("select",function(b,a){var c=NS.Array.pluck(a,"data");this.fireEvent("select",this,c)},this)},onChange:function(){this.component.on("change",function(b,a,c){this.fireEvent("change",this,a,c)},this)},onBlur:function(){this.component.on("blur",function(a){this.fireEvent("blur",this)},this)},onFocus:function(){this.component.on("focus",function(a){this.fireEvent("focus",this)},this)},onSpecialkey:function(){this.component.on("specialkey",function(a,b){NS.Event.setEventObj(b);this.fireEvent("specialkey",this,b)},this)},getName:function(){return this.component.getName()},setValue:function(a){this.component.setValue(a)},setRawValue:function(a){this.component.setRawValue(a)},setWidth:function(a){this.component.setWidth(a)},isValid:function(){return this.component.isValid()},getValue:function(){return this.component.getValue()},setDisabled:function(a){this.component.setDisabled(a)},setVisible:function(a){this.component.setVisible(a)},setEditable:function(a){this.component.setEditable(a)},setReadOnly:function(a){this.component.setReadOnly(a);if(this.component.setFieldStyle){if(a===true){this.component.setFieldStyle("background:#E6E6E6;")}else{if(a===false){this.component.setFieldStyle("background:white;")}}}},findParentBy:function(a){return this.component.findParentBy(a)},getRawValue:function(){return this.component.getRawValue()},setFieldLabel:function(a){this.component.setFieldLabel(a)},getFieldLabel:function(){return this.component.getFieldLabel()}});NS.define("NS.form.field.Text",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.Text",a);if(a.enterFn){this.doEnterFn(a.enterFn)}},initConfigMapping:function(){this.callParent();this.addConfigMapping({allowBlank:true,blankText:true,editable:true,emptyText:true,inputType:true,disabled:true,grow:true,growAppend:true,growMax:true,growMin:true,maxText:true,maxValue:true,minText:true,minValue:true,readOnly:true,regex:true,regexText:true,size:true,vtype:true,vtypeText:true})}});NS.define("NS.form.EntityForm",{singleton:true,constructor:function(){this.callParent(arguments)},create:function(b){this.fieldConfig=b.fieldConfig||{};this.formType=b.formType;this.fields=[];this.cascade={};this.initFieldsConfig(b);this.processItems(b);this.processCascade(this.fields);var d=b.layout;NS.applyIf(b,{layout:{type:"table",columns:b.columns||2},frame:true});if(d){b.layout=d}if(b.modal){NS.apply(b,{closable:true,closeAction:b.closeAction||"destroy",floating:true,shadow:false,border:false,frame:true,bodyBorder:false})}delete this.formType;delete this.fieldConfig;var c=new Ext.form.Panel(b);var a=NS.util.ComponentInstance.getInstance(c);if(b.values){a.setValues(b.values)}return a},initFieldsConfig:function(b){var e=b.data;var f=this.fcMap={};for(var c=0,a=e.length;c<a;c++){var d=e[c];f[d.name]=d}},processItems:function(b){var j=this,g=b.items||[],f=function(){return j.createField.apply(j,arguments)},k,a=null;if(g.length!==0){for(var d=0,e=g.length;d<e;d++){k=g[d];if(NS.isNSComponent(k)){g[d]=k.component}else{if(k.xtype==="fieldset"){g[d]=this.createFieldSet(k)}else{if(NS.isString(k)){a=k;k=this.getFieldConfig(a)}else{if(k&&NS.isObject(k)){a=k.name;var h=this.getFieldConfig(a);NS.apply(h,k);k=h;if(k.readOnly==true){k.fieldStyle="background:#E6E6E6;"}}}g[d]=f(this.fcMap[a],k)}}}}else{b.items=this.getDefaultItems(b)}},getDefaultItems:function(b){var e=this,f=b.data,h=[],d,g=function(){return e.createField.apply(e,arguments)};for(var c=0,a=f.length;c<a;c++){d=f[c];h.push(g(d,this.getFieldConfig(d.name)))}return h},createFieldSet:function(b){var j=this,g=b.items||[],f=function(){return j.createField.apply(j,arguments)},k,a=null;for(var d=0,e=g.length;d<e;d++){k=g[d];if(k.xtype==="fieldset"){g[d]=this.createFieldSet(k)}else{if(NS.isNSComponent(k)){g[d]=k.component}else{if(NS.isString(k)){a=k;k=this.getFieldConfig(a)}else{if(k&&NS.isObject(k)){a=k.name;var h=this.getFieldConfig(a);NS.apply(h,k);k=h;if(k.readOnly==true){k.fieldStyle="background:#E6E6E6;"}}}g[d]=f(this.fcMap[a],k)}}}NS.applyIf(b,{layout:{type:"table",columns:b.columns||2}});delete b.columns;return new Ext.form.FieldSet(b)},createField:function(g,c){var a=this.fields,b=this.cascade;if(g.xtype=="combobox"&&c.editable==true){c.listeners={blur:function(f){var j=f.getValue();var h=f.getRawValue();if(j==h){f.setValue()}}}}var e=NS.util.FieldCreator.createField.apply(NS.util.FieldCreator,arguments);a.push(e);var d=e.fl;if(b[d]&&e.bmcc){b[d].push(e)}else{if(!b[d]&&e.bmcc){b[d]=[];b[d].push(e)}}return e},getFieldConfig:function(b){var d=this.fcMap[b]||{};if(!d){NS.error({sourceClass:"NS.form.EntityForm",sourceMethod:"getFieldConfig",msg:"name对应的组件没有查找到：name为"+b})}var a={width:270,labelWidth:70,fieldLabel:d.nameCh,maxLength:d.dbLength},c=this.fieldConfig||{};NS.apply(a,c);if(!d.isBlank){a.labelSeparator="<span >[</span><span style='color:red;'>*</span><span>]:</span>"}if(d.editable==false){a.readOnly=true;a.fieldStyle="background:#E6E6E6;"}NS.apply(a,this.getFieldConfigByFormType(d));return a},getFieldConfigByFormType:function(b){var c=this.formType,a={};switch(c){case"add":NS.apply(a,{hidden:b.isAddField==1?false:true});break;case"update":NS.apply(a,{hidden:b.isUpdateField==1?false:true});break;case"see":NS.apply(a,{readOnly:true,fieldStyle:"background:#E6E6E6;"})}return a},processCascade:function(){var a=this.cascade,c=a;for(var b in c){if(b&&c[b] instanceof Array){c[b].sort(function(e,d){if(e.bmcc>d.bmcc){return 1}if(e.bmcc<d.bmcc){return -1}return 0})}}for(var b in c){if(b&&c[b] instanceof Array){this.associate(c[b])}}},associate:function(c){var b;for(var a=0;a<c.length;a++){if(a==c.length-1){return}(function(h,d,e){var g=h[d],f=h[d+1];g.nextSelectCore=f;g.on("select",function(l,j){var m=j[0].get("id"),k=f;f.getStore().clearFilter();f.getStore().filter("pid",m);f.setValue();while(k){k.setValue();k=k.nextSelectCore}});f.on("expand",function(k,j){if(g.getValue()){f.getStore().clearFilter();f.getStore().filter(f.associateField||"pid",g.getValue())}return true})})(c,a,this)}}});NS.define("NS.form.field.Checkbox",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.Checkbox",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({inputValue:true,boxLabel:true,checked:true,draggable:true,handler:true,invalidText:true,readOnly:true,uncheckedValue:true,validateOnBlur:true,validateOnChange:true})},setSize:function(b,a){return this.component.setSize(b,a)},getInputValue:function(){return this.component.getSubmitValue()}});NS.define("NS.form.field.ComboBox",{extend:"NS.form.field.BaseField",initComponent:function(c){var a=c.fields||["id","mc"];var d=c.data||[];var b=Ext.create("Ext.data.Store",{fields:a,data:d});delete c.fields;delete c.data;var e={store:b,displayField:"mc",valueField:"id"};Ext.apply(e,c);this.component=Ext.create("Ext.form.field.ComboBox",e)},initConfigMapping:function(){this.callParent();this.addConfigMapping({data:true,valueField:true,autoSelect:true,allowBlank:true,blankText:true,displayField:true,disabled:true,editable:true,emptyText:true,multiSelect:true,pageSize:true,pickerAlign:true,pickerOffset:true,queryDelay:true,queryMode:true,queryParam:true,readOnly:true,regex:true,regexText:true,size:true,fields:true,vtype:true,listConfig:true,vtypeText:true})},getRawValue:function(){return this.component.getRawValue()},setRawValue:function(a){this.component.setRawValue(a)},filter:function(a,b){this.component.store.filter(a,b)},clearFilter:function(){this.component.store.clearFilter()},load:function(a){this.component.getStore().load(a)},loadData:function(b,a){if(typeof a=="undefined"){a=false}this.component.getStore().loadData(b,a)},loadRawData:function(b,a){if(typeof a=="undefined"){a=false}this.component.getStore().loadRawData(b,a)},getItemById:function(a){return this.component.getStore().getById(a).data},setDisabled:function(a){return this.component.setDisabled(a)}});NS.define("NS.form.field.Date",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.Date",a);if(a.enterFn){this.doEnterFn(a.enterFn)}},initConfigMapping:function(){this.callParent();this.addConfigMapping({allowBlank:true,blankText:true,editable:true,emptyText:true,format:true,grow:true,growAppend:true,growMax:true,growMin:true,pickerAlign:true,readOnly:true,regex:true,regexText:true,vtype:true,vtypeText:true,maxValue:true,disabled:true,minValue:true})},getRawValue:function(){return this.component.getRawValue()},isValid:function(){return this.component.isValid()},getSubmitValue:function(){return this.component.getSubmitValue()},setEditable:function(a){this.component.setEditable(a)},setFieldDefaults:function(a){this.component.setFieldDefaults(a)},setMaxValue:function(a){this.component.setMaxValue(a)},setMinValue:function(a){this.component.setMinValue(a)},getPicker:function(){return this.component.getPicker()},setStartDateField:function(a){this.component.startDateField=a.getLibComponent()},setEndDateField:function(a){this.component.endDateField=a.getLibComponent()},setDisabled:function(a){return this.component.setDisabled(a)}});NS.define("NS.form.field.Display",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.Display",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({disabled:true,htmlEncode:true,readOnly:true,saveDelay:true,validateOnBlur:true,validateOnChange:true})}});NS.define("NS.form.field.File",{extend:"NS.form.field.BaseField",initComponent:function(a){delete a.callBack;var b={buttonText:"上传"};Ext.apply(b,a);this.component=Ext.create("Ext.form.field.File",b)},initConfigMapping:function(){this.callParent();this.addConfigMapping({callBack:true,allowBlank:true,blankText:true,buttonOnly:true,buttonText:true,buttonConfig:true,editable:true,emptyText:true,disabled:true,grow:true,growAppend:true,growMax:true,growMin:true,readOnly:true,regex:true,regexText:true,size:true,vtype:true,vtypeText:true})},getModelData:function(){return this.component.getModelData()},setDocked:function(a,b){return this.component.setDocked()}});NS.define("NS.form.field.TextArea",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.TextArea",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({allowBlank:true,blankText:true,emptyText:true,grow:true,growAppend:true,growMax:true,growMin:true,readOnly:true,regex:true,regexText:true,size:true,vtype:true,vtypeText:true})},center:function(){return this.component.center()},enable:function(a){this.component.enable(a)},setFieldDefaults:function(a){this.component.setFieldDefaults(a)},hide:function(b,c,a){this.component.hide(b,c,a)},reset:function(){this.component.reset()}});NS.define("NS.form.field.Radio",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.Radio",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({boxLabel:true,inputValue:true,checked:true,disabled:true,readOnly:true,uncheckedValue:true,validateOnBlur:true,validateOnChange:true,handler:true,invalidText:true})},getGroupValue:function(){return this.component.getGroupValue()},reset:function(){this.component.reset()}});NS.define("NS.form.field.Number",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.field.Number",a);if(a.enterFn){this.doEnterFn(a.enterFn)}},initConfigMapping:function(){this.callParent();this.addConfigMapping({hideTrigger:true,allowBlank:true,blankText:true,editable:true,emptyText:true,disabled:true,grow:true,growAppend:true,growMax:true,growMin:true,maxText:true,maxValue:true,minText:true,minValue:true,nanText:true,negativeText:true,readOnly:true,regex:true,regexText:true,size:true,step:true,vtype:true,vtypeText:true})},isEqual:function(b,a){return this.component.isEqual(b,a)},reset:function(){this.component.reset()},setMinValue:function(a){this.component.setMinValue(a)},setMaxValue:function(a){this.component.setMaxValue(a)}});NS.define("NS.form.field.Time",{extend:"NS.form.field.BaseField",initComponent:function(b){var a={format:"G时i分",submitFormat:"G:i"};NS.apply(a,b);this.component=Ext.create("Ext.form.field.Time",a)},setMinValue:function(a){this.component.setMinValue(a)},setMaxValue:function(a){this.component.setMaxValue(a)}});NS.define("NS.form.field.ComboBoxTree",{extend:"NS.form.field.BaseField",initEvents:function(){this.callParent()},onSelect:function(){this.component.on("treeselect",function(a){this.fireEvent("select",this,a.raw,a)},this)},initComponent:function(a){this.component=Ext.create("Ext.ux.comboBoxTree",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({width:true,fieldLabel:true,editable:true,expanded:true,editable:true,height:true,treeData:true,pickerWidth:true,rootVisible:true,isLeafSelect:true,isParentSelect:true,rootName:true,emptyText:true,isLeafSelect:true,isParentSelect:true,notParentInfo:true,notLeafInfo:true})},setValue:function(a){this.component.setValue(a)},getValue:function(){return this.component.getValue()},setRawValue:function(a){this.component.setRawValue(a)},getRawValue:function(){return this.component.getRawValue()},onChange:function(){},reset:function(){this.component.reset()},loadData:function(a){this.component.reset();this.component.loadData(a)},getCurrentNodeRaw:function(a){return this.component.getCurrentNodeRaw(a)}});NS.define("NS.form.field.ItemSelector",{extend:"NS.form.field.BaseField",initComponent:function(a){this.processConfig(a);this.component=Ext.create("Ext.ux.form.ItemSelector",a)},processConfig:function(b){var c=this.backData=b.data;var a=new Ext.data.Store({fields:b.fields||["id","mc"],data:c});NS.applyIf(b,{store:a,displayField:"mc",valueField:"id",imagePath:"../ux/images/"});delete b.data},initConfigMapping:function(){this.callParent();this.addConfigMapping({fromTitle:true,title:true,toTitle:true})},removeOptionsByIds:function(e){var a=this.component,b=a.fromField.getStore(),c=a.toField.getStore(),d=function(j){for(var h=0,f=j.length;h<f;h++){var g=b.findRecord(a.valueField,j[[h]]);b.remove(g)}};if(NS.isArray(e)){d(e)}else{if(NS.isString(e)){d(e.split(","))}else{if(NS.isNumber(e)){d([e.toString()])}}}a.setValue()},addOptionsWithIds:function(h){var e=this.backData,g,b=this.component,c=b.fromField.getStore(),d=b.toField.getStore(),a=c.getRemovedRecords(),f=function(n){for(var m=0,j=n.length;m<j;m++){var p=n[m];for(var l=0;l<a.length;l++){if(p==a[l].get("id")){c.add(a[l])}}}};if(NS.isArray(h)){f(h)}else{if(NS.isString(h)){f(h.split(","))}else{if(NS.isNumber(h)){f([h.toString()])}}}b.setValue()},getRawValue:function(){var f=this.component.getValue(),d=this.component.toField.getStore(),c,e;var a=[];for(var b=0;b<f.length;b++){e=f[b];c=d.findRecord(this.component.valueField,e);a.push(c.get(this.component.displayField))}return a},loadData:function(d){var a=this.component,b=a.fromField.getStore(),c=a.toField.getStore();a.getStore().removeAll();a.getStore().loadData(d);b.removeAll();c.removeAll();b.add(a.getStore().getRange());a.syncValue()}});NS.define("NS.form.field.CheckboxGroup",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.CheckboxGroup",a)},initConfigMapping:function(){this.callParent();var a=function(d,c,b){b.readOnly=Boolean(!d);if(!d){b.fieldStyle="background:#E6E6E6;"}};this.addConfigMapping({items:true,columns:true,vertical:true})},setValue:function(){this.component.setValue.apply(this.component,arguments)},reset:function(){this.component.reset()}});NS.define("NS.form.field.RadioGroup",{extend:"NS.form.field.CheckboxGroup",initComponent:function(a){this.component=Ext.create("Ext.form.RadioGroup",a)},initConfigMapping:function(){this.callParent();var a=function(d,c,b){b.readOnly=Boolean(!d);if(!d){b.fieldStyle="background:#E6E6E6;"}};this.addConfigMapping({items:true,columns:true,vertical:true})},setValue:function(){this.component.setValue.apply(this.component,arguments)}});NS.define("NS.form.field.HtmlEditor",{extend:"NS.form.field.BaseField",initComponent:function(a){this.component=Ext.create("Ext.form.HtmlEditor",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({frame:true})}});NS.define("NS.form.field.ForumSearch",{extend:"NS.form.field.ComboBox",initComponent:function(a){this.component=Ext.create("Ext.form.field.ForumSearch",a)},getValue:function(){return this.component.getValue()},getRawValue:function(){return this.component.getRawValue()},getSubmitValue:function(){return this.component.getValue()},setValue:function(a){this.component.setValue(a)},loadData:function(a){this.component.loadData(a)},initEvents:function(){this.callParent();this.addEvents("beforeload")},onBeforeload:function(){this.component.on("beforeload",function(b,a){return this.fireEvent("beforeload",b)},this)},initConfigMapping:function(){this.callParent();this.addConfigMapping({service:true,name:true,queryParam:true,readOnly:true,fieldLabel:true,editable:true,minChars:true,displayField:true,valueField:true,emptyText:true,labelAlign:true,allowBlank:true,typeAhead:true,hideTrigger:true,labelWidth:true,width:true,valueNotFoundText:true,listConfig:true,pageSize:true,url:true,queryDelay:true,fields:true,getInnerTpl:true})},setQueryParams:function(a){this.component.setQueryParams(a)}});NS.define("NS.form.field.DateTime",{extend:"NS.form.field.Date",initComponent:function(a){this.component=new Ext.form.field.DateTime(a)}});NS.define("NS.form.field.DatePicker",{extend:"NS.form.field.BaseField",initComponent:function(a){var b=a.value;delete a.value;this.component=Ext.create("Ext.picker.Date",a);if(b){this.setValue(b)}},initConfigMapping:function(){this.callParent();this.addConfigMapping({format:true,maxValue:function(c,b,a){a.maxDate=c;delete a.maxValue},minValue:function(c,b,a){a.minDate=c;delete a.minValue}})},getValue:function(){return Ext.Date.format(this.component.getValue(),this.component.format||"Y-m-d")},setValue:function(a){if(NS.isDate(a)){this.component.setValue(a)}else{if(NS.isString(a)){this.component.setValue(Ext.Date.parse(a,this.component.format||"Y-m-d"))}}}});Ext.define("Ext.form.field.TimePicker",{extend:"Ext.form.field.Base",alias:"widget.timepicker",alternateClassName:"Ext.form.field.TimePickerField",requires:["Ext.form.field.Number"],inputType:"hidden",style:"padding:4px 0 0 0;margin-bottom:0px",value:null,spinnerCfg:{width:40},initComponent:function(){var b=this;b.value=b.value||Ext.Date.format(new Date(),"H:i:s");b.callParent();b.spinners=[];var a=Ext.apply({},b.spinnerCfg,{readOnly:b.readOnly,disabled:b.disabled,style:"float: left",listeners:{change:{fn:b.onSpinnerChange,scope:b}}});b.hoursSpinner=Ext.create("Ext.form.field.Number",Ext.apply({},a,{minValue:0,maxValue:23}));b.minutesSpinner=Ext.create("Ext.form.field.Number",Ext.apply({},a,{minValue:0,maxValue:59}));b.secondsSpinner=Ext.create("Ext.form.field.Number",Ext.apply({},a,{minValue:0,maxValue:59}));b.spinners.push(b.hoursSpinner,b.minutesSpinner,b.secondsSpinner)},onRender:function(){var c=this,a,b;c.callParent(arguments);a=Ext.dom.Query.select("td",this.getEl().dom)[1];b=Ext.get(a);c.callSpinnersFunction("render",b);Ext.core.DomHelper.append(b,{tag:"div",cls:"x-form-clear-left"});this.setRawValue(this.value)},_valueSplit:function(a){if(Ext.isDate(a)){a=Ext.Date.format(a,"H:i:s")}var b=a.split(":");return{h:b.length>0?b[0]:0,m:b.length>1?b[1]:0,s:b.length>2?b[2]:0}},onSpinnerChange:function(){if(!this.rendered){return}this.fireEvent("change",this,this.getValue(),this.getRawValue())},callSpinnersFunction:function(c,a){for(var b=0;b<this.spinners.length;b++){this.spinners[b][c](a)}},getRawValue:function(){if(!this.rendered){var a=this.value||new Date();return this._valueSplit(a)}else{return{h:this.hoursSpinner.getValue(),m:this.minutesSpinner.getValue(),s:this.secondsSpinner.getValue()}}},setRawValue:function(a){a=this._valueSplit(a);if(this.hoursSpinner){this.hoursSpinner.setValue(a.h);this.minutesSpinner.setValue(a.m);this.secondsSpinner.setValue(a.s)}},getValue:function(){var a=this.getRawValue();return Ext.String.leftPad(a.h,2,"0")+":"+Ext.String.leftPad(a.m,2,"0")+":"+Ext.String.leftPad(a.s,2,"0")},setValue:function(a){this.value=Ext.isDate(a)?Ext.Date.format(a,"H:i:s"):a;if(!this.rendered){return}this.setRawValue(this.value);this.validate()},disable:function(){this.callParent(arguments);this.callSpinnersFunction("disable",arguments)},enable:function(){this.callParent(arguments);this.callSpinnersFunction("enable",arguments)},setReadOnly:function(){this.callParent(arguments);this.callSpinnersFunction("setReadOnly",arguments)},clearInvalid:function(){this.callParent(arguments);this.callSpinnersFunction("clearInvalid",arguments)},isValid:function(a){return this.hoursSpinner.isValid(a)&&this.minutesSpinner.isValid(a)&&this.secondsSpinner.isValid(a)},validate:function(){return this.hoursSpinner.validate()&&this.minutesSpinner.validate()&&this.secondsSpinner.validate()}});Ext.define("Ext.form.field.DateTimePicker",{extend:"Ext.picker.Date",alias:"widget.datetimepicker",todayText:"确定",timeLabel:"时间",initComponent:function(){var a=this.value||new Date();this.callParent();this.value=a},onRender:function(b,a){if(!this.timefield){this.timefield=Ext.create("Ext.form.field.TimePicker",{fieldLabel:this.timeLabel,labelWidth:40,value:Ext.Date.format(this.value,"H:i:s")})}this.timefield.ownerCt=this;this.timefield.on("change",this.timeChange,this);this.callParent(arguments);var c=Ext.get(Ext.DomQuery.selectNode("table",this.el.dom));var e=Ext.core.DomHelper.insertAfter(c,{tag:"div",style:"border:0px;",children:[{tag:"div",cls:"x-datepicker-footer ux-timefield"}]},true);this.timefield.render(this.el.child("div div.ux-timefield"));var d=this.getEl().parent("div.x-layer");if(d){d.setStyle("height",d.getHeight()+31)}},timeChange:function(c,b,a){this.value=this.fillDateTime(this.value)},fillDateTime:function(b){if(this.timefield){var a=this.timefield.getRawValue();b.setHours(a.h);b.setMinutes(a.m);b.setSeconds(a.s)}return b},changeTimeFiledValue:function(a){this.timefield.un("change",this.timeChange,this);this.timefield.setValue(this.value);this.timefield.on("change",this.timeChange,this)},setValue:function(a){this.value=a;this.changeTimeFiledValue(a);return this.update(this.value)},getValue:function(){return this.fillDateTime(this.value)},handleDateClick:function(f,a){var d=this,c=d.handler;f.stopEvent();var b=Ext.fly(a.parentNode.parentNode.parentNode).query("TD");if(!d.disabled&&a.dateValue&&!Ext.fly(a.parentNode).hasCls(d.disabledCellCls)){d.doCancelFocus=d.focusOnSelect===false;d.setValue(this.fillDateTime(new Date(a.dateValue)));delete d.doCancelFocus;d.fireEvent("select",d,d.value,false);if(c){c.call(d.scope||d,d,d.value)}Ext.fly(a.parentNode).addCls(" x-datepicker-selected")}},selectToday:function(){var c=this,a=c.todayBtn,b=c.handler;if(a&&!a.disabled){c.fireEvent("select",c,c.value,true);if(b){b.call(c.scope||c,c,c.value)}c.onSelect()}return c}});Ext.define("Ext.form.field.DateTime",{extend:"Ext.form.field.Date",alias:"widget.datetimefield",minText:"日期的值必须大于或等于 {0}",maxText:"日期的值必须小于或等于 {0}",initComponent:function(){this.format=this.format;this.callParent()},createPicker:function(){var a=this,b=Ext.String.format;return Ext.create("Ext.form.field.DateTimePicker",{ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,minDate:a.minValue,maxDate:a.maxValue,disabledDatesRE:a.disabledDatesRE,disabledDatesText:a.disabledDatesText,disabledDays:a.disabledDays,disabledDaysText:a.disabledDaysText,format:a.format,showToday:a.showToday,startDay:a.startDay,minText:b(a.minText,a.formatDate(a.minValue)),maxText:b(a.maxText,a.formatDate(a.maxValue)),listeners:{scope:a,select:a.onSelect},keyNavConfig:{esc:function(){a.collapse()}}})},onSelect:function(a,e,b){var c=this;c.setValue(e);c.fireEvent("select",c,e);if(b){c.collapse()}},getErrors:function(n){var v=this,j=[],f=v.validator,k=v.emptyText,m=v.allowBlank,x=v.vtype,w=Ext.form.field.VTypes,c=v.regex,r=Ext.String.format,e;n=n||v.processRawValue(v.getRawValue());if(Ext.isFunction(f)){e=f.call(v,n);if(e!==true){j.push(e)}}if(n.length<1||n===k){if(!m){j.push(v.blankText)}return j}if(n.length<v.minLength){j.push(r(v.minLengthText,v.minLength))}if(n.length>v.maxLength){j.push(r(v.maxLengthText,v.maxLength))}if(x){if(!w[x](n,v)){j.push(v.vtypeText||w[x+"Text"])}}if(c&&!c.test(n)){j.push(v.regexText||v.invalidText)}var r=Ext.String.format,d=Ext.Date.clearTime,b=v.disabledDays,h=v.disabledDatesRE,l=v.minValue,u=v.maxValue,s=b?b.length:0,q=0,t,a,p,g;n=v.formatDate(n||v.processRawValue(v.getRawValue()));if(n===null||n.length<1){return j}t=n;n=v.parseDate(n);if(!n){j.push(r(v.invalidText,t,v.format));return j}g=n.getTime();if(l&&g<l.getTime()){j.push(r(v.minText,v.formatDate(l)))}if(u&&g>u.getTime()){j.push(r(v.maxText,v.formatDate(u)))}if(b){p=n.getDay();for(;q<s;q++){if(p===b[q]){j.push(v.disabledDaysText);break}}}a=v.formatDate(n);if(h&&h.test(a)){j.push(r(v.disabledDatesText,a))}return j}});Ext.apply(Ext.form.VTypes,{daterange:function(d,c){var b=c.parseDate(d);if(!b){return}if(c.startDateField&&(!this.dateRangeMax||(b.getTime()!=this.dateRangeMax.getTime()))){var e=c.startDateField;e.setMaxValue(b);e.validate();this.dateRangeMax=b}else{if(c.endDateField&&(!this.dateRangeMin||(b.getTime()!=this.dateRangeMin.getTime()))){var a=c.endDateField;a.setMinValue(b);a.validate();this.dateRangeMin=b}}return true},datetimerange:function(d,c){var b=c.parseDate(d);if(!b){return}if(c.startDateField&&(!this.dateRangeMax||(b.getTime()!=this.dateRangeMax.getTime()))){var e=c.startDateField;e.setMaxValue(b);e.validate();this.dateRangeMax=b}else{if(c.endDateField&&(!this.dateRangeMin||(b.getTime()!=this.dateRangeMin.getTime()))){var a=c.endDateField;a.setMinValue(b);this.dateRangeMin=b;a.validate()}}return true}});NS.define("NS.menu.Menu",{extend:"NS.container.Panel",initData:NS.emptyFn,initConfigMapping:function(){this.callParent();this.addConfigMapping({defaults:true,defaultType:true,disabled:true,dockedItems:true,hideCollapseTool:true,ignoreParentClicks:true,plain:true,showSeparator:true})},initComponent:function(a){this.component=Ext.create("Ext.menu.Menu",a)},onClick:function(){this.component.on("click",function(c,b,a){NS.Event.setEventObj(a);this.fireEvent("click",NS.util.ComponentInstance.getInstance(c),b,NS.Event)},this)}});NS.define("NS.window.Window",{extend:"NS.container.Panel",initComponent:function(a){a.constrainTo=a.constrainTo||Ext.getBody();a.constrain=a.constrain!==undefined?a.constrain:true;this.component=Ext.create("Ext.window.Window",a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({autoShow:true,bodyPadding:true,shadow:true,buttonAlign:true,constrain:true,buttons:true,tools:true,resizable:true,modal:true,closable:true,closeAction:true,collapsed:true,x:true,y:true})}});Ext.define("Ext.form.field.ForumSearch",{extend:"Ext.form.ComboBox",allowBlank:false,typeAhead:false,hideTrigger:true,labelWidth:70,width:280,pageSize:10,queryDelay:500,queryCaching:false,queryParam:"mc",minChars:3,displayField:"mc",valueField:"id",initComponent:function(){var a=this.initialConfig;this.callParent();this.addEvents("beforeload");this.initStore(a.service,a.fields,typeof(a.pageSize)!="undefined"?a.pageSize:this.pageSize);var b=a.getInnerTpl;delete a.url;delete a.fields;if(b){delete a.getInnerTpl}this.listConfig={loadingText:"请稍后...",emptyText:"无查询结果",getInnerTpl:b||function(){return'<a class="search-item" id={id}>名称：<b>{mc}</b></a>'}}},_baseAction:"baseAction!queryByComponents.action",initStore:function(b,a,c){b=b||{};var e=b.params||{};e.singleReturnNoComponent=1;e=JSON.stringify(e);var d=this._baseAction+'?components={"queryTableContent": {"request": "'+b.serviceName+'","params":'+e+" }}";Ext.define("model",{extend:"Ext.data.Model",proxy:{type:"ajax",url:d,reader:{type:"json",root:"data",totalProperty:"count"},doRequest:function(f,k,g){var j=this.getWriter(),h=this.buildRequest(f,k,g);if(f.allowWrite()){h=j.write(h)}Ext.apply(h,{headers:this.headers,timeout:this.timeout,scope:this,callback:this.createRequestCallback(h,f,k,g),method:"post",disableCaching:false});Ext.Ajax.request(h);return h}},fields:a||["id","mc"]});this.store=Ext.create("Ext.data.Store",{pageSize:c||10,model:"model"});this.store.addListener("beforeload",function(g,f,h){return this.fireEvent("beforeload",f.params,h)},this)},setQueryParams:function(b){for(var a in b){this.store.getProxy().setExtraParam(a,b[a])}}});NS.define("NS.appExpand.DateSection",{extend:"NS.Component",initConfigMapping:function(){this.callParent();this.addConfigMapping({})},initEvents:function(){this.callParent()},packEvents:function(){this.callParent();this.addEvents("validatepass")},onValidatepass:function(){this.component.on("validatepass",function(){this.fireEvent("validatepass",this)},this)},initComponent:function(a){this.callParent();this.createFieldSet()},createFieldSet:function(){var a=this.fromDateField=Ext.create("Ext.form.field.Date",{width:120,fieldLabel:"起",labelWidth:20,name:"from_date",format:"Y-m-d",editable:false});var b=this.toDateField=Ext.create("Ext.form.field.Date",{width:120,margin:"0 0 0 5",fieldLabel:"止",labelWidth:20,name:"to_date",format:"Y-m-d",editable:false});this.component=Ext.create("Ext.container.Container",{layout:"hbox",padding:0,margin:"0 0 0 0",width:250,height:26,border:false,items:[a,b]});this.validate()},validate:function(){this.toDateField.addListener("change",function(b,e,c){var a=b.getRawValue(),d=this.fromDateField.getRawValue();if(d!=""){if(a>=d){this.component.fireEvent("validatepass")}else{this.toDateField.focus();this.toDateField.setValue(null)}}},this);this.fromDateField.addListener("change",function(b,e,c){this.toDateField.setValue(null);var d=b.getRawValue(),a=this.toDateField.getRawValue();this.toDateField.setMinValue(d);if(a!=""){if(a>=d){this.component.fireEvent("validatepass")}else{this.fromDateField.setValue(null);this.fromDateField.focus()}}},this)},render:function(a){this.component.render(a)},getRawValue:function(){var b=this.component.getComponent(0).getRawValue(),a=this.component.getComponent(1).getRawValue();return{fromDate:b,toDate:a}},setDisabled:function(){this.component.getComponent(0).setDisabled(true);this.component.getComponent(1).setDisabled(true)},setValue2Today:function(){this.component.getComponent(0).setValue(new Date());this.component.getComponent(1).setValue(new Date())},setValue:function(a){this.component.getComponent(0).setValue(new Date(a.from));this.component.getComponent(1).setValue(new Date(a.to))}});NS.define("NS.appExpand.CompoSection",{extend:"NS.Component",initConfigMapping:function(){this.callParent();this.addConfigMapping({fromCompo:true,toCompo:true})},initEvents:function(){this.callParent()},packEvents:function(){this.callParent();this.addEvents("validatepass")},onValidatepass:function(){this.component.on("validatepass",function(){this.fireEvent("validatepass",this)},this)},initComponent:function(a){this.callParent();this.createFieldSet(a)},createFieldSet:function(a){this.component=Ext.create("Ext.container.Container",{layout:"hbox",padding:0,margin:"0 0 0 0",width:250,height:26,border:false,items:[a.fromCompo.getLibComponent(),a.toCompo.getLibComponent()]});this.validate(a)},validate:function(a){var b=a.fromCompo.getLibComponent(),c=a.toCompo.getLibComponent();c.addListener("change",function(e,h,f){var d=e.getValue(),g=b.getValue();if(g!=""){if(d>=g){this.component.fireEvent("validatepass")}else{c.focus();c.setValue(null)}}},this);b.addListener("change",function(d,f,e){c.setValue(null)},this)},render:function(a){this.component.render(a)},getValue:function(){var b=this.component.getComponent(0).getValue(),a=this.component.getComponent(1).getValue();return{from:b,to:a}},getRawValue:function(){var b=this.component.getComponent(0).getRawValue(),a=this.component.getComponent(1).getRawValue();return{from:b,to:a}},setDisabled:function(){this.component.getComponent(0).setDisabled(true);this.component.getComponent(1).setDisabled(true)},setValue:function(a){this.component.getComponent(0).setValue(a.from),this.component.getComponent(1).setValue(a.to)}});NS.define("NS.appExpand.RadioGroup",{extend:"NS.Component",initConfigMapping:function(){this.callParent();this.addConfigMapping({items:true})},initEvents:function(){this.callParent()},packEvents:function(){this.callParent()},initComponent:function(a){this.radioCompoMap={};this.radioNSCompoMap={};this.callParent();this.createFieldSet(a)},createFieldSet:function(b){var a=b.items,f=a.length,c=0,g=false,h=false;this.component=Ext.create("Ext.container.Container",{layout:{type:"hbox",align:"middle"},padding:0,margin:"0 0 0 0",height:26,border:false});var d=0;for(;c<f;c++){var e=a[c];(function(l,k){h=!g&&l.checked?true:false;var j=new Ext.form.field.Radio({name:l.radioGroupName,inputValue:l.radioKey,checked:h,labelWidth:l.labelWidth,fieldLabel:l.fieldLabel});var m=Ext.create("Ext.container.Container",{layout:"column",padding:0,margin:"0 0 0 0",width:l.width,height:26,border:false,items:[j,l.compo.getLibComponent()]});if(!h){l.compo.getLibComponent().setDisabled(true)}else{k.checkedCompo=l.compo}k.radioCompoMap[l.radioKey]=m;k.radioNSCompoMap[l.radioKey]=l.compo;j.addListener("change",function(p,r,n){var q=p.inputValue;if(!r&&n){k.radioCompoMap[q].getComponent(1).setDisabled(true)}else{if(r&&!n){k.checkedCompo=k.radioNSCompoMap[q];k.radioCompoMap[q].getComponent(1).setDisabled(false)}}},k);d=d+l.width;k.component.add(m)})(e,this)}this.component.setWidth(d)},render:function(a){this.component.render(a)},getRawValue:function(){return this.checkedCompo.getRawValue()},getValue:function(){return this.checkedCompo.getValue()}});Ext.define("Ext.ux.comboBoxTree",{extend:"Ext.form.field.Picker",enableKeyEvents:true,initComponent:function(){this.callParent(arguments);this.addEvents("treeselect","selectcheck");var g=this.initialConfig;var d=false,h=true,f=g.rootName,j=g.treeData,e=g.height,b=g.width||210;var a=g.pickerWidth||0;if(g.rootVisible==true){d=true}if(g.expanded==false){h=false}var c={expanded:h,text:f||"根",children:j||[]},k={rootVisible:d,height:e||300};if(j){delete g.treeData}if(d){delete g.rootVisible}if(h){delete g.expanded}if(f){delete g.rootName}if(e){delete g.height}var p={isLeafSelect:true,notLeafInfo:"此节点已设置为不可选,可更改isLeafSelect为true时可选",isParentSelect:true,notParentInfo:"此节点已设置为不可选,可更改isParentSelect为true时可选",editable:false};NS.apply(p,g);var q={expanded:true,children:[]};var l={rootVisible:false,floating:true,height:300,autoScroll:true,focusOnToFront:false,useArrows:true};Ext.apply(q,c);var n=this,m=this.__store=Ext.create("Ext.data.TreeStore",{root:q});Ext.apply(l,k);l.store=m;Ext.apply(p,l);this.picker=Ext.create("Ext.tree.Panel",p);this.on("blur",function(r,s){this.setValue(this.getValue())},this);this.on("expand",function(){if(a!=0){this.picker.setWidth(a)}},this);this.picker.on({checkchange:function(w,s){n.checkedAllChildren(w,s);var v=w.parentNode;if(s==true){while(v){v.set("checked",true);v=v.parentNode}}else{if(s==false){while(v){var r=n.judgeHasChildChecked(w,v);if(r==true){break}else{if(r==false){v.set("checked",false);v=v.parentNode}}}}}var u=n.picker.getView().getChecked(),t=[];Ext.Array.each(u,function(x){t.push(x.get("id"))});n.setValue(t.join(","));n.fireEvent("selectcheck",w)},itemclick:function(s,r){if(r.isLeaf()){if(p.isLeafSelect){}else{Ext.Msg.alert("提示",p.notLeafInfo+"!");return}}if(!r.isLeaf()){if(p.isParentSelect){}else{Ext.Msg.alert("提示",p.notParentInfo+"!");return}}if(r.get("checked")==undefined){n.setValue(r.get("id"));n.collapse()}else{r.set("checked",!r.get("checked"));this.fireEvent("checkchange",r,r.get("checked"))}n.fireEvent("treeselect",r)}})},getCurrentNodeRaw:function(b){var a=this.picker.getStore().getNodeById(b);if(a){return a.raw}return{}},checkedAllChildren:function(g,e){var h=g.childNodes;var d=h;if(d&&d.length>0){var b=[];while(d.length!=0){for(var f=0,a=d.length;f<a;f++){var j=d[f];j.set("checked",e);if(j.childNodes){b=b.concat(j.childNodes)}}d=b;b=[]}}},judgeHasChildChecked:function(g,f){var b=false;if(f.parentNode){var h=f;var d=h.childNodes;for(var e=0,a=d.length;e<a;e++){if(d[e].get("checked")==true){b=true;break}}}return b},getPicker:function(){var a=this;a.picker.ownerCt=a.ownerCt;return a.picker||(a.picker=a.createPicker())},setValue:function(a){if(a==null||typeof a=="undefined"){this.values=null;this.setRawValue("");return}var e=a.toString().split(",");var f=[],j=[],h=this.picker.getStore();for(var c=0,d=e.length;c<d;c++){var g=e[c];var b=h.getNodeById(g);if(b){if(b.get("id")!="root"){f.push(b.get("text"));j.push(b.get("id"));if(typeof b.get("checked")!="undefined"&&b.get("checked")!=null){b.set("checked",true);b.commit(true)}}}}this.values=j.join(",");var k=this.text=f.join(",");this.setRawValue(k)},getValue:function(){return this.values},getSubmitValue:function(){return this.values},setRawValue:function(a){this.texts=a;this.callParent([a])},getRawValue:function(){return this.texts||""},reset:function(){this.callParent();var a=this.picker.getStore();var b=a.getRootNode();if(typeof b.get("checked")!="undefined"&&b.get("checked")!=null){this.checkedAllChildren(b,false)}this.setValue(this.originalValue);this.clearInvalid();delete this.wasValid},loadData:function(b){var a=this.picker.getStore();a.removeAll();a.setRootNode({expanded:true,text:"根",children:b})}});NS.define("NS.form.field.ForumSearch",{extend:"NS.form.field.ComboBox",initComponent:function(a){this.component=Ext.create("Ext.form.field.ForumSearch",a)},getValue:function(){return this.component.getValue()},getRawValue:function(){return this.component.getRawValue()},getSubmitValue:function(){return this.component.getValue()},setValue:function(a){this.component.setValue(a)},loadData:function(a){this.component.loadData(a)},initEvents:function(){this.callParent();this.addEvents("beforeload")},onBeforeload:function(){this.component.on("beforeload",function(b,a){return this.fireEvent("beforeload",b)},this)},initConfigMapping:function(){this.callParent();this.addConfigMapping({service:true,name:true,queryParam:true,readOnly:true,fieldLabel:true,editable:true,minChars:true,displayField:true,valueField:true,emptyText:true,labelAlign:true,allowBlank:true,typeAhead:true,hideTrigger:true,labelWidth:true,width:true,valueNotFoundText:true,listConfig:true,pageSize:true,url:true,queryDelay:true,fields:true,getInnerTpl:true})},setQueryParams:function(a){this.component.setQueryParams(a)}});NS.define("NS.grid.TransformGrid",{extend:"NS.Component",initComponent:function(f){var d=f.fields;var a="";var j="";var h={};for(var c=0,g=d.length;c<g;c++){a+="<td>"+d[c].nameCh+"</td>";j+="<td>{[this."+d[c].name+"(values."+d[c].name+")]}</td>";h[d[c].name]=function(k){return k}}var b=f.format;Ext.apply(h,b);delete f.format;var e=new Ext.XTemplate('<table class="transformgrid-base">',"<tr>",a,"</tr>",'<tpl for=".">',"<tr>",j,"</tr>","</tpl>","</table>",h);if(!f.tpl){f.tpl=e}this.component=Ext.create("Ext.Component",f)},initConfigMapping:function(){this.callParent();this.addConfigMapping({tpl:true,padding:true,fields:true,format:true,data:true})}});NS.define("NS.button.Download",{extend:"NS.button.Button",initComponent:function(a){var c=this,b={text:"导出"};Ext.apply(b,a);c.component=Ext.create("Ext.button.Button",b);c.component.addListener("click",function(){alert("---")})}});NS.define("NS.window.MessageBox",{extend:"NS.window.Window",OK:Ext.Msg.OK,YES:Ext.Msg.YES,NO:Ext.Msg.NO,CANCEL:Ext.Msg.CANCEL,OKCANCEL:Ext.Msg.OKCANCEL,YESNO:Ext.Msg.YESNO,YESNOCANCEL:Ext.Msg.YESNOCANCEL,INFO:Ext.Msg.INFO,WARNING:Ext.Msg.WARNING,QUESTION:Ext.Msg.QUESTION,ERROR:Ext.Msg.ERROR,initConfigMapping:function(){this.callParent();this.addConfigMapping({autoShow:true,buttons:true,buttonAlign:true,closable:true,closeAction:true,hidden:true,height:true,html:true,icon:true,iconCls:true,title:true,msg:true,listener:true,width:true})},initComponent:function(a){this.component=Ext.create("Ext.window.MessageBox",a)},show:function(a){this.component.show(a);return this.component},alert:function(a,d,c,b){return this.component.alert(a,d,c,b)},confirm:function(a,d,c,b){return this.component.confirm(a,d,c,b)},prompt:function(b,f,d,c,a,e){return this.component.prompt(b,f,d,c,a,e)},hide:function(){this.component.hide()},close:function(){this.component.close()},info:function(){var b=arguments[0];if(NS.isObject(b)){b.title=b.title||"信息提示";b.icon=b.icon||this.INFO;b.buttons=b.buttons||this.OK}else{if(NS.isString(b)){var a=arguments.length;if(a==1){b={};b.msg=arguments[0]}else{if(a==2){b={};b.title=arguments[0];b.msg=arguments[1]}else{throw"NS.Msg.info() : length is not valid!"}}b.title=b.title||"信息提示";b.icon=b.icon||this.INFO;b.buttons=b.buttons||this.OK}else{throw"NS.Msg.info() : type is not valid !"}}return this.show(b)},warning:function(){var b=arguments[0];if(NS.isObject(b)){b.title=b.title||"警告提示";b.icon=b.icon||this.WARNING;b.buttons=b.buttons||this.OK}else{if(NS.isString(b)){var a=arguments.length;if(a==1){b={};b.msg=arguments[0]}else{if(a==2){b={};b.title=arguments[0];b.msg=arguments[1]}else{throw"NS.Msg.warning() : length is not valid!"}}b.title=b.title||"警告提示";b.icon=b.icon||this.WARNING;b.buttons=b.buttons||this.OK}else{throw"NS.Msg.warning() : type is not valid !"}}return this.show(b)},error:function(){var b=arguments[0];if(NS.isObject(b)){b.title=b.title||"错误提示";b.icon=b.icon||this.ERROR;b.buttons=b.buttons||this.OK}else{if(NS.isString(b)){var a=arguments.length;if(a==1){b={};b.msg=arguments[0]}else{if(a==2){b={};b.title=arguments[0];b.msg=arguments[1]}else{throw"NS.Msg.error() : length is not valid!"}}b.title=b.title||"错误提示";b.icon=b.icon||this.ERROR;b.buttons=b.buttons||this.OK}else{throw"NS.Msg.error() : type is not valid !"}}return this.show(b)},changeTip:function(a,h,f,e){var g="",d,b,c;if(NS.isObject(a)){b=a.fn;d=a.msg;g=a.title;c=a.scope}else{if(NS.isString(a)){g=a;d=h;b=f;c=e}}return this.confirm(g,d,function(j){if(j=="yes"){b.call(c||this)}})}});NS.MessageBox=NS.Msg=new NS.window.MessageBox();NS.define("NS.mvc.Controller",{constructor:function(a){var b=this;this.addEvents("pageready","tplready");NS.apply(this,a);this.initCss();this.initModel();this.initView();this.initAdvanceDataRequires();this.initTplRequires(function(){this.fireEvent("tplready");this.tplready=true;this.initDataRequires(function(){this.init(a)})})},initAdvanceDataRequires:function(){var d=this.advanceDataRequires,a={},b=0,c;this.advanceDataRequiresFlag=false;this.advanceDataRequiresExcute=function(){};if(d&&d.length!=0){for(;b<d.length;b++){c=d[b];a[c.key]=c.fieldname}this.callService(d,function(h){var f,g,e;for(var f in a){e=a[f];g=h[f];this[e]=g}this.advanceDataRequiresFlag=true;this.advanceDataRequiresExcute()})}},getAdvanceData:function(b,g){var e=this,f={},c=0,d,a=b.length;if(this.advanceDataRequiresFlag){for(;c<a;c++){d=b[c];f[d]=this[d]}g.call(this,f)}else{this.advanceDataRequiresExcute=function(){e.getAdvanceData(b,g)}}},initTplRequires:function(f){var e=this.tplRequires||[],a={},b=0,d,c=e.length;if(e.length!=0){for(;b<e.length;b++){d=e[b];(function(g){NS.loadFile(d.path,function(h){this[g]=new NS.Template(h);c=c-1;if(c==0){f.apply(this)}},this)}).call(this,d.fieldname)}}else{f.apply(this)}},initDataRequires:function(f){var d=this.dataRequires||[],a={},e={},b=0,c;if(d.length!=0){for(;b<d.length;b++){c=d[b];a[c.key]=c.fieldname;e[c.key]=c.process}this.callService(d,function(k){var h,j,g,l;for(var h in a){g=a[h];l=e[h];j=k[h];if(l&&NS.isFunction(l)){this[g]=l(j)}else{if(NS.isObject(l)){this[g]=l.fn.call(l.scope,j)}else{this[g]=j}}}f.apply(this)})}else{f.apply(this)}},initCss:function(){var c=this.cssRequires||[],b=0,a;for(a=c.length;b<a;b++){NS.loadCss(c[b])}},initModel:function(){var a={baseSave:"base_save",baseUpdate:"base_update",baseDelete:"base_deleteByIds",baseQuery:"base_queryTableContent",baseTableHeader:"base_queryForAddByEntityName"};if(this.modelConfig&&this.modelConfig.serviceConfig){NS.apply(this.modelConfig.serviceConfig,a)}this.model=new NS.mvc.Model(this.modelConfig)},initView:function(){this.view=new NS.mvc.View(this.viewConfig)},init:NS.emptyFn,getModel:function(){return this.model},getView:function(){return this.view},registerComponent:function(a){var b=this.view.register;b.apply(this.view,arguments)},getComponent:function(a){return this.view.get(a)},callService:function(b,c,a){this.model.callService(b,c,a||this)},callServiceWithTimeOut:function(c,d,b,a){this.model.callService(c,d,a||this,b)},callSingle:function(c,a,b){this.model.callSingle.call(this.model,c,a,b||this)},registerDataLoader:function(b,a){a.registerDataLoader(b,this.model)},setPageComponent:function(a){this.view.setComponent(a);this.fireEvent("pageready");this.pageReady=true},getLibComponent:function(){return this.view.getLibComponent()},ready:function(){this.fireEvent("pageready")},updateServiceConfig:function(){this.model.updateServiceConfig.apply(this.model,arguments)},updateServiceParams:function(a,b){this.model.updateServiceParams.apply(this.model,arguments)},baseAdd:function(b,e,d,c){var a={entityName:b};NS.apply(a,e);this.callService({key:"baseSave",params:a},function(f){d.call(c||this,f.baseSave)})},baseDelete:function(b,e,d,c){var a={entityName:b,ids:e.toString()};this.callService({key:"baseDelete",params:a},function(f){d.call(c||this,f.baseDelete)})},baseUpdate:function(b,e,d,c){var a={entityName:b};NS.apply(a,e);this.callService({key:"baseUpdate",params:a},function(f){d.call(c||this,f.baseUpdate)})},baseTableHeader:function(b,d,c){var a={entityName:b};this.callService({key:"baseTableHeader",params:a},function(g){var e=g.baseTableHeader,f=NS.E2S(e);d.call(c||this,f)})},baseEntityHeaderAndTableData:function(a,c,b){var e={key:"baseTableHeader",params:{entityName:a}},d={key:"baseQuery",params:{entityName:a}};this.callService([e,d],function(h){var f=h.baseTableHeader,g=NS.E2S(f),j=h.baseQuery;c.call(b||this,g,j)})},baseHeaderAndData:function(b,e,d,c){var a={key:"baseTableHeader",params:{entityName:b}};if(!e){NS.Error({sourceClas:"Template.Page",sourceMethod:"baseHeaderAndData",msg:"必须输入请求表数据Service！"})}this.callService([a,e],function(h){var f=h.baseTableHeader,g=NS.E2S(f);if(NS.isString(e)){d.call(c||this,g,h[e])}else{d.call(c||this,g,h[e.key])}})},bindNode:function(a){this.CD_NODE=a},bindLoadMask:function(a){this.loadMask=a},showLoadMask:function(){this.loadMask.hide()},hasFun:function(d){var c=this.CD_NODE.children,a=false;buttons=[];for(var b=0;b<c.length;b++){var e=c[b];if(e&&e.funTag==d){return true}}return a},getContentsByFun:function(a){var d=this.CD_NODE.children,b,f=[];for(var c=0;c<d.length;c++){var e=d[c];if(e.funTag==a){b=e;break}}for(var c=0;c<b.children.length;c++){f.push(b.children[c].funTag)}return f}});NS.define("NS.mvc.Model",{constructor:function(){this.initData.apply(this,arguments);this.allServiceConfig={};NS.apply(this.allServiceConfig,this.serviceConfig);this.init()},initData:function(a){this.initConnection();NS.apply(this,a)},init:NS.emptyFn,initConnection:function(){this.connection=new NS.Connection()},callService:function(b,j,k,h){var g=this,c={};var a=function(n){var p={};if(NS.isObject(n)){var m=n.key;var l=g.getServiceConfig(m);p[m]={};p[m]["request"]=l.service;p[m]["params"]=NS.clone(l.params)||{};NS.apply(p[m].params,n.params)}else{if(NS.isString(n)){var l=g.getServiceConfig(n);if(l){p[n]={};p[n]["request"]=l.service;p[n]["params"]=NS.clone(l.params)||{}}}}return p};var e=Ext.Object;if(NS.isArray(b)){for(var d=0,f=b.length;d<f;d++){e.merge(c,a(b[d]))}}else{if(NS.isString(b)){e.merge(c,a(b))}else{if(NS.isObject(b)){e.merge(c,a(b))}}}this.connection.callService(c,j,k,h)},syncCallService:function(f){var d=this,b={};var e=function(j){var k={};if(NS.isObject(j)){var h=j.key;var g=d.getServiceConfig(h);k[h]={};k[h]["request"]=g.service;k[h]["params"]=g.params||{};NS.apply(k[h].params,j.params)}else{if(NS.isString(j)){var g=d.getServiceConfig(j);if(g){k[j]={};k[j]["request"]=g.service;k[j]["params"]=g.params||{}}}}return k};if(NS.isArray(f)){for(var c=0,a=f.length;c<a;c++){NS.apply(b,e(f[c]))}}else{if(NS.isString(f)){NS.apply(b,e(f))}else{if(NS.isObject(f)){NS.apply(b,e(f))}}}return this.connection.callService(b,callback,scope)},callSingle:function(a,b,c){this.callService(a,function(d){if(NS.isString(a)){b.call(c||this,d[a])}else{if(NS.isObject(a)){b.call(c||this,d[a.key])}}})},syncCall:function(a,d){var c={result:{request:a,params:NS.encode(d||{})}};var b=this.connection.syncCallService(c);return b.result},getServiceConfig:function(b){var a,c={};if(b){var a=this.allServiceConfig[b];if(a){if(NS.isObject(a)){return a}else{if(NS.isString(a)){c.service=a;return c}}}else{NS.error({sourceClass:"NS.mvc.Model",sourceMethod:"getServiceConfig",msg:"找不到请求的service："+b})}}return NS.clone(this.allServiceConfig[b])},updateServiceConfig:function(c,a){var d=this.allServiceConfig,b;if(NS.isString(c)){d[c]=a}else{if(NS.isObject(c)){for(b in c){d[b]=c[b]}}}},updateServiceParams:function(c,e){var d=this.allServiceConfig,b,a=d[c];if(NS.isString(a)){d[c]={service:a,params:e}}else{if(NS.isObject(a)){if(a.params){NS.apply(a.params,e)}else{a.params=e}}}}});NS.define("NS.mvc.View",{constructor:function(){this.initComponent.apply(this,arguments);this.init()},init:NS.emptyFn,initComponent:function(){this.compManager={}},setComponent:function(a){this.component=a},register:function(a){var c=NS.String,b;if(this.compManager){NS.apply(this.compManager,a)}if(arguments.length==1){if(NS.isObject(a)){for(b in a){(function(e,f,d){e["get"+c.capitalize(f)]=function(){return d[f]}})(this,b,a)}}}else{if(arguments.length==2){if(NS.isString(a)){(function(f,e,d){f["get"+c.capitalize(e)]=function(){return d}})(this,arguments[0],arguments[1])}}}},get:function(a){return this.comManager[a]},getLibComponent:function(){return this.component.getLibComponent()}});NS.define("NS.util.ComponentInstance",{singleton:true,CM:NS.ClassManager,constructor:function(){this.callParent(arguments);this.instanceMap={"Ext.Component":"NS.Component","Ext.container.Container":"NS.container.Container","Ext.tab.Panel":"NS.container.TabPanel","Ext.panel.Panel":"NS.container.Panel","Ext.form.Panel":"NS.form.BasicForm","Ext.toolbar.ToolBar":"NS.toolbar.Toolbar","Ext.button.Button":"NS.button.Button","Ext.grid.Panel":"NS.grid.Grid","Ext.menu.Menu":"NS.menu.Menu","Ext.window.Window":"NS.window.Window","Ext.grid.column.Column":"NS.grid.Column","Ext.grid.column.ButtonColumn":"NS.grid.Column","Ext.grid.column.LinkColumn":"NS.grid.Column","Ext.grid.column.ProgressColumn":"NS.grid.Column","Ext.grid.RowNumberer":"NS.grid.Column","Ext.form.field.Base":"NS.form.field.BaseField","Ext.form.field.Text":"NS.form.field.Text","Ext.form.field.Checkbox":"NS.form.field.Checkbox","Ext.form.field.ComboBox":"NS.form.field.ComboBox","Ext.form.field.Date":"NS.form.field.Date","Ext.form.field.Display":"NS.form.field.Display","Ext.form.field.File":"NS.form.field.File","Ext.form.field.Number":"NS.form.field.Number","Ext.form.field.Radio":"NS.form.field.Radio","Ext.form.field.TextArea":"NS.form.field.TextArea","Ext.ux.comboBoxTree":"NS.form.field.ComboBoxTree","Ext.form.field.Time":"NS.form.field.Time","Ext.form.CheckboxGroup":"NS.form.field.CheckboxGroup","Ext.form.RadioGroup":"NS.form.field.RadioGroup","Ext.form.field.ForumSearch":"NS.form.field.ForumSearch","Ext.form.FieldSet":"NS.form.FieldSet","Ext.form.field.HtmlEditor":"NS.form.field.HtmlEditor"};this.fieldInstanceMap={}},getInstance:function(a){if(a.NSContainer){return a.NSContainer}else{var b=this.CM.create(this.instanceMap[a.$className],{});b.setComponent(a);a.NSContainer=b;return b}}});NS.define("NS.appExpand.TextStatistics",{extend:"NS.Component",initComponent:function(a){this.config=a;this.callParent();this.createComponent(a)},initConfigMapping:function(){this.callParent();this.addConfigMapping({htmlstring:{name:"htmlstring"},items:{name:"items"}})},initEvents:function(){this.callParent()},createDom:function(a){var e=this,j=document;var h=j.createElement("DIV");h.style.width="90%";h.className="opTextRoot";var g=a.items;var f=a.htmlstring;var d=this.showMaxItems=a.showMaxItems||g.length;var c=f.split(/\{[0-9]*\}/);for(var b in c){if(b>d){break}h.appendChild(j.createTextNode(c[b]));if(b<g.length){(function(l,n,m){var k=document.createElement("A");k.href="#";k.id="statistics"+l+id;if(!m.noEvent){k.onclick=function(){e.fireEvent("linkclick",m.params,m.text);return false}}k.appendChild(document.createTextNode(g[l]["text"]));n.appendChild(k)})(b,h,g[b])}}this.myDom=h},createComponent:function(c){var b=this;this.createDom(c);var a={width:c.width||"100%",height:c.height||"100%",listeners:{afterrender:function(){this.el.appendChild(b.myDom)}}};this.component=new Ext.container.Container(a)},render:function(a){this.component.render(a)},refreshByIndex:function(d){if(d instanceof Array){for(var b=0;b<d.length;b++){var c="statistics"+d[b].index+id;var a=Ext.get(c);a.dom.innerHTML=d[b].text;this.config.items[d[b].index].text=d[b].text}}},refresh:function(a){Ext.fly(this.myDom).remove();this.createDom(a);this.component.el.appendChild(this.myDom);this.config=a},getDataByIndex:function(a){return this.config.items[a].text}});NS.define("NS.appExpand.Provinces2Cities",{extend:"NS.Component",initComponent:function(a){this.callParent()},initConfigMapping:function(){this.callParent()},initEvents:function(){this.callParent()},packEvents:function(){this.callParent()}});NS.define("NS.appExpand.CascadeQuery",{extend:"NS.container.Container",initComponent:function(a){this.holeConfig=a;this.callParent();this.translateData(a);this.createContainer(a);this.bindComboboxEvent()},initConfigMapping:function(){this.callParent();this.addConfigMapping({crosswise:{name:"crosswise"},holistic:{name:"holistic"},cascadeType:{name:"cascadeType"},data:{name:"data"}})},initEvents:function(){this.callParent()},packEvents:function(){this.callParent()},createContainer:function(b){var a=typeof b.crosswise=="undefined"||b.crosswise==true;layout=a?"column":"anchor",fsHeight=a?(b.height||22):(b.height||b.cascadeType.length*26),defaults=a?{}:{anchor:"100%"};this.component=Ext.create("Ext.form.FieldSet",{layout:layout,defaults:defaults,padding:0,margin:"0 0 0 0",width:b.width||200,height:fsHeight,border:b.border||false});this.createComboboxs(b)},translateData:function(e){var b=e.data,c={},g=0;e.nodeHash={};e.firstCCData=[];if(b instanceof Array){if(b.length==0){return}for(var f=0;f<b.length;f++){var a=b[f];var d={pid:a.fjdId||a.fjdid,text:a.mc,expanded:true,leaf:true,children:[],id:a.id,cc:a.cc,cclx:a.cclx,qxm:a.qxm};c[a.id]=d;if(d.cclx==e.cascadeType[0].cclx){e.firstCCData.push(d)}}for(var h in c){var j=c[h];if(c.hasOwnProperty(j.pid)){c[j.pid].children.push(j);c[j.pid].leaf=false}else{g=j.id}}e.nodeHash=c}},createComboboxs:function(c){var b=this;var e=c.cascadeType;for(var a=0;a<e.length;a++){var d=e[a];(function(h,j,l,m,k,p,g){if(h==0){var n=Ext.create("Ext.data.Store",{fields:["id","text","cclx","qxm"],data:g.firstCCData})}else{var n=Ext.create("Ext.data.Store",{fields:["id","text","cclx","qxm"]})}var f=Ext.create("Ext.form.field.ComboBox",{fieldLabel:j,labelWidth:30,store:n,queryMode:"local",columnWidth:1/k,displayField:m,valueField:l,editable:false,name:p,emptyText:"请选择..."});b.component.add(f)})(a,d.labelName,d.valueName||"id",d.displayName||"text",e.length,d.cclx,c)}},bindComboboxEvent:function(){var b=this;var a=0;for(;a<this.holeConfig.cascadeType.length;a++){(function(c,e){var d=b.component.getComponent(c);if(c!=(e-1)){d.addListener("change",function(f,l,j,k){var h=b.component.getComponent(c+1);h.setValue(null);var g=typeof b.holeConfig.nodeHash[l]=="undefined"?null:b.holeConfig.nodeHash[l].children;if(g==null){h.getStore().loadData([])}else{h.getStore().loadData(g)}})}})(a,this.holeConfig.cascadeType.length)}},render:function(a){this.component.render(a)},getValue:function(){var c=[],b=this.component.items.items,a;for(var d=0;d<b.length;d++){a=b[d];if(a.displayTplData.length==0){break}c.push(a.displayTplData[0])}return c}});NS.define("NS.bussiness.EntityExport",{singleton:true,exportExcel:function(c){if(c.grid){var a=c.grid,k=c.title,e=c.controller,l=c.entityName,m=a.getQueryParams(),d='"'+k+'"';var b=a.key;if(NS.isObject(b)){b=b.key}NS.apply(m,{start:0,limit:10000000});var h=e.model.getServiceConfig(b);h=NS.isString(h)?h:h.service}else{var k=c.title,e=c.controller,l=c.entityName,m=c.queryParams,j=c.serviceKey,d='"'+k+'"';NS.apply(m,{start:0,limit:10000000});var h=e.model.getServiceConfig(j);h=NS.isString(h)?h:h.service}var f="components={'exp':{'request':\""+h+"\",'params':{}}}";var g=Ext.create("Ext.window.Window",{width:100,height:85,closable:true,modal:true,autoShow:true,autoDestroy:false,defaultType:"radiofield",items:[{name:"exportType",boxLabel:"全部字段",inputValue:"1",id:"state"},{name:"exportType",boxLabel:"显示字段",inputValue:"0",id:"state1"}],defaults:{listeners:{click:{element:"el",fn:function(){var q=c.grid?Ext.getCmp("state").getGroupValue():"1";var v=Ext.encode(m);var u="proxyMenuId="+MainPage.proxyMenuId;if(MainPage.proxyUserId){u+="&proxyUserId"+MainPage.proxyUserId}if("0"==q){var r=a.getShowColumnNames();var t=[];for(var p=0;p<r.length;p++){var s=r[p].dataIndex.split(".");t.push("'"+s+"'")}var n='{"fields":['+t.join(",")+"]";n+=',"entityName":"'+l+'"';n+=',"entityCN":'+d+"}";window.location="baseAction.action?exportFields="+n+"&queryCondition="+v+"&"+f+"&"+u;g.close()}else{if("1"==q){var n="{";n+='fields:["all"]';n+=',entityName:"'+l.replace(/\"/g,"")+'"';n+=',entityCN:"'+d.replace(/\"/g,"")+'"}';window.location="baseAction.action?exportFields="+n+"&queryCondition="+v+"&"+f+"&"+u;g.close()}}}}}}})}});(function(){var a=NS.Function.alias;NS.entityExcelExport=a(NS.bussiness.EntityExport,"exportExcel")})();