var system=angular.module("system",[]);system.factory("highChartService",function(){Highcharts.setOptions({chart:{style:{fontFamily:"微软雅黑"}}});return{renderCommonChart:function(n){n.isSort=n.isSort||false;var o={},p={};var h=[],f=[];for(var g in n.data){var l=n.data[g];if(!o[l.name]){f.push({name:l.name,data:[]});o[l.name]=true}if(!p[l.field]){h.push(l.field);p[l.field]=true}}if(n.isSort){h.sort(function(j,i){return j>i?1:-1})}var q,c,r;for(var e in f){q=f[e];for(var d=0;d<h.length;d++){c=h[d];for(var b=0;b<n.data.length;b++){r=n.data[b];if(r.name==q.name&&r.field==c){q.data.push(parseFloat(r.value))}}if(q.data.length<d){q.data.push(0)}}}type=n.type||"column";var a={title:{text:n.title,x:-20},chart:{type:type},xAxis:[{categories:h,crosshair:true}],yAxis:{title:{text:n.yAxis},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:" "+(n.dw||""),shared:true},credits:{enabled:false},series:f};return a},renderPieChart:function(b){b.showLable=(b.showLable==null)?true:b.showLable;var c=b.data;var a={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:false},title:{text:b.title,},tooltip:{pointFormat:" 数量:<b>{point.y}</b><br/> {series.name}:<b>{point.percentage:.1f}%</b>"},credits:{enabled:false},plotOptions:{pie:{allowPointSelect:true,cursor:"pointer",dataLabels:{enabled:b.showLable}}},series:[{type:"pie",name:"占比",data:c}]};return a}}});system.factory("httpService",["$rootScope","toastrService",function(a,b){return{post:function(d){var c=$.ajax({type:"POST",url:base+d.url,data:d.data,dataType:"json",beforeSend:function(){if(d.beforeSend){d.beforeSend()}},success:function(e){if(d.success){d.success(e)}},error:function(){b.error("数据请求错误，请重试！")},complete:function(){a.$apply()}});return c},get:function(d){var c=$.ajax({type:"GET",url:d.url,data:d.data,dataType:"json",beforeSend:function(){if(d.beforeSend){d.beforeSend()}},success:function(e){if(d.success){d.success(e)}},error:function(){b.error("数据请求错误，请重试！")},complete:function(){a.$apply()}});return c}}}]);system.factory("locationService",[function(){var a=$("body"),b=function(e,c){var d="";if(e instanceof String||e instanceof Number||e instanceof Boolean){d+="&"+c+"="+encodeURIComponent(e)}else{$.each(e,function(g){var f=c==null?g:c+(e instanceof Array?"["+g+"]":"."+g);d+="&"+b(this,f)})}return d.substr(1)};return{redirect:function(c,d){window.location.href=c+"?"+b(d||{})},redirect_new:function(c,e){var d=c+"?"+b(e||{});var f=window.open("_blank");f.location=d}}}]);system.factory("toastrService",[function(){toastr.options={closeButton:false,debug:false,positionClass:"toast-bottom-full-width",onclick:null,showDuration:"100",hideDuration:"300",timeOut:"3000",extendedTimeOut:"500",showEasing:"linear",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};return{info:function(a){toastr.info(a)},success:function(a){toastr.success(a)},warning:function(a){toastr.warning(a)},error:function(a){toastr.error(a)},clear:function(){toastr.clear()}}}]);system.factory("dialog",["$compile","$rootScope",function(b,f){var d=$("body");var i=$('<div class="modal-backdrop fade in"/>');i.hide();d.append(i);var a='<div class="modal" style="display:none;"><div class="modal-dialog" style="background-color: #FFF;"><div class="modal-header"><button type="button" class="close" ng-click="$dialog_confirm_close()" style="opacity: 1;"><i class="fa fa-times text-danger"></i></button><h4 class="modal-title text-primary"><i class="fa fa-question"></i>&nbsp;提示</h4></div><div class="modal-body">{replacement}</div><div class="modal-footer" style="text-align: center;"><button type="button" class="btn btn-primary" ng-click="$dialog_confirm_sure()">确定</button><button type="button" class="btn btn-default" ng-click="$dialog_confirm_cancel()">关闭</button></div></div></div>';var h='<div class="modal" style="display:none;"><div class="modal-dialog" style="background-color: #FFF;"><div class="modal-body" style="padding:30px 10px;">{replacement}</div><div class="modal-footer" style="text-align: center;"><button type="button" class="btn btn-danger btn-sm" ng-click="$dialog_success_close()">关闭</button></div></div>';var g='<div class="modal" style="display:none;"><div style="position: absolute;left: 50%;top: 35%;margin-left: -30px;width: 60px;text-align: center;color: #FFF;"> <i class="fa fa-spinner fa-spin fa-4x" style=""></i></div>';"</div>";var c=function(j,l){var k=$(b(j.replace("{replacement}",l))(f));i.show();d.append(k);k.fadeIn("fast");return k};var e={};return{alert:function(j,k){f.$dialog_success_close=function(){e.success.remove();i.hide();delete e.success;if(k){k()}};e.success=e.success||c(h,j)},confirm:function(k,l,j){f.$dialog_confirm_close=function(){e.confirm.remove();i.hide();delete e.confirm};f.$dialog_confirm_sure=function(){e.confirm.remove();i.hide();delete e.confirm;if(l){l()}};f.$dialog_confirm_cancel=function(){e.confirm.remove();i.hide();delete e.confirm;if(j){j()}};e.confirm=e.confirm||c(a,k)},showLoading:function(){if(e.loading){i.show();e.loading.fadeIn("fast")}else{e.loading=c(g,"")}},hideLoading:function(){e.loading.fadeOut("fast");i.fadeOut("fast")}}}]);system.directive("cgChart",["highChartService",function(a){return{restrict:"AE",scope:{config:"="},link:function(d,c,b){d.renderChart=function(){if(d.config){if(d.config.type){switch(d.config.type){case"column":case"line":case"area":case"spline":case"areaspline":c.highcharts(a.renderCommonChart(d.config));break;case"pie":c.highcharts(a.renderPieChart(d.config));break;default:break}}else{d.config=angular.extend(d.config,{credits:{enabled:false}});c.highcharts(d.config)}}};d.$watch("config",function(){d.renderChart()})}}}]);system.directive("cgStarRating",[function(){return{restrict:"AE",replace:true,template:'<input type="number" class="rating" />',scope:{cgMax:"=",cgValue:"="},link:function(f,d,e){f.cgValue=f.cgValue||0;f.cgMax=f.cgMax||5;d.val(f.cgValue);var a=e.isreadonly||"false";var c=e.size||"xs";var b=a=="true"?true:false;var g={min:0,max:f.cgMax,step:1,size:c,stars:f.cgMax,showClear:false,showCaption:false,readonly:b};$(d).rating(g);f.$watch("cgValue",function(i,h){$(d).rating("update",i)},true);f.$watch("cgMax",function(i,h){$(d).rating("refresh",{max:i,stars:i})},true);$(d).on("rating.change",function(){f.$apply(f.cgValue=d.val())})}}}]);system.directive("cgStarRatingFull",[function(){return{restrict:"AE",replace:true,template:'<input type="number" class="rating" />',scope:{cgAttr:"=",cgValue:"="},link:function(c,a,b){c.cgValue=c.cgValue||0;a.val(c.cgValue);var d={min:0,max:5,step:1,size:"xs",stars:5,showClear:false,showCaption:false,readonly:false};c.cgAttr=c.cgAttr||d;$(a).rating(c.cgAttr);c.$watch("cgValue",function(f,e){$(a).rating("update",f)},true);c.$watch("cgAttr",function(f,e){$(a).rating("refresh",f)},true);$(a).on("rating.change",function(){c.$apply(c.cgValue=a.val())})}}}]);