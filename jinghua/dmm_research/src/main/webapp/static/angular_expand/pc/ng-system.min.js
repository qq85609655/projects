var system=angular.module("system",[]);system.factory("echartService",function(){return{renderCommonChart:function(o){o.isSort=o.isSort||false;type=o.type||"column";var p={},q={};var l=[],g=[],a=[];for(var h in o.data){var n=o.data[h];if(!p[n.name]){a.push(n.name);g.push({name:n.name,data:[]});p[n.name]=true}if(!q[n.field]){l.push(n.field);q[n.field]=true}}if(o.isSort){l.sort(function(j,i){return j>i?1:-1})}var s,d,t;for(var f in g){s=g[f];s.type=type;if(s.type=="area"){s.type="line";s.areaStyle={normal:{}}}if(s.type=="spline"){s.type="line";s.smooth=true}if(s.type=="areaspline"){s.type="line";s.smooth=true;s.areaStyle={normal:{}}}for(var e=0;e<l.length;e++){d=l[e];for(var c=0;c<o.data.length;c++){t=o.data[c];if(t.name==s.name&&t.field==d){s.data.push(parseFloat(t.value))}}if(s.data.length<=e){s.data.push(0)}}}var r=0;if(l.length>5){r=45}var b={title:{text:o.title,left:"center"},grid:{top:40,left:"1%",right:"1%",bottom:30,containLabel:true},toolbox:{show:true,feature:{dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{left:"center",bottom:"bottom",data:a},xAxis:{data:l,axisLabel:{rotate:r,interval:0}},yAxis:[{name:o.yAxis,type:"value"}],series:g};return b},renderPieChart:function(a){var b=a.data;a.showLable=(a.showLable==null)?true:a.showLable;option={title:{text:a.title,x:"center"},grid:{top:"middle",left:"1%",right:"1%",containLabel:false},tooltip:{trigger:"item",formatter:"{b} <br/> 数量：{c} &nbsp;&nbsp;(占比{d}%)"},label:{emphasis:{show:true,textStyle:{fontSize:"20",fontWeight:"bold"}}},series:[{type:"pie",radius:"70%",center:["50%","55%"],avoidLabelOverlap:false,selectedMode:"single",data:b,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{normal:{formatter:"{b}({d}%)"}}}]};return option}}});system.factory("httpService",["$rootScope","toastrService",function(a,b){return{post:function(d){var c=$.ajax({type:"POST",url:base+d.url,data:d.data,dataType:"json",beforeSend:function(){if(d.beforeSend){d.beforeSend()}},success:function(e){if(d.success){d.success(e)}},error:function(f){var h=f.status+":"+f.statusText;if(h=="200:OK"){b.error("您没有该项权限！")}else{b.error("数据请求错误，请刷新页面重试！("+h+")")}if(f.status=="404"){try{b.error("数据请求错误，请刷新页面重试！("+h+")")}catch(g){window.location.href=logoutUrl}}},complete:function(){a.$apply()}});return c},get:function(d){var c=$.ajax({type:"GET",url:d.url,data:d.data,dataType:"json",beforeSend:function(){if(d.beforeSend){d.beforeSend()}},success:function(e){if(d.success){d.success(e)}},error:function(){b.error("数据请求错误，请重试！")},complete:function(){a.$apply()}});return c},callService:function(f){var e=angular.copy(f),g=e.params,d="data",j=[],i=e.service.split("?"),h,c={success:function(k){h=k}};delete e.service;e.beanName=i[0];e.methodName=i[1];if(!e.params){e.params=[]}e.data=angular.toJson(e.params);e.params=angular.toJson(e.params);$.ajax({type:"POST",url:base+"common/getData",data:{params:angular.toJson(e)},dataType:"json",success:function(k){if(h){h(k)}else{c[d]=k.result;delete c.success}}});return c}}}]);system.factory("locationService",[function(){var a=$("body"),b=function(e,c){var d="";if(e instanceof String||e instanceof Number||e instanceof Boolean){d+="&"+c+"="+encodeURIComponent(e)}else{$.each(e,function(g){var f=c==null?g:c+(e instanceof Array?"["+g+"]":"."+g);d+="&"+b(this,f)})}return d.substr(1)};return{redirect:function(c,d){if(d){c+="?"+b(d||{})}window.location.href=c},redirect_new:function(c,e){var d=c+"?"+b(e||{});var f=window.open("_blank");f.location=d},reload:function(){window.location.reload()}}}]);system.factory("toastrService",[function(){toastr.options={closeButton:false,debug:false,positionClass:"toast-bottom-full-width",onclick:null,showDuration:"100",hideDuration:"300",timeOut:"3000",extendedTimeOut:"500",showEasing:"linear",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};return{info:function(a){toastr.info(a)},success:function(a){toastr.success(a)},warning:function(a){toastr.warning(a)},error:function(a){toastr.error(a)},clear:function(){toastr.clear()}}}]);system.factory("dialog",["$compile","$rootScope",function(b,f){var d=$("body");var i=$('<div class="modal-backdrop fade in"/>');i.hide();d.append(i);var a='<div class="modal" style="display:none;"><div class="modal-dialog" style="background-color: #FFF;"><div class="modal-header"><button type="button" class="close" ng-click="$dialog_confirm_close()" style="opacity: 1;"><i class="fa fa-times text-danger"></i></button><h4 class="modal-title text-primary"><i class="fa fa-question"></i>&nbsp;提示</h4></div><div class="modal-body">{replacement}</div><div class="modal-footer" style="text-align: center;"><button type="button" class="btn btn-primary" ng-click="$dialog_confirm_sure()">确定</button><button type="button" class="btn btn-default" ng-click="$dialog_confirm_cancel()">关闭</button></div></div></div>';var h='<div class="modal" style="display:none;"><div class="modal-dialog" style="background-color: #FFF;"><div class="modal-body" style="padding:30px 10px;">{replacement}</div><div class="modal-footer" style="text-align: center;"><button type="button" class="btn btn-danger btn-sm" ng-click="$dialog_success_close()">关闭</button></div></div>';var g='<div class="modal" style="display:none;"><div style="position: absolute;left: 50%;top: 35%;margin-left: -30px;width: 60px;text-align: center;color: #FFF;"> <i class="fa fa-spinner fa-spin fa-4x" style=""></i></div>';"</div>";var c=function(j,l){var k=$(b(j.replace("{replacement}",l))(f));i.show();d.append(k);k.fadeIn("fast");return k};var e={};return{alert:function(j,k){f.$dialog_success_close=function(){e.success.remove();i.hide();delete e.success;if(k){k()}};e.success=e.success||c(h,j)},confirm:function(k,l,j){f.$dialog_confirm_close=function(){e.confirm.remove();i.hide();delete e.confirm};f.$dialog_confirm_sure=function(){e.confirm.remove();i.hide();delete e.confirm;if(l){l()}};f.$dialog_confirm_cancel=function(){e.confirm.remove();i.hide();delete e.confirm;if(j){j()}};e.confirm=e.confirm||c(a,k)},showLoading:function(){if(e.loading){i.show();e.loading.fadeIn("fast")}else{e.loading=c(g,"")}},hideLoading:function(){e.loading.fadeOut("fast");i.fadeOut("fast")}}}]);system.factory("sysCodeService",["httpService",function(a){return{getCodeByCodeType:function(b){return a.post({url:"business/standardcode/codetype",data:{codeType:b}})},getSelfDefinedYearCode:function(){return a.post({url:"business/selfdefined/year",data:{}})},getYears:function(){return a.post({url:"business/selfdefined/years",data:{}})},getCodeSubject:function(){return a.post({url:"business/code/subject",data:{}})},getDeptTree:function(b){return a.post({url:"business/code/depttree",data:{shiroTag:b}})},getTeachDeptTree:function(b){return a.post({url:"business/code/teachdepttree",data:{shiroTag:b}})}}}]);system.directive("echart",["echartService",function(a){return{restrict:"AE",scope:{config:"=",height:"@",onClick:"&"},link:function(d,c,b){if(typeof(d.height)=="undefined"){d.height=400}c.height(d.height);d.renderChart=function(){var e=echarts.init(c[0]);if(d.config){var f={};if(d.config.type){switch(d.config.type){case"bar":case"line":case"area":case"spline":case"areaspline":f=a.renderCommonChart(d.config);break;case"pie":f=a.renderPieChart(d.config);break;default:f=d.config;break}}else{f=d.config;if(!f.grid){f.grid={top:"60px",left:"1%",right:"1%",bottom:40,containLabel:true}}if(!f.toolbox){if(f.series.length>0&&f.series[0].type=="pie"){f.toolbox={show:true,feature:{dataView:{show:true,readOnly:false},restore:{show:true},saveAsImage:{show:true}}}}else{f.toolbox={show:true,feature:{dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}}}}}f.color=["#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"];e.setOption(f)}if(d.onClick){e.on("click",function(g){d.onClick({$params:g});d.$apply()})}$(window).resize(function(){e.resize()})};d.$watch("config",function(){d.renderChart()})}}}]);system.controller("PaginationController",["$scope","$attrs","$parse",function(c,a,f){var b=this,d={$setViewValue:angular.noop},e=a.numPages?f(a.numPages).assign:angular.noop;this.init=function(h,g){d=h;this.config=g;d.$render=function(){b.render()};if(a.itemsPerPage){c.$parent.$watch(f(a.itemsPerPage),function(i){b.itemsPerPage=parseInt(i,10);c.totalPages=b.calculateTotalPages()})}else{this.itemsPerPage=g.itemsPerPage}};this.calculateTotalPages=function(){var g=this.itemsPerPage<1?1:Math.ceil(c.totalItems/this.itemsPerPage);return Math.max(g||0,1)};this.render=function(){c.page=parseInt(d.$viewValue,10)||1};c.selectPage=function(g){if(c.page!==g&&g>0&&g<=c.totalPages){d.$setViewValue(g);d.$render()}};c.getText=function(g){return c[g+"Text"]||b.config[g+"Text"]};c.noPrevious=function(){return c.page===1};c.noNext=function(){return c.page===c.totalPages};c.$watch("totalItems",function(){c.totalPages=b.calculateTotalPages()});c.$watch("totalPages",function(g){e(c.$parent,g);if(c.page>g){c.selectPage(g)}else{d.$render()}})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:false,directionLinks:true,firstText:"《",previousText:"〈",nextText:"〉",lastText:"》",rotate:true}).directive("pagination",["$parse","paginationConfig",function(b,a){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",template:'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(1)">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}"><a href ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(totalPages)">{{getText(\'last\')}}</a></li>\n</ul>',replace:true,link:function(m,g,l,e){var i=e[0],c=e[1];if(!c){return}var k=angular.isDefined(l.maxSize)?m.$parent.$eval(l.maxSize):a.maxSize,f=angular.isDefined(l.rotate)?m.$parent.$eval(l.rotate):a.rotate;m.boundaryLinks=angular.isDefined(l.boundaryLinks)?m.$parent.$eval(l.boundaryLinks):a.boundaryLinks;m.directionLinks=angular.isDefined(l.directionLinks)?m.$parent.$eval(l.directionLinks):a.directionLinks;i.init(c,a);if(l.maxSize){m.$parent.$watch(b(l.maxSize),function(n){k=parseInt(n,10);i.render()})}function d(o,p,n){return{number:o,text:p,active:n}}function j(q,s){var o=[];var t=1,w=s;var v=(angular.isDefined(k)&&k<s);if(v){if(f){t=Math.max(q-Math.floor(k/2),1);w=t+k-1;if(w>s){w=s;t=w-k+1}}else{t=((Math.ceil(q/k)-1)*k)+1;w=Math.min(t+k-1,s)}}for(var p=t;p<=w;p++){var u=d(p,p,p===q);o.push(u)}if(v&&!f){if(t>1){var n=d(t-1,"...",false);o.unshift(n)}if(w<s){var r=d(w+1,"...",false);o.push(r)}}return o}var h=i.render;i.render=function(){h();if(m.page>0&&m.page<=m.totalPages){m.pages=j(m.page,m.totalPages)}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:true}).directive("pager",["pagerConfig",function(a){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",template:'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n</ul>',replace:true,link:function(f,e,d,b){var g=b[0],c=b[1];if(!c){return}f.align=angular.isDefined(d.align)?f.$parent.$eval(d.align):a.align;g.init(c,a)}}}]);system.directive("cgTree",["$log",function(c){return{restrict:"A",scope:true,controller:["$scope","$attrs",function b(e,d){var h=d.cgTree;var f=h.match(/^\s*([\$\w]+)\s+in\s+([\S\s]*)\s+of\s+([\S\s]*)$/);if(!f){throw new Error("Expected cgTree in form of '_item_ in _collection_ of _root_' but got '"+h+"'.")}var g=this.ident={value:f[1],collection:f[2],root:f[3]};e.$watch(this.ident.root,function(i){e[g.value]=i})}],compile:function a(e){var f=e.html();return{pre:function d(i,j,h,g){g.template=f}}}}}]).directive("cgTreecurse",["$compile",function(b){return{require:"^cgTree",link:function a(f,h,d,c){var g=["<",h.context.tagName,' ng-repeat="',c.ident.value," in ",c.ident.value,".",c.ident.collection,'">',c.template,"</",h.context.tagName,">"];var e=angular.element(g.join(""));h.replaceWith(e);b(e)(f)}}}]);system.directive("checkPermiss",["httpService",function(a){return{restrict:"AE",scope:{callback:"&"},link:function(d,c,b){var e={};e.params=[];e.params.push(b.shirotag);e.service="checkPermiss?checkPermiss";a.callService(e).success(function(f){if(d.callback){d.callback()}if(f==true){return}$(c[0]).remove()})}}}]);system.directive("cgComboTree",["$interval",function(a){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/comboTree.html",scope:{source:"=",result:"=",code:"="},link:function(d,c,b){var f=0;d.packageSourceData=function(h){h.nodeId=f++;if(h.children){for(var g=0;g<h.children.length;g++){h.children[g].parentNodeId=h.nodeId;d.packageSourceData(h.children[g])}}};d.selectTree=[];d.$watch("source",function(){d.treeData={};d.treeData=angular.copy(d.source);angular.copy({},d.result);d.packageSourceData(d.treeData);d.selectTree.splice(0,d.selectTree.length);d.selectTree.push(d.treeData);d.findeDefaultChecked(d.treeData)},true);d.findPanrentOfNode=function(j,g){if(j.nodeId!=g.nodeId){if(j.parentNodeId==g.nodeId){d.selectTree.push(g);d.findPanrentOfNode(g,d.treeData)}else{if(g.children){for(var h=0;h<g.children.length;h++){d.findPanrentOfNode(j,g.children[h])}}}}};d.cgComboTreeNodeClick=function(h){d.selectTree.splice(0,d.selectTree.length);d.selectTree.push(h);d.findPanrentOfNode(h,d.treeData);d.selectTree.reverse();var g=angular.copy(d.selectTree);d.selectTree=[];a(function(){d.selectTree=g},1,1);angular.copy(h,d.result);delete d.result.children;d.result.queryCode=angular.copy(d.code);d.result.queryType="comboTree"};var e=false;d.findeDefaultChecked=function(h){if(h.checked){e=true;d.cgComboTreeNodeClick(h)}else{if(h.children){for(var g=0;g<h.children.length;g++){if(e){e=false;break}else{d.findeDefaultChecked(h.children[g])}}}}};d.show_all_items=false;d.changeShowAllItems=function(){d.show_all_items=!d.show_all_items}}}}]);system.directive("cgMulQueryComm",function(){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/multiQueryComm.html",scope:{source:"=",result:"=",expand:"@",noborder:"@",onChange:"&"},link:function(c,b,a){c.result=[];c.innerTreeResult={};c.$watch("innerTreeResult",function(f){if(f.queryCode){var e=false;for(var d=0;d<c.result.length;d++){if(c.result[d].queryCode==c.innerTreeResult.queryCode){c.result.splice(d,1,angular.copy(c.innerTreeResult));e=true}}if(!e){c.result.push(angular.copy(c.innerTreeResult))}}},true);c.cancleQueryAll=function(){c.result=[];for(var e=0;e<c.queryArray.length;e++){var f=c.queryArray[e];if(c.queryArray[e].queryType=="comboTree"){c.setCheckedOfTreedata(c.queryArray[e].items);c.queryArray[e].items.dataChangeDate=new Date()}else{for(var d=0;d<f.items.length;d++){f.items[d].checked=false}}}};c.setCheckedOfTreedata=function(d){d.checked=false;if(d.children){for(var e=0;e<d.children.length;e++){var f=d.children[e];c.setCheckedOfTreedata(f)}}};c.cancleQuery=function(g){for(var e=0;e<c.result.length;e++){if(c.result[e]==g){c.result.splice(e,1)}}if(g.queryType=="comboTree"){for(var e=0;e<c.queryArray.length;e++){if(c.queryArray[e].queryCode==g.queryCode){c.setCheckedOfTreedata(c.queryArray[e].items);c.queryArray[e].items.dataChangeDate=new Date()}}}else{for(var e in c.queryArray){var f=c.queryArray[e];if(g.queryName==f.queryName){for(var d=0;d<f.items.length;d++){f.items[d].checked=false}}}}};c.queryArray=angular.copy(c.source);c.showAll=function(e){e.isAll=true;for(var d in e.items){e.items[d].show=true}};c.isExpandALL=c.expand?true:false;c.expandALL=function(){c.isExpandALL=!c.isExpandALL;for(var d=1;d<c.queryArray.length;d++){c.queryArray[d].isShow=!c.queryArray[d].isShow}};c.change=function(h,m){for(var d=0;d<m.items.length;d++){m.items[d].checked=false}h.checked=true;var g={},k=false;angular.copy(h,g);g.queryName=m.queryName;g.queryCode=m.queryCode;var l=[];for(var e in c.result){var f=c.result[e];if(f.queryCode!=g.queryCode){l.push(f)}else{l.push(g);k=true}}if(!k){l.push(g)}c.result=l};c.$watch("result",function(){c.isQuery=c.result.length>0?true:false;c.onChange({$data:c.result})},true);c.$watch("source",function(){c.cancleQueryAll();c.queryArray=angular.copy(c.source);c.setDefaultChecked()},true);c.setDefaultChecked=function(){for(var f in c.queryArray){var g=c.queryArray[f];if(f<1){g.isShow=true}else{g.isShow=c.isExpandALL}g.isAll=g.items.length<=5?true:false;if(g.queryType!="comboTree"){for(var e in g.items){var d=g.items[e];d.show=true;if(d.checked){c.change(d,g)}if(e>=5){d.show=false}}}}};c.setDefaultChecked();if(!c.noborder){c.noborder=true}}}});system.directive("cgDrag",["$document","$rootScope","$parse","$timeout",function(d,c,b,a){return{restrict:"A",scope:{onDropSuccess:"&",drag:"="},link:function(g,f,e){f.attr("draggable",true);var h=f[0];h.ondragstart=function(i){try{i.dataTransfer.setData("Text",i.target.id)}catch(j){console.log("drag is not avalible!")}i.dataTransfer.effectAllowed="all";eleDrag=i.target;c.dragdata=g.drag;return true};h.ondragend=function(i){eleDrag=null;if(e.onDropSuccess&&c.dropFlag){g.$apply(function(){g.onDropSuccess({$data:g.drag})})}c.dropFlag=false;c.dragdata=null;return false}}}}]).directive("cgDrop",["$rootScope","$timeout",function(b,a){return{restrict:"A",scope:{onDropSuccess:"&"},link:function(f,e,d){var c=e[0];c.ondragenter=function(g){return true};c.ondragover=function(g){g.preventDefault();return true};c.ondrop=function(g){if(d.onDropSuccess){f.$apply(function(){f.onDropSuccess({$data:angular.copy(b.dragdata)})});b.dropFlag=true}return false};c.ondragleave=function(g){return false}}}}]);system.directive("btnDropdown",[function(){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/btnDropdown.html",scope:{source:"=",onChange:"&",displayField:"@",btnClass:"@",btnStyle:"@"},link:function(c,b,a){c.showDetail=false;c.toggleDetail=function(){c.showDetail=!c.showDetail;if(c.showDetail==true){var d=function(e){if($(b).has(e.target).length<1){c.$apply(function(){c.showDetail=false});$("html").unbind("click",d)}};$("html").unbind("click",d).bind("click",d)}};if(c.btnClass==""||c.btnSuccess==null){c.btnClass="btn-default"}c.selectChange=function(f){c.showDetail=false;c.result=f;for(var d in c.source){var e=c.source[d];e.checked=false}f.checked=true};c.$watch("result",function(e,d){if(e){c.onChange({$data:e})}},true);c.defaultChecked=function(){for(var d=0;d<c.source.length;d++){var e=c.source[d];if(e.checked){c.selectChange(e);break}}};c.$watch("source",function(e,d){if(e&&e.length>0){c.defaultChecked()}},true)}}}]);system.directive("partModal",[function(){return{restrict:"AE",scope:{showModal:"="},link:function(d,c,a){c.css({position:"relative"});var e=$("<div><div style='position: absolute;left: 50%;top: 35%;margin-left: -30px;width: 60px;text-align: center;color: #FFF;'> <i class='fa fa-spinner fa-pulse fa-2x'></i></div></div>").css({"background-color":"#888",opacity:"0.4"});var b=$("<div />").css({position:"absolute",left:0,top:0,"z-index":999,margin:0});e.appendTo(b);c.append(b);d.$watch("showModal",function(f){if(f){e.css({height:"inherit",width:"inherit",});b.css({height:"100%",width:"100%",});b.show()}else{b.fadeOut("fast")}})}}}]);system.directive("modalForm",["httpService","toastrService",function(a,b){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/modalForm.html",scope:{config:"="},link:function(e,d,c){e.hideModalForm=function(){e.config.show=false};d.click(function(f){e.hideModalForm();e.$apply()}).find(".modal-dialog").click(function(f){f.stopPropagation()});e.$watch("config.show",function(f){if(f==true){d.find(".fade").show().scrollTop(0).addClass("in");e.vm.curpage=1;e.vm.rows=[];e.vm.total=0}else{d.find(".fade").removeClass("in").fadeOut("fast");e.vm.curpage=0}});e.vm={showModal:false,pagesize:10,curpage:0,rows:[],total:0,pageTotal:0};e.$watch("vm.curpage",function(g,f){if(g!=0){e.vm.showModal=true;e.queryPageItems(e.config.params).then(function(h){e.vm.showModal=false;e.vm.rows=h.result.rows;e.vm.total=h.result.total;e.vm.pageTotal=parseInt(e.vm.total%e.vm.pagesize==0?e.vm.total/e.vm.pagesize:e.vm.total/e.vm.pagesize+1)})}});e.queryPageItems=function(f){return a.post({url:e.config.url,data:angular.extend({curpage:e.vm.curpage,pagesize:e.vm.pagesize,sortColumn:e.sortColumn,sortOrder:e.sortOrder},f)})};e.download=function(){$.fileDownload(base+e.config.exportUrl,{data:angular.extend({curpage:1,pagesize:e.vm.total,heads:angular.toJson(e.config.heads),fields:angular.toJson(e.config.fields),filename:e.config.title},e.config.params),failCallback:function(g,f){if(g.indexOf("您没有该页面的访问权限")!=-1){b.error("您没有该项权限！")}}})};e.orderByColumn=function(f){if(e.sortColumn==f){if(e.sortOrder=="asc"){e.sortOrder="desc"}else{if(e.sortOrder=="desc"){e.sortColumn=""}}}else{e.sortOrder="asc";e.sortColumn=f}e.vm.showModal=true;e.queryPageItems(e.config.params).then(function(g){e.vm.showModal=false;e.vm.rows=g.result.rows})}}}}]);system.directive("selfDefinedYear",[function(){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/selfDefinedYear.html",scope:{source:"=",result:"="},link:function(d,c,a){var b=(new Date()).getFullYear();d.result={start:b,end:b};d.$watch("source",function(e){if(e==undefined||e.length==0){return}else{d.item={result:d.source[2]};d.setStartDropDownSource=function(j,h){result=[];for(var f=j;f>=b-15;f--){var g={id:f,mc:f+"年"};if(h==f){g.checked=true}result.push(g)}d.startDateSource=result};d.setEndDropDownSource=function(f,j){result=[];for(var g=b;g>=f;g--){var h={id:g,mc:g+"年"};if(j==g){h.checked=true}result.push(h)}d.endDateSource=result};d.startYearChange=function(f){d.result.start=f.id;d.setEndDropDownSource(f.id,d.result.end)};d.endYearChange=function(f){d.result.end=f.id;d.setStartDropDownSource(f.id,d.result.start)};d.$watch("item",function(f){d.result.start=Number(f.result.start);d.result.end=Number(f.result.end);d.setStartDropDownSource(Number(f.result.end),Number(f.result.start));d.setEndDropDownSource(Number(f.result.start),Number(f.result.end))},true);d.$watch("result",function(h){if(h.start!=Number(d.item.result.start)||h.end!=Number(d.item.result.end)){d.item.result=angular.copy(d.item.result)}for(var f in d.source){var g=d.source[f];if(h.start==Number(g.start)&&h.end==Number(g.end)){d.item.result=g}}},true)}})}}}]);system.directive("toolTip",[function(){return{restrict:"AE",transclude:true,templateUrl:base+"/static/angular_expand/pc/directives/tpl/tooltip.html",scope:{placement:"@",hideIcon:"@"},link:function(c,b,a){b.addClass("tooltip-container");b.on("mouseenter",function(){var e=b.height();var f=b.width();var i=b.position();var k=i.left;var d=i.top;var g=b.find(".popover");var m=g.width();var l=g.height();var h=-200,j=-200;switch(c.placement){case"top":h=k+(f-m)/2-2;j=d-l-4;break;case"right":h=k+f;j=d+(e-l)/2-4;break;case"bottom":h=k+(f-m)/2-2;j=d+e-2;break;case"left":h=k-m-4;j=d+(e-l)/2-4;break;default:h=k+f-2;j=d+(e-l)/2-2;break}g.css({left:h,top:j})})}}}]);