var system=angular.module("system",[]);system.factory("echartService",function(){return{renderCommonChart:function(o){o.isSort=o.isSort||false;type=o.type||"column";var p={},q={};var l=[],g=[],a=[];for(var h in o.data){var n=o.data[h];if(!p[n.name]){a.push(n.name);g.push({name:n.name,data:[]});p[n.name]=true}if(!q[n.field]){l.push(n.field);q[n.field]=true}}if(o.isSort){l.sort(function(j,i){return j>i?1:-1})}var s,d,t;for(var f in g){s=g[f];s.type=type;if(s.type=="area"){s.type="line";s.areaStyle={normal:{}}}if(s.type=="spline"){s.type="line";s.smooth=true}if(s.type=="areaspline"){s.type="line";s.smooth=true;s.areaStyle={normal:{}}}for(var e=0;e<l.length;e++){d=l[e];for(var c=0;c<o.data.length;c++){t=o.data[c];if(t.name==s.name&&t.field==d){s.data.push(parseFloat(t.value))}}if(s.data.length<e){s.data.push(0)}}}var r=0;if(l.length>5){r=45}var b={title:{text:o.title,left:"center"},grid:{top:"40px",left:"1%",right:"1%",bottom:"30px",containLabel:true},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{left:"center",bottom:"bottom",data:a},xAxis:{data:l,axisLabel:{rotate:r,interval:0}},yAxis:[{name:o.yAxis,type:"value"}],series:g};return b},renderPieChart:function(a){var b=a.data;a.showLable=(a.showLable==null)?true:a.showLable;option={title:{text:a.title,x:"center"},grid:{top:"middle",left:"1%",right:"1%",containLabel:false},tooltip:{trigger:"item",formatter:"{b} <br/> 数量：{c} &nbsp;&nbsp;(占比{d}%)"},label:{emphasis:{show:true,textStyle:{fontSize:"20",fontWeight:"bold"}}},series:[{type:"pie",radius:"70%",center:["50%","55%"],avoidLabelOverlap:false,selectedMode:"single",data:b,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};return option}}});system.directive("cgComboBox",["$interval",function(a){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/comboBox.html",scope:{source:"=",result:"=",inputClass:"@",height:"@",onSelect:"&"},link:function(d,c,b){d.result={};var f=0;d.$watch("source",function(){d.treeData={};d.treeData=angular.copy(d.source);angular.copy({},d.result);d.findeDefaultChecked(d.treeData)},true);d.cgComboTreeNodeClick=function(g){angular.copy(g,d.result);delete d.result.children;d.onSelect({$data:d.result})};var e=false;d.findeDefaultChecked=function(h){if(!h){return}if(h.checked){e=true;d.cgComboTreeNodeClick(h)}else{if(h.children){for(var g=0;g<h.children.length;g++){if(e){e=false;break}else{d.findeDefaultChecked(h.children[g])}}}}};d.showBoxDetail=false;d.showDetail=function(h){h.stopPropagation();var g=h.target;if(d.showBoxDetail){return}d.showBoxDetail=true;var i=null;i=function(j){d.showBoxDetail=false;d.$digest();$("html").not(g).unbind("click",i)};$("html").not(g).bind("click",i)}}}}]);system.directive("cgComboTree",["$interval",function(a){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/comboTree.html",scope:{source:"=",result:"=",code:"="},link:function(d,c,b){var f=0;d.packageSourceData=function(h){h.nodeId=f++;if(h.children){for(var g=0;g<h.children.length;g++){h.children[g].parentNodeId=h.nodeId;d.packageSourceData(h.children[g])}}};d.selectTree=[];d.$watch("source",function(){d.treeData={};d.treeData=angular.copy(d.source);angular.copy({},d.result);d.packageSourceData(d.treeData);d.selectTree.splice(0,d.selectTree.length);d.selectTree.push(d.treeData);d.findeDefaultChecked(d.treeData)},true);d.findPanrentOfNode=function(j,g){if(j.nodeId!=g.nodeId){if(j.parentNodeId==g.nodeId){d.selectTree.push(g);d.findPanrentOfNode(g,d.treeData)}else{if(g.children){for(var h=0;h<g.children.length;h++){d.findPanrentOfNode(j,g.children[h])}}}}};d.cgComboTreeNodeClick=function(h){d.selectTree.splice(0,d.selectTree.length);d.selectTree.push(h);d.findPanrentOfNode(h,d.treeData);d.selectTree.reverse();var g=angular.copy(d.selectTree);d.selectTree=[];a(function(){d.selectTree=g},1,1);angular.copy(h,d.result);delete d.result.children;d.result.queryCode=angular.copy(d.code);d.result.queryType="comboTree"};var e=false;d.findeDefaultChecked=function(h){if(h.checked){e=true;d.cgComboTreeNodeClick(h)}else{if(h.children){for(var g=0;g<h.children.length;g++){if(e){e=false;break}else{d.findeDefaultChecked(h.children[g])}}}}}}}}]);system.directive("cgMulQueryComm",function(){return{restrict:"AE",templateUrl:base+"/static/angular_expand/pc/directives/tpl/multiQueryComm.html",scope:{source:"=",result:"=",expand:"@",noborder:"@",onChange:"&"},link:function(c,b,a){c.result=[];c.innerTreeResult={};c.$watch("innerTreeResult",function(f){if(f.queryCode){var e=false;for(var d=0;d<c.result.length;d++){if(c.result[d].queryCode==c.innerTreeResult.queryCode){c.result.splice(d,1,angular.copy(c.innerTreeResult));e=true}}if(!e){c.result.push(angular.copy(c.innerTreeResult))}}},true);c.cancleQueryAll=function(){c.result=[];for(var e=0;e<c.queryArray.length;e++){var f=c.queryArray[e];if(c.queryArray[e].queryType=="comboTree"){c.setCheckedOfTreedata(c.queryArray[e].items);c.queryArray[e].items.dataChangeDate=new Date()}else{for(var d=0;d<f.items.length;d++){f.items[d].checked=false}}}};c.setCheckedOfTreedata=function(d){d.checked=false;if(d.children){for(var e=0;e<d.children.length;e++){var f=d.children[e];c.setCheckedOfTreedata(f)}}};c.cancleQuery=function(g){for(var e=0;e<c.result.length;e++){if(c.result[e]==g){c.result.splice(e,1)}}if(g.queryType=="comboTree"){for(var e=0;e<c.queryArray.length;e++){if(c.queryArray[e].queryCode==g.queryCode){c.setCheckedOfTreedata(c.queryArray[e].items);c.queryArray[e].items.dataChangeDate=new Date()}}}else{for(var e in c.queryArray){var f=c.queryArray[e];if(g.queryName==f.queryName){for(var d=0;d<f.items.length;d++){f.items[d].checked=false}}}}};c.queryArray=angular.copy(c.source);c.showAll=function(e){e.isAll=true;for(var d in e.items){e.items[d].show=true}};c.isExpandALL=c.expand?true:false;c.expandALL=function(){c.isExpandALL=!c.isExpandALL;for(var d=1;d<c.queryArray.length;d++){c.queryArray[d].isShow=!c.queryArray[d].isShow}};c.change=function(h,m){for(var d=0;d<m.items.length;d++){m.items[d].checked=false}h.checked=true;var g={},k=false;angular.copy(h,g);g.queryName=m.queryName;g.queryCode=m.queryCode;var l=[];for(var e in c.result){var f=c.result[e];if(f.queryCode!=g.queryCode){l.push(f)}else{l.push(g);k=true}}if(!k){l.push(g)}c.result=l};c.$watch("result",function(){c.isQuery=c.result.length>0?true:false;c.onChange({$data:c.result})},true);c.$watch("source",function(){c.cancleQueryAll();c.queryArray=angular.copy(c.source);c.setDefaultChecked()},true);c.setDefaultChecked=function(){for(var f in c.queryArray){var g=c.queryArray[f];if(f<1){g.isShow=true}else{g.isShow=c.isExpandALL}g.isAll=g.items.length<=5?true:false;if(g.queryType!="comboTree"){for(var e in g.items){var d=g.items[e];d.show=true;if(d.checked){c.change(d,g)}if(e>=5){d.show=false}}}}};c.setDefaultChecked();if(!c.noborder){c.noborder=true}}}});system.directive("cgTree",["$log",function(c){return{restrict:"A",scope:true,controller:["$scope","$attrs",function b(e,d){var h=d.cgTree;var f=h.match(/^\s*([\$\w]+)\s+in\s+([\S\s]*)\s+of\s+([\S\s]*)$/);if(!f){throw new Error("Expected cgTree in form of '_item_ in _collection_ of _root_' but got '"+h+"'.")}var g=this.ident={value:f[1],collection:f[2],root:f[3]};e.$watch(this.ident.root,function(i){e[g.value]=i})}],compile:function a(e){var f=e.html();return{pre:function d(i,j,h,g){g.template=f}}}}}]).directive("cgTreecurse",["$compile",function(b){return{require:"^cgTree",link:function a(f,h,d,c){var g=["<",h.context.tagName,' ng-repeat="',c.ident.value," in ",c.ident.value,".",c.ident.collection,'">',c.template,"</",h.context.tagName,">"];var e=angular.element(g.join(""));h.replaceWith(e);b(e)(f)}}}]);system.directive("cgDrag",["$document","$rootScope","$parse","$timeout",function(d,c,b,a){return{restrict:"A",scope:{onDropSuccess:"&",drag:"="},link:function(g,f,e){f.attr("draggable",true);var h=f[0];h.ondragstart=function(i){try{i.dataTransfer.setData("Text",i.target.id)}catch(j){}i.dataTransfer.effectAllowed="all";eleDrag=i.target;c.dragdata=g.drag;return true};h.ondragend=function(i){eleDrag=null;if(e.onDropSuccess&&c.dropFlag){g.$apply(function(){g.onDropSuccess({$data:g.drag})})}c.dropFlag=false;c.dragdata=null;return false}}}}]).directive("cgDrop",["$rootScope","$timeout",function(b,a){return{restrict:"A",scope:{onDropSuccess:"&"},link:function(f,e,d){var c=e[0];c.ondragenter=function(g){return true};c.ondragover=function(g){g.preventDefault();return true};c.ondrop=function(g){if(d.onDropSuccess){f.$apply(function(){f.onDropSuccess({$data:angular.copy(b.dragdata)})});b.dropFlag=true}return false};c.ondragleave=function(g){return false}}}}]);system.controller("PaginationController",["$scope","$attrs","$parse",function(c,a,f){var b=this,d={$setViewValue:angular.noop},e=a.numPages?f(a.numPages).assign:angular.noop;this.init=function(h,g){d=h;this.config=g;d.$render=function(){b.render()};if(a.itemsPerPage){c.$parent.$watch(f(a.itemsPerPage),function(i){b.itemsPerPage=parseInt(i,10);c.totalPages=b.calculateTotalPages()})}else{this.itemsPerPage=g.itemsPerPage}};this.calculateTotalPages=function(){var g=this.itemsPerPage<1?1:Math.ceil(c.totalItems/this.itemsPerPage);return Math.max(g||0,1)};this.render=function(){c.page=parseInt(d.$viewValue,10)||1};c.selectPage=function(g){if(c.page!==g&&g>0&&g<=c.totalPages){d.$setViewValue(g);d.$render()}};c.getText=function(g){return c[g+"Text"]||b.config[g+"Text"]};c.noPrevious=function(){return c.page===1};c.noNext=function(){return c.page===c.totalPages};c.$watch("totalItems",function(){c.totalPages=b.calculateTotalPages()});c.$watch("totalPages",function(g){e(c.$parent,g);if(c.page>g){c.selectPage(g)}else{d.$render()}})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:false,directionLinks:true,firstText:"《",previousText:"〈",nextText:"〉",lastText:"》",rotate:true}).directive("pagination",["$parse","paginationConfig",function(b,a){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",template:'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(1)">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}"><a href ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(totalPages)">{{getText(\'last\')}}</a></li>\n</ul>',replace:true,link:function(m,g,l,e){var i=e[0],c=e[1];if(!c){return}var k=angular.isDefined(l.maxSize)?m.$parent.$eval(l.maxSize):a.maxSize,f=angular.isDefined(l.rotate)?m.$parent.$eval(l.rotate):a.rotate;m.boundaryLinks=angular.isDefined(l.boundaryLinks)?m.$parent.$eval(l.boundaryLinks):a.boundaryLinks;m.directionLinks=angular.isDefined(l.directionLinks)?m.$parent.$eval(l.directionLinks):a.directionLinks;i.init(c,a);if(l.maxSize){m.$parent.$watch(b(l.maxSize),function(n){k=parseInt(n,10);i.render()})}function d(o,p,n){return{number:o,text:p,active:n}}function j(q,s){var o=[];var t=1,w=s;var v=(angular.isDefined(k)&&k<s);if(v){if(f){t=Math.max(q-Math.floor(k/2),1);w=t+k-1;if(w>s){w=s;t=w-k+1}}else{t=((Math.ceil(q/k)-1)*k)+1;w=Math.min(t+k-1,s)}}for(var p=t;p<=w;p++){var u=d(p,p,p===q);o.push(u)}if(v&&!f){if(t>1){var n=d(t-1,"...",false);o.unshift(n)}if(w<s){var r=d(w+1,"...",false);o.push(r)}}return o}var h=i.render;i.render=function(){h();if(m.page>0&&m.page<=m.totalPages){m.pages=j(m.page,m.totalPages)}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:true}).directive("pager",["pagerConfig",function(a){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",template:'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n</ul>',replace:true,link:function(f,e,d,b){var g=b[0],c=b[1];if(!c){return}f.align=angular.isDefined(d.align)?f.$parent.$eval(d.align):a.align;g.init(c,a)}}}]);system.directive("echart",["echartService",function(a){return{restrict:"AE",scope:{config:"=",height:"@"},link:function(d,c,b){if(typeof(d.height)=="undefined"){d.height=300}c.height(d.height);d.renderChart=function(){var e=echarts.init(c[0]);if(d.config){var f={};if(d.config.type){switch(d.config.type){case"bar":case"line":case"area":case"spline":case"areaspline":f=a.renderCommonChart(d.config);break;case"pie":f=a.renderPieChart(d.config);break;default:f=d.config;break}}else{f=d.config}f.color=["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"];e.setOption(f)}$(window).resize(function(){e.resize()})};d.$watch("config",function(){d.renderChart()})}}}]);