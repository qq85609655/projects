var system=angular.module("system",[]);system.factory("echartService",function(){return{renderCommonChart:function(o){o.isSort=o.isSort||false;type=o.type||"column";var p={},q={};var l=[],g=[],a=[];for(var h in o.data){var n=o.data[h];if(!p[n.name]){a.push(n.name);g.push({name:n.name,data:[]});p[n.name]=true}if(!q[n.field]){l.push(n.field);q[n.field]=true}}if(o.isSort){l.sort(function(j,i){return j>i?1:-1})}var r,d,s;for(var f in g){r=g[f];r.type=type;if(r.type=="area"){r.type="line";r.areaStyle={normal:{}}}if(r.type=="spline"){r.type="line";r.smooth=true}if(r.type=="areaspline"){r.type="line";r.smooth=true;r.areaStyle={normal:{}}}for(var e=0;e<l.length;e++){d=l[e];for(var c=0;c<o.data.length;c++){s=o.data[c];if(s.name==r.name&&s.field==d){r.data.push(parseFloat(s.value))}}if(r.data.length<e){r.data.push(0)}}}var b={title:{text:o.title,left:"center"},grid:{top:"40px",left:"1%",right:"1%",bottom:"30px",containLabel:true},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{left:"center",bottom:"bottom",data:a},xAxis:{data:l},yAxis:[{name:o.yAxis,type:"value"}],series:g};return b},renderPieChart:function(a){var b=a.data;a.showLable=(a.showLable==null)?true:a.showLable;option={title:{text:a.title,x:"center"},grid:{top:"middle",left:"1%",right:"1%",containLabel:false},tooltip:{trigger:"item",formatter:"{b} <br/> 数量：{c} &nbsp;&nbsp;(占比{d}%)"},legend:{orient:"vertical",left:"left",data:["直接访问","邮件营销","联盟广告","视频广告","搜索引擎"]},label:{emphasis:{show:true,textStyle:{fontSize:"20",fontWeight:"bold"}}},series:[{type:"pie",radius:"75%",center:["50%","50%"],avoidLabelOverlap:false,selectedMode:"single",data:b,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};return option}}});system.factory("httpService",["$rootScope","toastrService",function(a,b){return{post:function(d){var c=$.ajax({type:"POST",url:base+d.url,data:d.data,dataType:"json",beforeSend:function(){if(d.beforeSend){d.beforeSend()}},success:function(e){if(d.success){d.success(e)}},error:function(){b.error("数据请求错误，请重试！")},complete:function(){a.$apply()}});return c},get:function(d){var c=$.ajax({type:"GET",url:d.url,data:d.data,dataType:"json",beforeSend:function(){if(d.beforeSend){d.beforeSend()}},success:function(e){if(d.success){d.success(e)}},error:function(){b.error("数据请求错误，请重试！")},complete:function(){a.$apply()}});return c},callService:function(f){var e=angular.copy(f),g=e.params,d="data",j=[],i=e.service.split("?"),h,c={success:function(k){h=k}};delete e.service;e.beanName=i[0];e.methodName=i[1];if(!e.params){e.params=[]}e.data=angular.toJson(e.params);e.params=angular.toJson(e.params);$.ajax({type:"POST",url:base+"common/getDatas",data:e,dataType:"json",success:function(k){if(h){h(k.result)}else{c[d]=k.result;delete c.success}}});return c}}}]);system.factory("locationService",[function(){var a=$("body"),b=function(e,c){var d="";if(e instanceof String||e instanceof Number||e instanceof Boolean){d+="&"+c+"="+encodeURIComponent(e)}else{$.each(e,function(g){var f=c==null?g:c+(e instanceof Array?"["+g+"]":"."+g);d+="&"+b(this,f)})}return d.substr(1)};return{redirect:function(c,d){window.location.href=c+"?"+b(d||{})},redirect_new:function(c,e){var d=c+"?"+b(e||{});var f=window.open("_blank");f.location=d}}}]);system.factory("toastrService",[function(){toastr.options={closeButton:false,debug:false,positionClass:"toast-bottom-full-width",onclick:null,showDuration:"100",hideDuration:"300",timeOut:"3000",extendedTimeOut:"500",showEasing:"linear",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};return{info:function(a){toastr.info(a)},success:function(a){toastr.success(a)},warning:function(a){toastr.warning(a)},error:function(a){toastr.error(a)},clear:function(){toastr.clear()}}}]);system.factory("dialog",["$compile","$rootScope",function(b,f){var d=$("body");var i=$('<div class="modal-backdrop fade in"/>');i.hide();d.append(i);var a='<div class="modal" style="display:none;"><div class="modal-dialog" style="background-color: #FFF;"><div class="modal-header"><button type="button" class="close" ng-click="$dialog_confirm_close()" style="opacity: 1;"><i class="fa fa-times text-danger"></i></button><h4 class="modal-title text-primary"><i class="fa fa-question"></i>&nbsp;提示</h4></div><div class="modal-body">{replacement}</div><div class="modal-footer" style="text-align: center;"><button type="button" class="btn btn-primary" ng-click="$dialog_confirm_sure()">确定</button><button type="button" class="btn btn-default" ng-click="$dialog_confirm_cancel()">关闭</button></div></div></div>';var h='<div class="modal" style="display:none;"><div class="modal-dialog" style="background-color: #FFF;"><div class="modal-body" style="padding:30px 10px;">{replacement}</div><div class="modal-footer" style="text-align: center;"><button type="button" class="btn btn-danger btn-sm" ng-click="$dialog_success_close()">关闭</button></div></div>';var g='<div class="modal" style="display:none;"><div style="position: absolute;left: 50%;top: 35%;margin-left: -30px;width: 60px;text-align: center;color: #FFF;"> <i class="fa fa-spinner fa-spin fa-4x" style=""></i></div>';"</div>";var c=function(j,l){var k=$(b(j.replace("{replacement}",l))(f));i.show();d.append(k);k.fadeIn("fast");return k};var e={};return{alert:function(j,k){f.$dialog_success_close=function(){e.success.remove();i.hide();delete e.success;if(k){k()}};e.success=e.success||c(h,j)},confirm:function(k,l,j){f.$dialog_confirm_close=function(){e.confirm.remove();i.hide();delete e.confirm};f.$dialog_confirm_sure=function(){e.confirm.remove();i.hide();delete e.confirm;if(l){l()}};f.$dialog_confirm_cancel=function(){e.confirm.remove();i.hide();delete e.confirm;if(j){j()}};e.confirm=e.confirm||c(a,k)},showLoading:function(){if(e.loading){i.show();e.loading.fadeIn("fast")}else{e.loading=c(g,"")}},hideLoading:function(){e.loading.fadeOut("fast");i.fadeOut("fast")}}}]);system.directive("echart",["echartService",function(a){return{restrict:"AE",scope:{config:"=",height:"@"},link:function(d,c,b){if(typeof(d.height)=="undefined"){d.height=300}c.height(d.height);d.renderChart=function(){var e=echarts.init(c[0]);if(d.config){var f={};if(d.config.type){switch(d.config.type){case"bar":case"line":case"area":case"spline":case"areaspline":f=a.renderCommonChart(d.config);break;case"pie":f=a.renderPieChart(d.config);break;default:f=d.config;break}}else{f=d.config}f.color=["#2ec7c9","#b6a2de","#5ab1ef","#ffb980","#d87a80","#8d98b3","#e5cf0d","#97b552","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"];e.setOption(f)}$(window).resize(function(){e.resize()})};d.$watch("config",function(){d.renderChart()})}}}]);system.directive("cgStarRating",[function(){return{restrict:"AE",replace:true,template:'<input type="number" class="rating" />',scope:{cgMax:"=",cgValue:"="},link:function(f,d,e){f.cgValue=f.cgValue||0;f.cgMax=f.cgMax||5;d.val(f.cgValue);var a=e.isreadonly||"false";var c=e.size||"xs";var b=a=="true"?true:false;var g={min:0,max:f.cgMax,step:1,size:c,stars:f.cgMax,showClear:false,showCaption:false,readonly:b};$(d).rating(g);f.$watch("cgValue",function(i,h){$(d).rating("update",i)},true);f.$watch("cgMax",function(i,h){$(d).rating("refresh",{max:i,stars:i})},true);$(d).on("rating.change",function(){f.$apply(f.cgValue=d.val())})}}}]);system.directive("cgStarRatingFull",[function(){return{restrict:"AE",replace:true,template:'<input type="number" class="rating" />',scope:{cgAttr:"=",cgValue:"="},link:function(c,a,b){c.cgValue=c.cgValue||0;a.val(c.cgValue);var d={min:0,max:5,step:1,size:"xs",stars:5,showClear:false,showCaption:false,readonly:false};c.cgAttr=c.cgAttr||d;$(a).rating(c.cgAttr);c.$watch("cgValue",function(f,e){$(a).rating("update",f)},true);c.$watch("cgAttr",function(f,e){$(a).rating("refresh",f)},true);$(a).on("rating.change",function(){c.$apply(c.cgValue=a.val())})}}}]);system.controller("PaginationController",["$scope","$attrs","$parse",function(c,a,f){var b=this,d={$setViewValue:angular.noop},e=a.numPages?f(a.numPages).assign:angular.noop;this.init=function(h,g){d=h;this.config=g;d.$render=function(){b.render()};if(a.itemsPerPage){c.$parent.$watch(f(a.itemsPerPage),function(i){b.itemsPerPage=parseInt(i,10);c.totalPages=b.calculateTotalPages()})}else{this.itemsPerPage=g.itemsPerPage}};this.calculateTotalPages=function(){var g=this.itemsPerPage<1?1:Math.ceil(c.totalItems/this.itemsPerPage);return Math.max(g||0,1)};this.render=function(){c.page=parseInt(d.$viewValue,10)||1};c.selectPage=function(g){if(c.page!==g&&g>0&&g<=c.totalPages){d.$setViewValue(g);d.$render()}};c.getText=function(g){return c[g+"Text"]||b.config[g+"Text"]};c.noPrevious=function(){return c.page===1};c.noNext=function(){return c.page===c.totalPages};c.$watch("totalItems",function(){c.totalPages=b.calculateTotalPages()});c.$watch("totalPages",function(g){e(c.$parent,g);if(c.page>g){c.selectPage(g)}else{d.$render()}})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:false,directionLinks:true,firstText:"首页",previousText:"上页",nextText:"下页",lastText:"末页",rotate:true}).directive("pagination",["$parse","paginationConfig",function(b,a){return{restrict:"EA",scope:{totalItems:"=",firstText:"@",previousText:"@",nextText:"@",lastText:"@"},require:["pagination","?ngModel"],controller:"PaginationController",template:'<ul class="pagination">\n  <li ng-if="boundaryLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(1)">{{getText(\'first\')}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noPrevious()}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-repeat="page in pages track by $index" ng-class="{active: page.active}"><a href ng-click="selectPage(page.number)">{{page.text}}</a></li>\n  <li ng-if="directionLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n  <li ng-if="boundaryLinks" ng-class="{disabled: noNext()}"><a href ng-click="selectPage(totalPages)">{{getText(\'last\')}}</a></li>\n</ul>',replace:true,link:function(m,g,l,e){var i=e[0],c=e[1];if(!c){return}var k=angular.isDefined(l.maxSize)?m.$parent.$eval(l.maxSize):a.maxSize,f=angular.isDefined(l.rotate)?m.$parent.$eval(l.rotate):a.rotate;m.boundaryLinks=angular.isDefined(l.boundaryLinks)?m.$parent.$eval(l.boundaryLinks):a.boundaryLinks;m.directionLinks=angular.isDefined(l.directionLinks)?m.$parent.$eval(l.directionLinks):a.directionLinks;i.init(c,a);if(l.maxSize){m.$parent.$watch(b(l.maxSize),function(n){k=parseInt(n,10);i.render()})}function d(o,p,n){return{number:o,text:p,active:n}}function j(q,s){var o=[];var t=1,w=s;var v=(angular.isDefined(k)&&k<s);if(v){if(f){t=Math.max(q-Math.floor(k/2),1);w=t+k-1;if(w>s){w=s;t=w-k+1}}else{t=((Math.ceil(q/k)-1)*k)+1;w=Math.min(t+k-1,s)}}for(var p=t;p<=w;p++){var u=d(p,p,p===q);o.push(u)}if(v&&!f){if(t>1){var n=d(t-1,"...",false);o.unshift(n)}if(w<s){var r=d(w+1,"...",false);o.push(r)}}return o}var h=i.render;i.render=function(){h();if(m.page>0&&m.page<=m.totalPages){m.pages=j(m.page,m.totalPages)}}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:true}).directive("pager",["pagerConfig",function(a){return{restrict:"EA",scope:{totalItems:"=",previousText:"@",nextText:"@"},require:["pager","?ngModel"],controller:"PaginationController",template:'<ul class="pager">\n  <li ng-class="{disabled: noPrevious(), previous: align}"><a href ng-click="selectPage(page - 1)">{{getText(\'previous\')}}</a></li>\n  <li ng-class="{disabled: noNext(), next: align}"><a href ng-click="selectPage(page + 1)">{{getText(\'next\')}}</a></li>\n</ul>',replace:true,link:function(f,e,d,b){var g=b[0],c=b[1];if(!c){return}f.align=angular.isDefined(d.align)?f.$parent.$eval(d.align):a.align;g.init(c,a)}}}]);system.directive("tree",["$log",function(c){return{restrict:"A",scope:true,controller:["$scope","$attrs",function b(e,d){var h=d.cgTree;var f=h.match(/^\s*([\$\w]+)\s+in\s+([\S\s]*)\s+of\s+([\S\s]*)$/);if(!f){throw new Error("Expected cgTree in form of '_item_ in _collection_ of _root_' but got '"+h+"'.")}var g=this.ident={value:f[1],collection:f[2],root:f[3]};e.$watch(this.ident.root,function(i){e[g.value]=i})}],compile:function a(e){var f=e.html();return{pre:function d(i,j,h,g){g.template=f}}}}}]).directive("cgTreecurse",["$compile",function(b){return{require:"^cgTree",link:function a(f,h,d,c){var g=["<",h.context.tagName,' ng-repeat="',c.ident.value," in ",c.ident.value,".",c.ident.collection,'">',c.template,"</",h.context.tagName,">"];var e=angular.element(g.join(""));h.replaceWith(e);b(e)(f)}}}]);system.directive("checkPermiss",["httpService",function(a){return{restrict:"AE",scope:{},link:function(d,c,b){var e={};e.params=[];e.params.push(b.shirotag);e.service="checkPermiss?checkPermiss";a.callService(e).success(function(f){if(f=="false"){$(c[0]).remove()}})}}}]);